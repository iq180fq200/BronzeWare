{"ast":null,"code":"import cx from 'classnames';\nimport React, { useState } from 'react';\nimport { defer, fromEvent, asyncScheduler, BehaviorSubject, Subscription, merge, Observable, combineLatest, noop } from 'rxjs';\nimport * as op from 'rxjs/operators';\nimport { throttleTime, map } from 'rxjs/operators';\nimport * as styled from 'styled-components';\nimport styled__default, { css } from 'styled-components';\nimport ResizeObserver from 'resize-observer-polyfill';\n\nfunction isLeafNode(node) {\n  return node.children == null || node.children.length === 0;\n}\n/** 遍历所有节点，并将节点收集到一个数组中.\r\n * order 参数可用于指定遍历规则：\r\n * * `pre` 前序遍历 （默认）\r\n * * `post` 后续遍历\r\n * * `leaf-only` 忽略内部节点，只收集叶子节点\r\n * */\n\n\nfunction collectNodes(nodes) {\n  let order = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'pre';\n  const result = [];\n  dfs(nodes);\n  return result;\n\n  function dfs(nodes) {\n    if (nodes == null) {\n      return;\n    }\n\n    for (const node of nodes) {\n      if (isLeafNode(node)) {\n        result.push(node);\n      } else {\n        if (order === 'pre') {\n          result.push(node);\n          dfs(node.children);\n        } else if (order === 'post') {\n          dfs(node.children);\n          result.push(node);\n        } else {\n          dfs(node.children);\n        }\n      }\n    }\n  }\n}\n/** 获取一棵树的高度/深度 (0-based) */\n\n\nfunction getTreeDepth(nodes) {\n  let maxDepth = -1;\n  dfs(nodes, 0);\n  return maxDepth;\n\n  function dfs(columns, depth) {\n    for (const column of columns) {\n      if (isLeafNode(column)) {\n        maxDepth = Math.max(maxDepth, depth);\n      } else {\n        dfs(column.children, depth + 1);\n      }\n    }\n  }\n}\n\nfunction groupBy2(list, iteratee) {\n  const groups = new Map();\n\n  for (const item of list) {\n    const key = iteratee(item);\n\n    if (!groups.has(key)) {\n      groups.set(key, []);\n    }\n\n    groups.get(key).push(item);\n  }\n\n  return groups;\n}\n\nfunction flatMap(array, callback) {\n  const result = [];\n  array.forEach((value, index) => {\n    result.push(...callback(value, index, array));\n  });\n  return result;\n}\n\nfunction fromEntries(entries) {\n  const result = {};\n\n  for (const [key, value] of entries) {\n    result[key] = value;\n  }\n\n  return result;\n}\n\nconst arrayUtils = {\n  diff(arr1, arr2) {\n    const set = new Set(arr2);\n    return arr1.filter(x => !set.has(x));\n  },\n\n  merge(arr1, arr2) {\n    const set = new Set(arr1);\n    return arr1.concat(arr2.filter(x => !set.has(x)));\n  }\n\n};\n\nfunction always(value) {\n  return function () {\n    return value;\n  };\n}\n/** 在表格的单元格的渲染过程中，先渲染的单元格的 colSpan/rowSpan 会影响到后续单元格是否被渲染\r\n * `SpanManager` 会在内部维护一份状态来记录最近渲染单元格的 colSpan/rowSpan，\r\n * 方便后续的单元格快速判断 \"是否需要跳过渲染\" */\n\n\nclass SpanManager {\n  constructor() {\n    this.rects = [];\n  }\n\n  testSkip(rowIndex, colIndex) {\n    return this.rects.some(_ref => {\n      let {\n        left,\n        right,\n        top,\n        bottom\n      } = _ref;\n      return left <= colIndex && colIndex < right && top <= rowIndex && rowIndex < bottom;\n    });\n  }\n\n  stripUpwards(rowIndex) {\n    this.rects = this.rects.filter(rect => rect.bottom > rowIndex);\n  }\n\n  add(rowIndex, colIndex, colSpan, rowSpan) {\n    this.rects.push({\n      left: colIndex,\n      right: colIndex + colSpan,\n      top: rowIndex,\n      bottom: rowIndex + rowSpan\n    });\n  }\n\n}\n\nfunction safeRenderHeader(column) {\n  var _a;\n\n  return (_a = column.title) !== null && _a !== void 0 ? _a : column.name;\n}\n\nfunction safeGetValue(column, record, rowIndex) {\n  if (column.getValue) {\n    return column.getValue(record, rowIndex);\n  }\n\n  return record[column.code];\n}\n\nfunction safeGetRowKey(primaryKey, record, rowIndex) {\n  let key;\n\n  if (typeof primaryKey === 'string') {\n    key = record[primaryKey];\n  } else if (typeof primaryKey === 'function') {\n    key = primaryKey(record);\n  }\n\n  if (key == null) {\n    key = String(rowIndex);\n  }\n\n  return key;\n}\n\nfunction safeGetCellProps(column, record, rowIndex) {\n  if (column.getCellProps) {\n    const value = safeGetValue(column, record, rowIndex);\n    return column.getCellProps(value, record, rowIndex) || {};\n  }\n\n  return {};\n}\n\nfunction safeRender(column, record, rowIndex) {\n  const value = safeGetValue(column, record, rowIndex);\n\n  if (column.render) {\n    return column.render(value, record, rowIndex);\n  }\n\n  return value;\n}\n\nconst internals = {\n  safeRenderHeader,\n  safeGetValue,\n  safeGetRowKey,\n  safeGetCellProps,\n  safeRender\n};\n\nfunction composeEventHandler(handler1, handler2) {\n  return function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    // 先执行原有的事件回调函数\n    handler1(args);\n    handler2(args); // 事件回调函数没有返回值，故这里不进行 return\n  };\n}\n/** 合并两个 cellProps（单元格属性）对象，返回一个合并后的全新对象。\r\n *\r\n * mergeCellProps 会按照以下规则来合并两个对象：\r\n * * 对于 数字、字符串、布尔值类型的字段，extra 中的字段值将直接覆盖 base 中的字段值（className 是个特例，会进行字符串拼接）\r\n * * 对于函数/方法类型的字段（对应单元格的事件回调函数），mergeCellProps 将生成一个新的函数，新函数将按序调用 base 和 extra 中的方法\r\n * * 对于普通对象类型的字段（对应单元格的样式），mergeCellProps 将合并两个对象\r\n * */\n\n\nfunction mergeCellProps(base, extra) {\n  if (base == null) {\n    return extra;\n  }\n\n  if (extra == null) {\n    return base;\n  }\n\n  const result = Object.assign({}, base);\n\n  for (const key of Object.keys(extra)) {\n    const value = extra[key];\n    const type = typeof value;\n\n    if (value === null) {\n      // value=null 时 覆盖原来的值\n      result[key] = null;\n    } else if (value === undefined) ;else if (type === 'number' || type === 'string' || type === 'boolean') {\n      if (key === 'className') {\n        result[key] = cx(result[key], value);\n      } else {\n        result[key] = value;\n      }\n    } else if (type === 'function') {\n      const prev = result[key];\n\n      if (prev == null) {\n        result[key] = value;\n      } else {\n        result[key] = composeEventHandler(prev, value);\n      }\n    } else if (type === 'object') {\n      result[key] = Object.assign({}, result[key], value);\n    } // else `type` is 'bigint' or 'symbol', `value` is an invalid cellProp, ignore it\n\n  }\n\n  return result;\n}\n/** styled-components 类库的版本，ali-react-table 同时支持 v3 和 v5 */\n\n\nconst STYLED_VERSION = styled.createGlobalStyle != null ? 'v5' : 'v3';\nconst STYLED_REF_PROP = STYLED_VERSION === 'v3' ? 'innerRef' : 'ref';\nconst OVERSCAN_SIZE = 100;\nconst AUTO_VIRTUAL_THRESHOLD = 100;\n\nfunction sum(arr) {\n  let result = 0;\n  arr.forEach(x => {\n    result += x;\n  });\n  return result;\n} // 使用 defer 避免过早引用 window，导致在 SSR 场景下报错\n\n\nconst throttledWindowResize$ = defer(() => fromEvent(window, 'resize', {\n  passive: true\n}).pipe(throttleTime(150, asyncScheduler, {\n  leading: true,\n  trailing: true\n})));\n/** 获取默认的滚动条大小 */\n\nfunction getScrollbarSizeImpl() {\n  const scrollDiv = document.createElement('div');\n  scrollDiv.style.position = 'absolute';\n  scrollDiv.style.width = '100px';\n  scrollDiv.style.height = '100px';\n  scrollDiv.style.overflow = 'scroll';\n  scrollDiv.style.top = '-9999px';\n  document.body.appendChild(scrollDiv);\n  const scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n  const scrollbarHeight = scrollDiv.offsetHeight - scrollDiv.clientHeight;\n  document.body.removeChild(scrollDiv);\n  return {\n    width: scrollbarWidth,\n    height: scrollbarHeight\n  };\n}\n\nlet scrollBarSize$;\n\nfunction getScrollbarSize() {\n  if (scrollBarSize$ == null) {\n    scrollBarSize$ = new BehaviorSubject(getScrollbarSizeImpl());\n    throttledWindowResize$.pipe(map(() => getScrollbarSizeImpl())).subscribe(scrollBarSize$);\n  }\n\n  return scrollBarSize$.value;\n}\n/** 同步多个元素之间的 scrollLeft, 每当 scrollLeft 发生变化时 callback 会被调用 */\n\n\nfunction syncScrollLeft(elements, callback) {\n  const bypassSet = new Set();\n\n  function publishScrollLeft(origin, scrollLeft) {\n    bypassSet.clear();\n\n    for (const elem of elements) {\n      if (elem === origin) {\n        continue;\n      }\n\n      elem.scrollLeft = scrollLeft;\n      bypassSet.add(elem);\n    }\n  }\n\n  const subscription = new Subscription();\n\n  for (const ele of elements) {\n    const listener = () => {\n      if (bypassSet.has(ele)) {\n        bypassSet.delete(ele);\n        return;\n      }\n\n      const scrollLeft = ele.scrollLeft;\n      publishScrollLeft(ele, scrollLeft);\n      callback(scrollLeft);\n    };\n\n    ele.addEventListener('scroll', listener, {\n      passive: true\n    });\n    subscription.add(() => ele.removeEventListener('scroll', listener));\n  }\n\n  return subscription;\n}\n/**\r\n * Performs equality by iterating through keys on an object and returning false\r\n * when any key has values which are not strictly equal between the arguments.\r\n * Returns true when the values of all keys are strictly equal.\r\n */\n\n\nfunction shallowEqual(objA, objB) {\n  const hasOwnProperty = Object.prototype.hasOwnProperty;\n\n  if (Object.is(objA, objB)) {\n    return true;\n  }\n\n  if (typeof objA !== 'object' || objA === null || typeof objB !== 'object' || objB === null) {\n    return false;\n  }\n\n  const keysA = Object.keys(objA);\n  const keysB = Object.keys(objB);\n\n  if (keysA.length !== keysB.length) {\n    return false;\n  } // Test for A's keys different from B.\n\n\n  for (let i = 0; i < keysA.length; i++) {\n    if (!hasOwnProperty.call(objB, keysA[i]) || !Object.is(objA[keysA[i]], objB[keysA[i]])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction resolveVirtualEnabled(virtualEnum, defaultValue) {\n  if (virtualEnum == null || virtualEnum === 'auto') {\n    return defaultValue;\n  }\n\n  return virtualEnum;\n}\n\nlet lockColumnNeedSpecifiedWidthWarned = false;\n\nfunction warnLockColumnNeedSpecifiedWidth(column) {\n  if (!lockColumnNeedSpecifiedWidthWarned) {\n    lockColumnNeedSpecifiedWidthWarned = true;\n    console.warn('[ali-react-table] lock=true 的列需要指定宽度', column);\n  }\n}\n\nlet columnHiddenDeprecatedWarned = false;\n\nfunction warnColumnHiddenDeprecated(column) {\n  if (!columnHiddenDeprecatedWarned) {\n    columnHiddenDeprecatedWarned = true;\n    console.warn('[ali-react-table] column.hidden 已经过时，如果需要隐藏该列，请将其从 columns 数组中移除', column);\n  }\n}\n/** 检查列配置 & 设置默认宽度 & 剔除隐藏的列 */\n\n\nfunction processColumns(columns, defaultColumnWidth) {\n  if (columns == null || !Array.isArray(columns)) {\n    console.warn('[ali-react-table] <BaseTable /> props.columns 需要传入一个数组', columns);\n    columns = [];\n  }\n\n  function dfs(columns) {\n    const result = [];\n\n    for (let column of columns) {\n      if (column.width == null) {\n        if (defaultColumnWidth != null) {\n          column = Object.assign(Object.assign({}, column), {\n            width: defaultColumnWidth\n          });\n        } else if (process.env.NODE_ENV !== 'production' && isLeafNode(column) && column.lock) {\n          warnLockColumnNeedSpecifiedWidth(column);\n        }\n      }\n\n      if (isLeafNode(column)) {\n        if (column.hidden) {\n          // 被隐藏的列 会在这里被剔除\n          warnColumnHiddenDeprecated(column);\n        } else {\n          result.push(column);\n        }\n      } else {\n        const nextChildren = dfs(column.children); // 如果 nextChildren 为空，说明所有的子节点均被隐藏了，在这里隐藏父节点\n\n        if (nextChildren.length > 0) {\n          result.push(Object.assign(Object.assign({}, column), {\n            children: nextChildren\n          }));\n        }\n      }\n    }\n\n    return result;\n  }\n\n  return dfs(columns);\n}\n\nfunction getLeftNestedLockCount(columns) {\n  let nestedCount = 0;\n\n  for (const col of columns) {\n    if (isLock(col)) {\n      nestedCount += 1;\n    } else {\n      break;\n    }\n  }\n\n  return nestedCount;\n\n  function isLock(col) {\n    if (isLeafNode(col)) {\n      return col.lock;\n    } else {\n      return col.lock || col.children.some(isLock);\n    }\n  }\n}\n\nfunction getHorizontalRenderRange(_ref2) {\n  let {\n    offsetX,\n    maxRenderWidth,\n    flat,\n    useVirtual\n  } = _ref2;\n\n  if (!useVirtual.horizontal) {\n    return {\n      leftIndex: 0,\n      leftBlank: 0,\n      rightIndex: flat.full.length,\n      rightBlank: 0\n    };\n  }\n\n  let leftIndex = 0;\n  let centerCount = 0;\n  let leftBlank = 0;\n  let centerRenderWidth = 0;\n  const overscannedOffsetX = Math.max(0, offsetX - OVERSCAN_SIZE);\n\n  while (leftIndex < flat.center.length) {\n    const col = flat.center[leftIndex];\n\n    if (col.width + leftBlank < overscannedOffsetX) {\n      leftIndex += 1;\n      leftBlank += col.width;\n    } else {\n      break;\n    }\n  } // 考虑 over scan 之后，中间部分的列至少需要渲染的宽度\n\n\n  const minCenterRenderWidth = maxRenderWidth + (overscannedOffsetX - leftBlank) + 2 * OVERSCAN_SIZE;\n\n  while (leftIndex + centerCount < flat.center.length) {\n    const col = flat.center[leftIndex + centerCount];\n\n    if (col.width + centerRenderWidth < minCenterRenderWidth) {\n      centerRenderWidth += col.width;\n      centerCount += 1;\n    } else {\n      break;\n    }\n  }\n\n  const rightBlankCount = flat.center.length - leftIndex - centerCount;\n  const rightBlank = sum(flat.center.slice(flat.center.length - rightBlankCount).map(col => col.width));\n  return {\n    leftIndex: leftIndex,\n    leftBlank,\n    rightIndex: leftIndex + centerCount,\n    rightBlank\n  };\n} // 一顿计算，将表格本次渲染所需要的数据都给算出来（代码写得有点乱，有较大优化空间）\n// todo 可以考虑下将 header 部分的计算逻辑也放到这个文件中，目前应该有一些重复的计算逻辑\n\n\nfunction calculateRenderInfo(table) {\n  const {\n    offsetX,\n    maxRenderWidth\n  } = table.state;\n  const {\n    useVirtual: useVirtualProp,\n    columns: columnsProp,\n    dataSource: dataSourceProp,\n    defaultColumnWidth\n  } = table.props;\n  const columns = processColumns(columnsProp, defaultColumnWidth);\n  const leftNestedLockCount = getLeftNestedLockCount(columns);\n  const fullFlat = collectNodes(columns, 'leaf-only');\n  let flat;\n  let nested;\n  let useVirtual;\n\n  if (leftNestedLockCount === columns.length) {\n    flat = {\n      left: [],\n      right: [],\n      full: fullFlat,\n      center: fullFlat\n    };\n    nested = {\n      left: [],\n      right: [],\n      full: columns,\n      center: columns\n    };\n    useVirtual = {\n      horizontal: false,\n      vertical: false,\n      header: false\n    };\n  } else {\n    const leftNested = columns.slice(0, leftNestedLockCount);\n    const rightNestedLockCount = getLeftNestedLockCount(columns.slice().reverse());\n    const centerNested = columns.slice(leftNestedLockCount, columns.length - rightNestedLockCount);\n    const rightNested = columns.slice(columns.length - rightNestedLockCount);\n    const shouldEnableHozVirtual = fullFlat.length >= AUTO_VIRTUAL_THRESHOLD && fullFlat.every(col => col.width != null);\n    const shouldEnableVerVirtual = dataSourceProp.length >= AUTO_VIRTUAL_THRESHOLD;\n    useVirtual = {\n      horizontal: resolveVirtualEnabled(typeof useVirtualProp === 'object' ? useVirtualProp.horizontal : useVirtualProp, shouldEnableHozVirtual),\n      vertical: resolveVirtualEnabled(typeof useVirtualProp === 'object' ? useVirtualProp.vertical : useVirtualProp, shouldEnableVerVirtual),\n      header: resolveVirtualEnabled(typeof useVirtualProp === 'object' ? useVirtualProp.header : useVirtualProp, false)\n    };\n    flat = {\n      left: collectNodes(leftNested, 'leaf-only'),\n      full: fullFlat,\n      right: collectNodes(rightNested, 'leaf-only'),\n      center: collectNodes(centerNested, 'leaf-only')\n    };\n    nested = {\n      left: leftNested,\n      full: columns,\n      right: rightNested,\n      center: centerNested\n    };\n  }\n\n  const horizontalRenderRange = getHorizontalRenderRange({\n    maxRenderWidth,\n    offsetX,\n    useVirtual,\n    flat\n  });\n  const verticalRenderRange = table.getVerticalRenderRange(useVirtual);\n  const {\n    leftBlank,\n    leftIndex,\n    rightBlank,\n    rightIndex\n  } = horizontalRenderRange;\n  const unfilteredVisibleColumnDescriptors = [...flat.left.map((col, i) => ({\n    type: 'normal',\n    col,\n    colIndex: i\n  })), leftBlank > 0 && {\n    type: 'blank',\n    blankSide: 'left',\n    width: leftBlank\n  }, ...flat.center.slice(leftIndex, rightIndex).map((col, i) => ({\n    type: 'normal',\n    col,\n    colIndex: flat.left.length + leftIndex + i\n  })), rightBlank > 0 && {\n    type: 'blank',\n    blankSide: 'right',\n    width: rightBlank\n  }, ...flat.right.map((col, i) => ({\n    type: 'normal',\n    col,\n    colIndex: flat.full.length - flat.right.length + i\n  }))];\n  const visibleColumnDescriptors = unfilteredVisibleColumnDescriptors.filter(Boolean);\n  const fullFlatCount = flat.full.length;\n  const leftFlatCount = flat.left.length;\n  const rightFlatCount = flat.right.length;\n  const stickyLeftMap = new Map();\n  let stickyLeft = 0;\n\n  for (let i = 0; i < leftFlatCount; i++) {\n    stickyLeftMap.set(i, stickyLeft);\n    stickyLeft += flat.full[i].width;\n  }\n\n  const stickyRightMap = new Map();\n  let stickyRight = 0;\n\n  for (let i = 0; i < rightFlatCount; i++) {\n    stickyRightMap.set(fullFlatCount - 1 - i, stickyRight);\n    stickyRight += flat.full[fullFlatCount - 1 - i].width;\n  }\n\n  const leftLockTotalWidth = sum(flat.left.map(col => col.width));\n  const rightLockTotalWidth = sum(flat.right.map(col => col.width));\n  return {\n    horizontalRenderRange,\n    verticalRenderRange,\n    visible: visibleColumnDescriptors,\n    flat,\n    nested,\n    useVirtual,\n    stickyLeftMap,\n    stickyRightMap,\n    leftLockTotalWidth,\n    rightLockTotalWidth,\n    hasLockColumn: nested.left.length > 0 || nested.right.length > 0\n  };\n}\n\nfunction Colgroup(_ref3) {\n  let {\n    descriptors\n  } = _ref3;\n  return React.createElement(\"colgroup\", null, descriptors.map(descriptor => {\n    if (descriptor.type === 'blank') {\n      return React.createElement(\"col\", {\n        key: descriptor.blankSide,\n        style: {\n          width: descriptor.width\n        }\n      });\n    }\n\n    return React.createElement(\"col\", {\n      key: descriptor.colIndex,\n      style: {\n        width: descriptor.col.width\n      }\n    });\n  }));\n}\n\nconst LOCK_SHADOW_PADDING = 20;\nconst prefix = 'art-';\nconst Classes = {\n  /** BaseTable 表格组件的外层包裹 div */\n  artTableWrapper: `${prefix}table-wrapper`,\n  artTable: `${prefix}table`,\n  tableHeader: `${prefix}table-header`,\n  tableBody: `${prefix}table-body`,\n  tableFooter: `${prefix}table-footer`,\n\n  /** 表格行 */\n  tableRow: `${prefix}table-row`,\n\n  /** 表头行 */\n  tableHeaderRow: `${prefix}table-header-row`,\n\n  /** 单元格 */\n  tableCell: `${prefix}table-cell`,\n\n  /** 表头的单元格 */\n  tableHeaderCell: `${prefix}table-header-cell`,\n  virtualBlank: `${prefix}virtual-blank`,\n  stickyScroll: `${prefix}sticky-scroll`,\n  stickyScrollItem: `${prefix}sticky-scroll-item`,\n  horizontalScrollContainer: `${prefix}horizontal-scroll-container`,\n  lockShadowMask: `${prefix}lock-shadow-mask`,\n  lockShadow: `${prefix}lock-shadow`,\n  leftLockShadow: `${prefix}left-lock-shadow`,\n  rightLockShadow: `${prefix}right-lock-shadow`,\n\n  /** 数据为空时表格内容的外层 div */\n  emptyWrapper: `${prefix}empty-wrapper`,\n  loadingWrapper: `${prefix}loading-wrapper`,\n  loadingIndicatorWrapper: `${prefix}loading-indicator-wrapper`,\n  loadingIndicator: `${prefix}loading-indicator`\n};\nconst Z = {\n  lock: 5,\n  header: 15,\n  footer: 10,\n  lockShadow: 20,\n  scrollItem: 30,\n  loadingIndicator: 40\n};\nconst outerBorderStyleMixin = css`\n  border-top: var(--cell-border-horizontal);\n  border-right: var(--cell-border-vertical);\n  border-bottom: var(--cell-border-horizontal);\n  border-left: var(--cell-border-vertical);\n\n  td.first,\n  th.first {\n    border-left: none;\n  }\n  td.last,\n  th.last {\n    border-right: none;\n  }\n\n  thead tr.first th,\n  tbody tr.first td {\n    border-top: none;\n  }\n  &.has-footer tfoot tr.last td {\n    border-bottom: none;\n  }\n  &:not(.has-footer) tbody tr.last td {\n    border-bottom: none;\n  }\n`;\nconst StyledArtTableWrapper = styled__default.div`\n  --row-height: 48px;\n  --color: #333;\n  --bgcolor: white;\n  --hover-bgcolor: var(--hover-color, #f5f5f5);\n  --highlight-bgcolor: #eee;\n\n  --header-row-height: 32px;\n  --header-color: #5a6c84;\n  --header-bgcolor: #e9edf2;\n  --header-hover-bgcolor: #ddd;\n  --header-highlight-bgcolor: #e4e8ed;\n\n  --cell-padding: 8px 12px;\n  --font-size: 12px;\n  --line-height: 1.28571;\n  --lock-shadow: rgba(152, 152, 152, 0.5) 0 0 6px 2px;\n\n  --border-color: #dfe3e8;\n  --cell-border: 1px solid var(--border-color);\n  --cell-border-horizontal: var(--cell-border);\n  --cell-border-vertical: var(--cell-border);\n  --header-cell-border: 1px solid var(--border-color);\n  --header-cell-border-horizontal: var(--header-cell-border);\n  --header-cell-border-vertical: var(--header-cell-border);\n\n  box-sizing: border-box;\n  * {\n    box-sizing: border-box;\n  }\n  cursor: default;\n  color: var(--color);\n  font-size: var(--font-size);\n  line-height: var(--line-height);\n  position: relative;\n  overflow-anchor: none;\n\n  // 表格外边框由 art-table-wrapper 提供，而不是由单元格提供\n  &.use-outer-border {\n    ${outerBorderStyleMixin};\n  }\n\n  .no-scrollbar {\n    // firefox 中移除滚动条\n    scrollbar-width: none;\n\n    // 其他浏览器中移除滚动条\n    ::-webkit-scrollbar {\n      display: none;\n    }\n  }\n\n  .${Classes.tableHeader} {\n    overflow-x: auto;\n    overflow-y: hidden;\n    background: var(--header-bgcolor);\n  }\n\n  .${Classes.tableBody}, .${Classes.tableFooter} {\n    overflow-x: auto;\n    overflow-y: hidden;\n    background: var(--bgcolor);\n  }\n\n  &.sticky-header .${Classes.tableHeader} {\n    position: sticky;\n    top: 0;\n    z-index: ${Z.header};\n  }\n\n  &.sticky-footer .${Classes.tableFooter} {\n    position: sticky;\n    bottom: 0;\n    z-index: ${Z.footer};\n  }\n\n  table {\n    width: 100%;\n    table-layout: fixed;\n    border-collapse: separate;\n    border-spacing: 0;\n    display: table;\n    margin: 0;\n    padding: 0;\n  }\n\n  // 在 tr 上设置 .no-hover 可以禁用鼠标悬停效果\n  tr:not(.no-hover):hover > td {\n    background: var(--hover-bgcolor);\n  }\n  // 在 tr 设置 highlight 可以为底下的 td 设置为高亮色\n  // 而设置 .no-highlight 的话则可以禁用高亮效果；\n  tr:not(.no-highlight).highlight > td {\n    background: var(--highlight-bgcolor);\n  }\n\n  th {\n    font-weight: normal;\n    text-align: left;\n    padding: var(--cell-padding);\n    height: var(--header-row-height);\n    color: var(--header-color);\n    background: var(--header-bgcolor);\n    border: none;\n    border-right: var(--header-cell-border-vertical);\n    border-bottom: var(--header-cell-border-horizontal);\n  }\n  tr.first th {\n    border-top: var(--header-cell-border-horizontal);\n  }\n  th.first {\n    border-left: var(--header-cell-border-vertical);\n  }\n\n  td {\n    padding: var(--cell-padding);\n    background: var(--bgcolor);\n    height: var(--row-height);\n    border: none;\n    border-right: var(--cell-border-vertical);\n    border-bottom: var(--cell-border-horizontal);\n  }\n  td.first {\n    border-left: var(--cell-border-vertical);\n  }\n  tr.first td {\n    border-top: var(--cell-border-horizontal);\n  }\n  &.has-header tbody tr.first td {\n    border-top: none;\n  }\n  &.has-footer tbody tr.last td {\n    border-bottom: none;\n  }\n\n  .lock-left,\n  .lock-right {\n    z-index: ${Z.lock};\n  }\n\n  //#region 锁列阴影\n  .${Classes.lockShadowMask} {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    z-index: ${Z.lockShadow};\n    pointer-events: none;\n    overflow: hidden;\n\n    .${Classes.lockShadow} {\n      height: 100%;\n    }\n\n    .${Classes.leftLockShadow} {\n      margin-right: ${LOCK_SHADOW_PADDING}px;\n      box-shadow: none;\n\n      &.show-shadow {\n        box-shadow: var(--lock-shadow);\n        border-right: var(--cell-border-vertical);\n      }\n    }\n\n    .${Classes.rightLockShadow} {\n      margin-left: ${LOCK_SHADOW_PADDING}px;\n      box-shadow: none;\n\n      &.show-shadow {\n        box-shadow: var(--lock-shadow);\n        border-left: var(--cell-border-vertical);\n      }\n    }\n  }\n  //#endregion\n\n  //#region 空表格展现\n  .${Classes.emptyWrapper} {\n    pointer-events: none;\n    color: #99a3b3;\n    font-size: 12px;\n    text-align: center;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n\n    .empty-image {\n      width: 50px;\n      height: 50px;\n    }\n\n    .empty-tips {\n      margin-top: 16px;\n      line-height: 1.5;\n    }\n  }\n  //#endregion\n\n  //#region 粘性滚动条\n  .${Classes.stickyScroll} {\n    overflow: auto;\n    position: sticky;\n    bottom: 0;\n    z-index: ${Z.scrollItem};\n    margin-top: -17px;\n  }\n\n  .${Classes.stickyScrollItem} {\n    // 必须有高度才能出现滚动条\n    height: 1px;\n    visibility: hidden;\n  }\n  //#endregion\n\n  //#region 加载样式\n  .${Classes.loadingWrapper} {\n    position: relative;\n\n    .${Classes.loadingIndicatorWrapper} {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      pointer-events: none;\n    }\n\n    .${Classes.loadingIndicator} {\n      position: sticky;\n      z-index: ${Z.loadingIndicator};\n      transform: translateY(-50%);\n    }\n  }\n  //#endregion\n`;\nconst DefaultEmptyContent = React.memo(() => React.createElement(React.Fragment, null, React.createElement(\"img\", {\n  alt: \"empty-image\",\n  className: \"empty-image\",\n  src: \"//img.alicdn.com/tfs/TB1l1LcM3HqK1RjSZJnXXbNLpXa-50-50.svg\"\n}), React.createElement(\"div\", {\n  className: \"empty-tips\"\n}, \"\\u6CA1\\u6709\\u7B26\\u5408\\u67E5\\u8BE2\\u6761\\u4EF6\\u7684\\u6570\\u636E\", React.createElement(\"br\", null), \"\\u8BF7\\u4FEE\\u6539\\u6761\\u4EF6\\u540E\\u91CD\\u65B0\\u67E5\\u8BE2\")));\n\nfunction EmptyHtmlTable(_ref4) {\n  let {\n    descriptors,\n    isLoading,\n    emptyCellHeight,\n    EmptyContent = DefaultEmptyContent\n  } = _ref4;\n  const show = !isLoading;\n  return React.createElement(\"table\", null, React.createElement(Colgroup, {\n    descriptors: descriptors\n  }), React.createElement(\"tbody\", null, React.createElement(\"tr\", {\n    className: cx(Classes.tableRow, 'first', 'last', 'no-hover'),\n    \"data-rowindex\": 0\n  }, React.createElement(\"td\", {\n    className: cx(Classes.tableCell, 'first', 'last'),\n    colSpan: descriptors.length,\n    style: {\n      height: emptyCellHeight !== null && emptyCellHeight !== void 0 ? emptyCellHeight : 200\n    }\n  }, show && React.createElement(\"div\", {\n    className: Classes.emptyWrapper\n  }, React.createElement(EmptyContent, null))))));\n}\n\nfunction range(n) {\n  const array = [];\n\n  for (let i = 0; i < n; i++) {\n    array.push(i);\n  }\n\n  return array;\n}\n/** 根据当前横向虚拟滚动 对 nested.center 进行过滤，结果只保留当前视野内可见的那些列配置 */\n\n\nfunction filterNestedCenter(centerNested, hoz, leftFlatCount) {\n  return dfs(centerNested, leftFlatCount).filtered;\n\n  function dfs(cols, startColIndex) {\n    let leafCount = 0;\n    const filtered = [];\n\n    for (const col of cols) {\n      const colIndex = startColIndex + leafCount;\n\n      if (isLeafNode(col)) {\n        leafCount += 1;\n\n        if (leftFlatCount + hoz.leftIndex <= colIndex && colIndex < leftFlatCount + hoz.rightIndex) {\n          filtered.push({\n            colIndex,\n            col\n          });\n        }\n      } else {\n        const dfsRes = dfs(col.children, colIndex);\n        leafCount += dfsRes.leafCount;\n\n        if (dfsRes.filtered.length > 0) {\n          filtered.push({\n            colIndex,\n            col,\n            children: dfsRes.filtered\n          });\n        }\n      }\n    }\n\n    return {\n      filtered,\n      leafCount\n    };\n  }\n}\n/** 根据输入的 nested 列配置，算出相应的 leveled & flat 配置方便渲染 */\n\n\nfunction calculateLeveledAndFlat(inputNested, rowCount) {\n  const leveled = [];\n\n  for (let depth = 0; depth < rowCount; depth++) {\n    leveled.push([]);\n  }\n\n  const flat = [];\n  dfs(inputNested, 0);\n  return {\n    flat,\n    leveled\n  };\n\n  function dfs(input, depth) {\n    let leafCount = 0;\n\n    for (let i = 0; i < input.length; i++) {\n      const indexedCol = input[i];\n\n      if (isLeafNode(indexedCol)) {\n        leafCount += 1;\n        const wrapped = {\n          type: 'normal',\n          width: indexedCol.col.width,\n          col: indexedCol.col,\n          colIndex: indexedCol.colIndex,\n          colSpan: 1,\n          isLeaf: true\n        };\n        leveled[depth].push(wrapped);\n        flat.push(wrapped);\n      } else {\n        const dfsRes = dfs(indexedCol.children, depth + 1);\n        leafCount += dfsRes.leafCount;\n\n        if (dfsRes.leafCount > 0) {\n          leveled[depth].push({\n            type: 'normal',\n            width: indexedCol.col.width,\n            col: indexedCol.col,\n            colIndex: indexedCol.colIndex,\n            colSpan: dfsRes.leafCount,\n            isLeaf: false\n          });\n        }\n      }\n    }\n\n    return {\n      leafCount\n    };\n  }\n}\n/** 包装列配置，附加上 colIndex 属性 */\n\n\nfunction attachColIndex(inputNested, colIndexOffset) {\n  return dfs(inputNested, colIndexOffset).result;\n\n  function dfs(input, startColIndex) {\n    const result = [];\n    let leafCount = 0;\n\n    for (let i = 0; i < input.length; i++) {\n      const col = input[i];\n      const colIndex = startColIndex + leafCount;\n\n      if (isLeafNode(col)) {\n        leafCount += 1;\n        result.push({\n          colIndex,\n          col\n        });\n      } else {\n        const sub = dfs(col.children, colIndex);\n        leafCount += sub.leafCount;\n\n        if (sub.leafCount > 0) {\n          result.push({\n            col,\n            colIndex,\n            children: sub.result\n          });\n        }\n      }\n    }\n\n    return {\n      result,\n      leafCount\n    };\n  }\n}\n/** 计算用于渲染表头的数据结构 */\n\n\nfunction calculateHeaderRenderInfo(_ref5, rowCount) {\n  let {\n    flat,\n    nested,\n    horizontalRenderRange: hoz,\n    useVirtual\n  } = _ref5;\n\n  if (useVirtual.header) {\n    const leftPart = calculateLeveledAndFlat(attachColIndex(nested.left, 0), rowCount);\n    const filtered = filterNestedCenter(nested.center, hoz, flat.left.length);\n    const centerPart = calculateLeveledAndFlat(filtered, rowCount);\n    const rightPart = calculateLeveledAndFlat(attachColIndex(nested.right, flat.left.length + flat.center.length), rowCount);\n    return {\n      flat: [...leftPart.flat, {\n        type: 'blank',\n        width: hoz.leftBlank,\n        blankSide: 'left'\n      }, ...centerPart.flat, {\n        type: 'blank',\n        width: hoz.rightBlank,\n        blankSide: 'right'\n      }, ...rightPart.flat],\n      leveled: range(rowCount).map(depth => [...leftPart.leveled[depth], {\n        type: 'blank',\n        width: hoz.leftBlank,\n        blankSide: 'left'\n      }, ...centerPart.leveled[depth], {\n        type: 'blank',\n        width: hoz.rightBlank,\n        blankSide: 'right'\n      }, ...rightPart.leveled[depth]])\n    };\n  }\n\n  return calculateLeveledAndFlat(attachColIndex(nested.full, 0), rowCount);\n}\n\nfunction TableHeader(_ref6) {\n  let {\n    info\n  } = _ref6;\n  const {\n    nested,\n    flat,\n    stickyLeftMap,\n    stickyRightMap\n  } = info;\n  const rowCount = getTreeDepth(nested.full) + 1;\n  const headerRenderInfo = calculateHeaderRenderInfo(info, rowCount);\n  const fullFlatCount = flat.full.length;\n  const leftFlatCount = flat.left.length;\n  const rightFlatCount = flat.right.length;\n  const thead = headerRenderInfo.leveled.map((wrappedCols, level) => {\n    const headerCells = wrappedCols.map(wrapped => {\n      var _a, _b;\n\n      if (wrapped.type === 'normal') {\n        const {\n          colIndex,\n          colSpan,\n          isLeaf,\n          col\n        } = wrapped;\n        const headerCellProps = (_a = col.headerCellProps) !== null && _a !== void 0 ? _a : {};\n        const positionStyle = {};\n\n        if (colIndex < leftFlatCount) {\n          positionStyle.position = 'sticky';\n          positionStyle.left = stickyLeftMap.get(colIndex);\n        } else if (colIndex >= fullFlatCount - rightFlatCount) {\n          positionStyle.position = 'sticky';\n          positionStyle.right = stickyRightMap.get(colIndex + colSpan - 1);\n        }\n\n        return React.createElement(\"th\", Object.assign({\n          key: colIndex\n        }, headerCellProps, {\n          className: cx(Classes.tableHeaderCell, headerCellProps.className, {\n            first: colIndex === 0,\n            last: colIndex + colSpan === fullFlatCount,\n            'lock-left': colIndex < leftFlatCount,\n            'lock-right': colIndex >= fullFlatCount - rightFlatCount\n          }),\n          colSpan: colSpan,\n          rowSpan: isLeaf ? rowCount - level : undefined,\n          style: Object.assign(Object.assign({\n            textAlign: col.align\n          }, headerCellProps.style), positionStyle)\n        }), (_b = col.title) !== null && _b !== void 0 ? _b : col.name);\n      } else {\n        if (wrapped.width > 0) {\n          return React.createElement(\"th\", {\n            key: wrapped.blankSide\n          });\n        } else {\n          return null;\n        }\n      }\n    });\n    return React.createElement(\"tr\", {\n      key: level,\n      className: cx(Classes.tableHeaderRow, {\n        first: level === 0,\n        last: level === rowCount - 1\n      })\n    }, headerCells);\n  });\n  return React.createElement(\"table\", null, React.createElement(\"colgroup\", null, headerRenderInfo.flat.map(wrapped => {\n    if (wrapped.type === 'blank') {\n      if (wrapped.width > 0) {\n        return React.createElement(\"col\", {\n          key: wrapped.blankSide,\n          style: {\n            width: wrapped.width\n          }\n        });\n      } else {\n        return null;\n      }\n    } else {\n      return React.createElement(\"col\", {\n        key: wrapped.colIndex,\n        style: {\n          width: wrapped.width\n        }\n      });\n    }\n  })), React.createElement(\"thead\", null, thead));\n}\n\nfunction getNodeName(element) {\n  return element ? (element.nodeName || '').toLowerCase() : null;\n}\n\nfunction getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (node.toString() !== '[object Window]') {\n    var ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}\n\nfunction getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}\n\nfunction isElement(node) {\n  var OwnElement = getWindow(node).Element;\n  return node instanceof OwnElement || node instanceof Element;\n}\n\nfunction isHTMLElement(node) {\n  var OwnElement = getWindow(node).HTMLElement;\n  return node instanceof OwnElement || node instanceof HTMLElement;\n}\n\nfunction isShadowRoot(node) {\n  // IE 11 has no ShadowRoot\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  var OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\n\nfunction isTableElement(element) {\n  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;\n}\n\nfunction getDocumentElement(element) {\n  // $FlowFixMe[incompatible-return]: assume body is always available\n  return ((isElement(element) ? element.ownerDocument : // $FlowFixMe[prop-missing]\n  element.document) || window.document).documentElement;\n}\n\nfunction getParentNode(element) {\n  if (getNodeName(element) === 'html') {\n    return element;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // $FlowFixMe[incompatible-return]\n    // $FlowFixMe[prop-missing]\n    element.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    element.parentNode || ( // DOM Element detected\n    isShadowRoot(element) ? element.host : null) || // ShadowRoot detected\n    // $FlowFixMe[incompatible-call]: HTMLElement is a Node\n    getDocumentElement(element) // fallback\n\n  );\n}\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837\n  getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n} // `.offsetParent` reports `null` for fixed elements, while absolute elements\n// return the containing block\n\n\nfunction getContainingBlock(element) {\n  var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') !== -1;\n  var isIE = navigator.userAgent.indexOf('Trident') !== -1;\n\n  if (isIE && isHTMLElement(element)) {\n    // In IE 9, 10 and 11 fixed elements containing block is always established by the viewport\n    var elementCss = getComputedStyle(element);\n\n    if (elementCss.position === 'fixed') {\n      return null;\n    }\n  }\n\n  var currentNode = getParentNode(element);\n\n  while (isHTMLElement(currentNode) && ['html', 'body'].indexOf(getNodeName(currentNode)) < 0) {\n    var css = getComputedStyle(currentNode); // This is non-exhaustive but covers the most common CSS properties that\n    // create a containing block.\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n    if (css.transform !== 'none' || css.perspective !== 'none' || css.contain === 'paint' || ['transform', 'perspective'].indexOf(css.willChange) !== -1 || isFirefox && css.willChange === 'filter' || isFirefox && css.filter && css.filter !== 'none') {\n      return currentNode;\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nfunction getOffsetParent(element) {\n  var window = getWindow(element);\n  var offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static')) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}\n\nfunction getWindowScroll(node) {\n  var win = getWindow(node);\n  var scrollLeft = win.pageXOffset;\n  var scrollTop = win.pageYOffset;\n  return {\n    scrollLeft: scrollLeft,\n    scrollTop: scrollTop\n  };\n}\n\nfunction isScrollParent(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  var _getComputedStyle = getComputedStyle(element),\n      overflow = _getComputedStyle.overflow,\n      overflowX = _getComputedStyle.overflowX,\n      overflowY = _getComputedStyle.overflowY;\n\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}\n\nfunction isWindow(arg) {\n  return arg.toString() === '[object Window]';\n}\n\nfunction isBody(arg) {\n  return getNodeName(arg) === 'body';\n}\n\nfunction isHtml(arg) {\n  return getNodeName(arg) === 'html';\n}\n\nfunction isHtmlOrBody(arg) {\n  return isHtml(arg) || isBody(arg);\n} // 计算从 start（子元素）到 stop（祖先元素）之间所有元素的 scrollTop 或 scrollLeft 的和\n// 注意 start 和 stop 都是 INCLUSIVE 的，即两者的 scrollTop 或 scrollLeft 都会统计在内\n\n\nfunction accumulateScrollOffset(start, stop, scrollOffsetKey) {\n  let result = 0;\n  let elem = start;\n\n  while (elem != null) {\n    result += elem[scrollOffsetKey];\n\n    if (elem === stop || isWindow(stop) && isHtmlOrBody(elem)) {\n      break;\n    }\n\n    elem = elem.parentElement;\n  }\n\n  if (isWindow(stop)) {\n    result += getWindowScroll(elem)[scrollOffsetKey];\n  }\n\n  return result;\n}\n/**\r\n * 获取 target 相对于 base 的布局大小和相对位置。\r\n * 注意该方法会考虑滚动所带来的影响\r\n */\n\n\nfunction getRelativeLayoutRect(base, target) {\n  if (isWindow(target) || isHtmlOrBody(target)) {\n    return {\n      left: 0,\n      right: window.innerWidth,\n      top: 0,\n      bottom: window.innerHeight\n    };\n  }\n\n  let deltaX = 0;\n  let deltaY = 0;\n  let elem = target;\n\n  while (elem != null && elem != base) {\n    deltaY += elem.offsetTop;\n    deltaX += elem.offsetLeft;\n    const offsetParent = getOffsetParent(elem);\n    deltaY -= accumulateScrollOffset(elem.parentElement, offsetParent, 'scrollTop');\n    deltaX -= accumulateScrollOffset(elem.parentElement, offsetParent, 'scrollLeft');\n\n    if (isWindow(offsetParent)) {\n      break;\n    }\n\n    deltaY += offsetParent.clientTop;\n    deltaX += offsetParent.clientLeft;\n    elem = offsetParent;\n  }\n\n  return {\n    top: deltaY,\n    bottom: deltaY + target.offsetHeight,\n    left: deltaX,\n    right: deltaX + target.offsetWidth\n  };\n}\n\nfunction findCommonOffsetAncestor(target, scrollParent) {\n  if (isWindow(scrollParent)) {\n    return scrollParent;\n  }\n\n  const offsetParents = listOffsetParents(target);\n\n  if (offsetParents.includes(scrollParent)) {\n    return scrollParent;\n  }\n\n  return getOffsetParent(scrollParent);\n} // 列出 target 元素上层的所有 offset parents\n\n\nfunction listOffsetParents(target) {\n  const result = [];\n  let elem = target;\n\n  while (true) {\n    if (isWindow(elem)) {\n      break;\n    }\n\n    elem = getOffsetParent(elem);\n    result.push(elem);\n  }\n\n  return result;\n}\n\nfunction fromScrollEvent(element) {\n  return fromEvent(element, 'scroll', {\n    passive: true\n  });\n}\n\nfunction fromResizeEvent(element) {\n  if (isWindow(element)) {\n    return fromEvent(element, 'resize', {\n      passive: true\n    });\n  }\n\n  return new Observable(subscriber => {\n    const resizeObserver = new ResizeObserver(entries => {\n      subscriber.next(entries);\n    });\n    resizeObserver.observe(element);\n    return () => {\n      resizeObserver.disconnect();\n    };\n  });\n}\n\nfunction getScrollParent(elem) {\n  if (['html', 'body', '#document'].includes(getNodeName(elem))) {\n    return getWindow(elem);\n  }\n\n  if (isHTMLElement(elem) && isScrollParent(elem)) {\n    return elem;\n  }\n\n  return getScrollParent(getParentNode(elem));\n} // 获取 target 相对于「它的滚动父元素」的可见部分的大小与位置\n\n\nfunction getRichVisibleRectsStream(target, structureMayChange$, virtualDebugLabel) {\n  return structureMayChange$.pipe(op.startWith('init'), op.map(() => {\n    // target 的第一个滚动父元素，我们认为这就是虚拟滚动发生的地方\n    // 即虚拟滚动不考虑「更上层元素发生滚动」的情况\n    const scrollParent = getScrollParent(target); // target 和 scrollParent 的共同 offset 祖先，作为布局尺寸计算时的参照元素\n\n    const commonOffsetAncestor = findCommonOffsetAncestor(target, scrollParent);\n    return {\n      scrollParent,\n      commonOffsetAncestor\n    };\n  }), op.distinctUntilChanged(shallowEqual), op.tap(structure => {\n    if (virtualDebugLabel) {\n      console.log(`%c[ali-react-table STRUCTURE ${virtualDebugLabel}]`, 'color: #4f9052; font-weight: bold', '\\ntarget:', target, '\\nscrollParent:', structure.scrollParent, '\\ncommonOffsetAncestor:', structure.commonOffsetAncestor);\n    }\n  }), op.switchMap(_ref7 => {\n    let {\n      scrollParent,\n      commonOffsetAncestor\n    } = _ref7;\n    const events$ = merge(fromScrollEvent(scrollParent), fromResizeEvent(scrollParent), fromResizeEvent(target));\n    return events$.pipe(op.map(event => ({\n      targetRect: getRelativeLayoutRect(commonOffsetAncestor, target),\n      scrollParentRect: getRelativeLayoutRect(commonOffsetAncestor, scrollParent),\n      event\n    })), op.map(_ref8 => {\n      let {\n        event,\n        scrollParentRect,\n        targetRect\n      } = _ref8;\n      return {\n        event,\n        targetRect,\n        scrollParentRect,\n        offsetY: Math.max(0, scrollParentRect.top - targetRect.top),\n        // 表格的横向滚动总是发生在表格内部，所以这里不需要计算 offsetX\n        // offsetX: Math.max(0, scrollParentRect.left - targetRect.left),\n        clipRect: {\n          left: Math.max(targetRect.left, scrollParentRect.left),\n          top: Math.max(targetRect.top, scrollParentRect.top),\n          right: Math.min(targetRect.right, scrollParentRect.right),\n          bottom: Math.min(targetRect.bottom, scrollParentRect.bottom)\n        }\n      };\n    }));\n  }), op.tap(rects => {\n    if (virtualDebugLabel) {\n      console.log(`%c[ali-react-table RECTS ${virtualDebugLabel}]`, 'color: #4f9052; font-weight: bold', '\\noffsetY:', rects.offsetY, '\\ntargetRect:', rects.targetRect, '\\nscrollParentRect:', rects.scrollParentRect, '\\nclipRect:', rects.clipRect, '\\nevent:', rects.event);\n    }\n  }));\n}\n\nfunction getFullRenderRange(rowCount) {\n  return {\n    topIndex: 0,\n    topBlank: 0,\n    bottomIndex: rowCount,\n    bottomBlank: 0\n  };\n}\n\nfunction makeRowHeightManager(initRowCount, estimatedRowHeight) {\n  const cache = new Array(initRowCount).fill(estimatedRowHeight);\n\n  function getRenderRange(offset, maxRenderHeight, rowCount) {\n    if (cache.length !== rowCount) {\n      setRowCount(rowCount);\n    }\n\n    if (maxRenderHeight <= 0) {\n      // maxRenderHeight <= 0 说明表格目前在 viewport 之外\n      if (offset <= 0) {\n        // 表格在 viewport 下方\n        return getRenderRangeWhenBelowView();\n      } else {\n        // 表格在 viewport 上方\n        return getRenderRangeWhenAboveView();\n      }\n    } else {\n      // 表格与 viewport 相交\n      return getRenderRangeWhenInView();\n    }\n\n    function getRenderRangeWhenBelowView() {\n      const start = {\n        topIndex: 0,\n        topBlank: 0\n      };\n      const end = getEnd(0, start);\n      return Object.assign(Object.assign({}, start), end);\n    }\n\n    function getRenderRangeWhenAboveView() {\n      const totalSize = getEstimatedTotalSize(rowCount);\n      const start = getStart(totalSize);\n      const end = getEnd(totalSize, start);\n      return Object.assign(Object.assign({}, start), end);\n    }\n\n    function getRenderRangeWhenInView() {\n      const start = getStart(offset);\n      const end = getEnd(offset + maxRenderHeight, start);\n      return Object.assign(Object.assign({}, start), end);\n    }\n    /** 获取虚拟滚动在 开始位置上的信息 */\n\n\n    function getStart(offset) {\n      if (cache.length === 0) {\n        return {\n          topIndex: 0,\n          topBlank: 0\n        };\n      }\n\n      let topIndex = 0;\n      let topBlank = 0;\n\n      while (topIndex < cache.length) {\n        const h = cache[topIndex];\n\n        if (topBlank + h >= offset) {\n          break;\n        }\n\n        topBlank += h;\n        topIndex += 1;\n      }\n\n      return overscanUpwards(topIndex, topBlank);\n    }\n\n    function overscanUpwards(topIndex, topBlank) {\n      let overscanSize = 0;\n      let overscanCount = 0;\n\n      while (overscanCount < topIndex && overscanSize < OVERSCAN_SIZE) {\n        overscanCount += 1;\n        overscanSize += cache[topIndex - overscanCount];\n      }\n\n      return {\n        topIndex: topIndex - overscanCount,\n        topBlank: topBlank - overscanSize\n      };\n    }\n    /** 获取虚拟滚动 在结束位置上的信息 */\n\n\n    function getEnd(endOffset, startInfo) {\n      let bottomIndex = startInfo.topIndex;\n      let offset = startInfo.topBlank;\n\n      while (bottomIndex < rowCount && offset < endOffset) {\n        offset += cache[bottomIndex];\n        bottomIndex += 1;\n      }\n\n      const bottomBlank = getEstimatedTotalSize(rowCount) - offset;\n      return overscanDownwards(bottomIndex, bottomBlank);\n    }\n\n    function overscanDownwards(bottomIndex, bottomBlank) {\n      let overscanSize = 0;\n      let overscanCount = 0;\n\n      while (overscanCount < rowCount - bottomIndex && overscanSize < OVERSCAN_SIZE) {\n        overscanSize += cache[bottomIndex + overscanCount];\n        overscanCount += 1;\n      }\n\n      return {\n        bottomIndex: bottomIndex + overscanCount,\n        bottomBlank: bottomBlank - overscanSize\n      };\n    }\n\n    function getEstimatedTotalSize(rowCount) {\n      return sum(cache) + (rowCount - cache.length) * estimatedRowHeight;\n    }\n\n    function setRowCount(count) {\n      // 将 cache 的长度设置为 count\n      if (count < cache.length) {\n        cache.length = count;\n      } else {\n        const prevSize = cache.length;\n        cache.length = count;\n        cache.fill(estimatedRowHeight, prevSize);\n      }\n    }\n  }\n\n  function updateRow(index, offset, size) {\n    cache[index] = size;\n  }\n\n  return {\n    getRenderRange,\n    updateRow,\n    // 导出 cache，方便调试；上层在实际使用时 并不需要使用 cache 字段\n    cache\n  };\n} // 表格 DOM 结构\n// div.art-table-wrapper\n// └── div.art-loading-wrapper\n//     ├── div.art-loading-indicator-wrapper\n//     │   └── div.art-loading-indicator\n//     │\n//     └── div.art-loading-content-wrapper\n//         ├── div.art-table\n//         │   │\n//         │   ├── div.art-table-header\n//         │   │  └── table\n//         │   │      ├── colgroup\n//         │   │      └── thead  注意这里会出现自定义内容，可能存在嵌套表格\n//         │   │\n//         │   ├── div.art-table-body\n//         │   │   ├── div.art-virtual-blank.top\n//         │   │   ├── table\n//         │   │   │   ├── colgroup\n//         │   │   │   └── tbody 注意这里会出现自定义内容，可能存在嵌套表格\n//         │   │   └── div.art-virtual-blank.bottom\n//         │   │\n//         │   ├── div.art-table-footer\n//         │   │  └── table\n//         │   │      ├── colgroup\n//         │   │      └── tfoot  注意这里会出现自定义内容，可能存在嵌套表格\n//         │   │\n//         │   ├── div.art-lock-shadow-mask\n//         │   │   └── div.art-left-lock-shadow\n//         │   └── div.art-lock-shadow-mask\n//         │       └── div.art-right-lock-shadow\n//         │\n//         └── div.art-sticky-scroll\n//             └── div.art-sticky-scroll-item\n//\n// 在「可能存在嵌套表格」的情况下，我们可以采用以下的方式来避免「querySelector 不小心获取到了的嵌套表格上的元素」：\n//  artTable.querySelector(':scope > .art-lock-shadow-mask .art-left-lock-shadow')\n// 表格 DOM 结构辅助工具\n\n\nclass TableDOMHelper {\n  constructor(artTableWrapper) {\n    this.artTableWrapper = artTableWrapper;\n    this.artTable = artTableWrapper.querySelector(`.${Classes.artTable}`);\n    this.tableHeader = this.artTable.querySelector(`:scope > .${Classes.tableHeader}`);\n    this.tableBody = this.artTable.querySelector(`:scope > .${Classes.tableBody}`);\n    this.tableFooter = this.artTable.querySelector(`:scope > .${Classes.tableFooter}`);\n    const stickyScrollSelector = `.${Classes.artTable} + .${Classes.stickyScroll}`;\n    this.stickyScroll = artTableWrapper.querySelector(stickyScrollSelector);\n    this.stickyScrollItem = this.stickyScroll.querySelector(`.${Classes.stickyScrollItem}`);\n  }\n\n  getVirtualTop() {\n    return this.tableBody.querySelector(`.${Classes.virtualBlank}.top`);\n  }\n\n  getTableRows() {\n    const htmlTable = this.getTableBodyHtmlTable();\n    return htmlTable.querySelectorAll(`:scope > tbody > .${Classes.tableRow}`);\n  }\n\n  getTableBodyHtmlTable() {\n    return this.artTable.querySelector(`.${Classes.tableBody} table`);\n  }\n\n  getLeftLockShadow() {\n    const selector = `:scope > .${Classes.lockShadowMask} .${Classes.leftLockShadow}`;\n    return this.artTable.querySelector(selector);\n  }\n\n  getRightLockShadow() {\n    const selector = `:scope > .${Classes.lockShadowMask} .${Classes.rightLockShadow}`;\n    return this.artTable.querySelector(selector);\n  }\n\n  getLoadingIndicator() {\n    return this.artTableWrapper.querySelector(`.${Classes.loadingIndicator}`);\n  }\n\n}\n\nfunction HtmlTable(_ref9) {\n  let {\n    tbodyHtmlTag,\n    getRowProps,\n    primaryKey,\n    data,\n    verticalRenderInfo: verInfo,\n    horizontalRenderInfo: hozInfo,\n    components: {\n      Row,\n      Cell,\n      TableBody\n    }\n  } = _ref9;\n  const {\n    flat,\n    horizontalRenderRange: hoz\n  } = hozInfo;\n  const spanManager = new SpanManager();\n  const fullFlatCount = flat.full.length;\n  const leftFlatCount = flat.left.length;\n  const rightFlatCount = flat.right.length;\n  const tbody = TableBody != null && tbodyHtmlTag === 'tbody' ? React.createElement(TableBody, {\n    tbodyProps: {\n      children: data.map(renderRow)\n    }\n  }) : React.createElement(tbodyHtmlTag, null, data.map(renderRow));\n  return React.createElement(\"table\", null, React.createElement(Colgroup, {\n    descriptors: hozInfo.visible\n  }), tbody);\n\n  function renderRow(row, i) {\n    const rowIndex = verInfo.offset + i;\n    spanManager.stripUpwards(rowIndex);\n    const rowProps = getRowProps(row, rowIndex);\n    const rowClass = cx(Classes.tableRow, {\n      first: rowIndex === verInfo.first,\n      last: rowIndex === verInfo.last,\n      even: rowIndex % 2 === 0,\n      odd: rowIndex % 2 === 1\n    }, rowProps === null || rowProps === void 0 ? void 0 : rowProps.className);\n    const trProps = Object.assign(Object.assign({}, rowProps), {\n      className: rowClass,\n      'data-rowindex': rowIndex,\n      children: hozInfo.visible.map(descriptor => {\n        if (descriptor.type === 'blank') {\n          return React.createElement(\"td\", {\n            key: descriptor.blankSide\n          });\n        }\n\n        return renderBodyCell(row, rowIndex, descriptor.col, descriptor.colIndex);\n      })\n    });\n    const key = internals.safeGetRowKey(primaryKey, row, rowIndex);\n\n    if (Row != null && tbodyHtmlTag === 'tbody') {\n      return React.createElement(Row, {\n        key,\n        row,\n        rowIndex,\n        trProps\n      });\n    } else {\n      return React.createElement(\"tr\", Object.assign({\n        key: key\n      }, trProps));\n    }\n  }\n\n  function renderBodyCell(row, rowIndex, column, colIndex) {\n    var _a, _b;\n\n    if (spanManager.testSkip(rowIndex, colIndex)) {\n      return null;\n    }\n\n    const value = internals.safeGetValue(column, row, rowIndex);\n    const cellProps = (_b = (_a = column.getCellProps) === null || _a === void 0 ? void 0 : _a.call(column, value, row, rowIndex)) !== null && _b !== void 0 ? _b : {};\n    let cellContent = value;\n\n    if (column.render) {\n      cellContent = column.render(value, row, rowIndex);\n    }\n\n    let colSpan = 1;\n    let rowSpan = 1;\n\n    if (column.getSpanRect) {\n      const spanRect = column.getSpanRect(value, row, rowIndex);\n      colSpan = spanRect == null ? 1 : spanRect.right - colIndex;\n      rowSpan = spanRect == null ? 1 : spanRect.bottom - rowIndex;\n    } else {\n      if (cellProps.colSpan != null) {\n        colSpan = cellProps.colSpan;\n      }\n\n      if (cellProps.rowSpan != null) {\n        rowSpan = cellProps.rowSpan;\n      }\n    } // rowSpan/colSpan 不能过大，避免 rowSpan/colSpan 影响因虚拟滚动而未渲染的单元格\n\n\n    rowSpan = Math.min(rowSpan, verInfo.limit - rowIndex);\n    colSpan = Math.min(colSpan, leftFlatCount + hoz.rightIndex - colIndex);\n    const hasSpan = colSpan > 1 || rowSpan > 1;\n\n    if (hasSpan) {\n      spanManager.add(rowIndex, colIndex, colSpan, rowSpan);\n    }\n\n    const positionStyle = {};\n\n    if (colIndex < leftFlatCount) {\n      positionStyle.position = 'sticky';\n      positionStyle.left = hozInfo.stickyLeftMap.get(colIndex);\n    } else if (colIndex >= fullFlatCount - rightFlatCount) {\n      positionStyle.position = 'sticky';\n      positionStyle.right = hozInfo.stickyRightMap.get(colIndex);\n    }\n\n    const tdProps = Object.assign(Object.assign(Object.assign(Object.assign({}, cellProps), {\n      className: cx(Classes.tableCell, cellProps.className, {\n        first: colIndex === 0,\n        last: colIndex + colSpan === fullFlatCount,\n        'lock-left': colIndex < leftFlatCount,\n        'lock-right': colIndex >= fullFlatCount - rightFlatCount\n      })\n    }), hasSpan ? {\n      colSpan,\n      rowSpan\n    } : null), {\n      style: Object.assign(Object.assign({\n        textAlign: column.align\n      }, cellProps.style), positionStyle),\n      children: cellContent\n    });\n\n    if (Cell != null && tbodyHtmlTag === 'tbody') {\n      return React.createElement(Cell, {\n        key: colIndex,\n        tdProps: tdProps,\n        row: row,\n        rowIndex: rowIndex,\n        column: column,\n        colIndex: colIndex\n      });\n    } else {\n      return React.createElement(\"td\", Object.assign({\n        key: colIndex\n      }, tdProps));\n    }\n  }\n}\n\nconst DefaultLoadingIcon = React.memo(() => React.createElement(\"svg\", {\n  style: {\n    margin: 'auto',\n    display: 'block',\n    width: 40,\n    height: 40\n  },\n  viewBox: \"0 0 100 100\",\n  preserveAspectRatio: \"xMidYMid\"\n}, React.createElement(\"circle\", {\n  cx: \"50\",\n  cy: \"50\",\n  r: \"40\",\n  fill: \"none\",\n  stroke: \"#23a7fa\",\n  strokeDasharray: \"188 64\",\n  strokeLinecap: \"round\",\n  strokeWidth: \"10\"\n}, React.createElement(\"animateTransform\", {\n  attributeName: \"transform\",\n  dur: \"1.5s\",\n  keyTimes: \"0;1\",\n  repeatCount: \"indefinite\",\n  type: \"rotate\",\n  values: \"0 50 50;360 50 50\"\n}))));\n\nfunction DefaultLoadingContentWrapper(_ref10) {\n  let {\n    children,\n    visible\n  } = _ref10;\n  return React.createElement(\"div\", {\n    className: \"art-loading-content-wrapper\",\n    style: {\n      filter: visible ? 'blur(1px)' : 'none'\n    }\n  }, children);\n}\n\nfunction Loading(_ref11) {\n  let {\n    visible,\n    children,\n    LoadingContentWrapper = DefaultLoadingContentWrapper,\n    LoadingIcon = DefaultLoadingIcon\n  } = _ref11;\n  return React.createElement(\"div\", {\n    className: Classes.loadingWrapper\n  }, visible && React.createElement(\"div\", {\n    className: Classes.loadingIndicatorWrapper\n  }, React.createElement(\"div\", {\n    className: Classes.loadingIndicator\n  }, React.createElement(LoadingIcon, null))), React.createElement(LoadingContentWrapper, {\n    visible: visible,\n    children: children\n  }));\n}\n\nlet emptyContentDeprecatedWarned = false;\n\nfunction warnEmptyContentIsDeprecated() {\n  if (!emptyContentDeprecatedWarned) {\n    emptyContentDeprecatedWarned = true;\n    console.warn('[ali-react-table] BaseTable props.emptyContent 已经过时，请使用 props.components.EmptyContent 来自定义数据为空时的表格表现');\n  }\n}\n\nlet flowRootDeprecatedWarned = false;\n\nfunction warnFlowRootIsDeprecated() {\n  if (!flowRootDeprecatedWarned) {\n    flowRootDeprecatedWarned = true;\n    console.warn('[ali-react-table] BaseTable v2.4 版本之后已经不再需要指定 flowRoot');\n  }\n}\n\nclass BaseTable extends React.Component {\n  constructor(props) {\n    super(props);\n    this.rowHeightManager = makeRowHeightManager(this.props.dataSource.length, this.props.estimatedRowHeight);\n    this.artTableWrapperRef = React.createRef();\n    this.rootSubscription = new Subscription();\n    this.state = {\n      hasScroll: true,\n      needRenderLock: true,\n      offsetY: 0,\n      offsetX: 0,\n      // 因为 ResizeObserver 在一开始总是会调用一次所提供的回调函数\n      // 故这里为 maxRenderHeight/maxRenderWidth 设置一个默认值即可（因为这两个默认值很快就会被覆盖）\n      // https://stackoverflow.com/questions/60026223/does-resizeobserver-invokes-initially-on-page-load\n      maxRenderHeight: 600,\n      maxRenderWidth: 800\n    };\n  }\n  /** @deprecated BaseTable.getDoms() 已经过时，请勿调用 */\n\n\n  getDoms() {\n    console.warn('[ali-react-table] BaseTable.getDoms() 已经过时');\n    return this.domHelper;\n  }\n  /** 自定义滚动条宽度为table宽度，使滚动条滑块宽度相同 */\n\n\n  updateStickyScroll() {\n    const {\n      stickyScroll,\n      artTable,\n      stickyScrollItem\n    } = this.domHelper;\n\n    if (!artTable) {\n      return;\n    }\n\n    const tableBodyHtmlTable = this.domHelper.getTableBodyHtmlTable();\n    const innerTableWidth = tableBodyHtmlTable.offsetWidth;\n    const artTableWidth = artTable.offsetWidth;\n    const stickyScrollHeightProp = this.props.stickyScrollHeight;\n    const stickyScrollHeight = stickyScrollHeightProp === 'auto' ? getScrollbarSize().height : stickyScrollHeightProp;\n    stickyScroll.style.marginTop = `-${stickyScrollHeight + 1}px`;\n\n    if (artTableWidth >= innerTableWidth) {\n      if (this.state.hasScroll) {\n        this.setState({\n          hasScroll: false\n        });\n      }\n    } else {\n      if (!this.state.hasScroll && stickyScrollHeight > 5) {\n        // 考虑下mac下面隐藏滚动条的情况\n        this.setState({\n          hasScroll: true\n        });\n      }\n    } // 设置子节点宽度\n\n\n    stickyScrollItem.style.width = `${innerTableWidth}px`;\n  }\n\n  renderTableHeader(info) {\n    const {\n      stickyTop,\n      hasHeader\n    } = this.props;\n    return React.createElement(\"div\", {\n      className: cx(Classes.tableHeader, 'no-scrollbar'),\n      style: {\n        top: stickyTop === 0 ? undefined : stickyTop,\n        display: hasHeader ? undefined : 'none'\n      }\n    }, React.createElement(TableHeader, {\n      info: info\n    }));\n  }\n\n  updateOffsetX(nextOffsetX) {\n    if (this.lastInfo.useVirtual.horizontal) {\n      if (Math.abs(nextOffsetX - this.state.offsetX) >= OVERSCAN_SIZE / 2) {\n        this.setState({\n          offsetX: nextOffsetX\n        });\n      }\n    }\n  }\n\n  syncHorizontalScrollFromTableBody() {\n    this.syncHorizontalScroll(this.domHelper.tableBody.scrollLeft);\n  }\n  /** 同步横向滚动偏移量 */\n\n\n  syncHorizontalScroll(x) {\n    this.updateOffsetX(x);\n    const {\n      tableBody\n    } = this.domHelper;\n    const {\n      flat\n    } = this.lastInfo;\n    const leftLockShadow = this.domHelper.getLeftLockShadow();\n\n    if (leftLockShadow) {\n      const shouldShowLeftLockShadow = flat.left.length > 0 && this.state.needRenderLock && x > 0;\n\n      if (shouldShowLeftLockShadow) {\n        leftLockShadow.classList.add('show-shadow');\n      } else {\n        leftLockShadow.classList.remove('show-shadow');\n      }\n    }\n\n    const rightLockShadow = this.domHelper.getRightLockShadow();\n\n    if (rightLockShadow) {\n      const shouldShowRightLockShadow = flat.right.length > 0 && this.state.needRenderLock && x < tableBody.scrollWidth - tableBody.clientWidth;\n\n      if (shouldShowRightLockShadow) {\n        rightLockShadow.classList.add('show-shadow');\n      } else {\n        rightLockShadow.classList.remove('show-shadow');\n      }\n    }\n  }\n\n  getVerticalRenderRange(useVirtual) {\n    const {\n      dataSource\n    } = this.props;\n    const {\n      offsetY,\n      maxRenderHeight\n    } = this.state;\n    const rowCount = dataSource.length;\n\n    if (useVirtual.vertical) {\n      return this.rowHeightManager.getRenderRange(offsetY, maxRenderHeight, rowCount);\n    } else {\n      return getFullRenderRange(rowCount);\n    }\n  }\n\n  renderTableBody(info) {\n    const {\n      dataSource,\n      getRowProps,\n      primaryKey,\n      isLoading,\n      emptyCellHeight,\n      footerDataSource,\n      components\n    } = this.props;\n    const tableBodyClassName = cx(Classes.tableBody, Classes.horizontalScrollContainer, {\n      'no-scrollbar': footerDataSource.length > 0\n    });\n\n    if (dataSource.length === 0) {\n      const {\n        components,\n        emptyContent\n      } = this.props;\n      let EmptyContent = components.EmptyContent;\n\n      if (EmptyContent == null && emptyContent != null) {\n        warnEmptyContentIsDeprecated();\n\n        EmptyContent = () => emptyContent;\n      }\n\n      return React.createElement(\"div\", {\n        className: tableBodyClassName\n      }, React.createElement(EmptyHtmlTable, {\n        descriptors: info.visible,\n        isLoading: isLoading,\n        EmptyContent: EmptyContent,\n        emptyCellHeight: emptyCellHeight\n      }));\n    }\n\n    const {\n      topIndex,\n      bottomBlank,\n      topBlank,\n      bottomIndex\n    } = info.verticalRenderRange;\n    return React.createElement(\"div\", {\n      className: tableBodyClassName\n    }, topBlank > 0 && React.createElement(\"div\", {\n      key: \"top-blank\",\n      className: cx(Classes.virtualBlank, 'top'),\n      style: {\n        height: topBlank\n      }\n    }), React.createElement(HtmlTable, {\n      components: components,\n      tbodyHtmlTag: \"tbody\",\n      getRowProps: getRowProps,\n      primaryKey: primaryKey,\n      data: dataSource.slice(topIndex, bottomIndex),\n      horizontalRenderInfo: info,\n      verticalRenderInfo: {\n        first: 0,\n        offset: topIndex,\n        limit: bottomIndex,\n        last: dataSource.length - 1\n      }\n    }), bottomBlank > 0 && React.createElement(\"div\", {\n      key: \"bottom-blank\",\n      className: cx(Classes.virtualBlank, 'bottom'),\n      style: {\n        height: bottomBlank\n      }\n    }));\n  }\n\n  renderTableFooter(info) {\n    const {\n      footerDataSource = [],\n      getRowProps,\n      primaryKey,\n      stickyBottom,\n      components\n    } = this.props;\n    return React.createElement(\"div\", {\n      className: cx(Classes.tableFooter, Classes.horizontalScrollContainer),\n      style: {\n        bottom: stickyBottom === 0 ? undefined : stickyBottom\n      }\n    }, React.createElement(HtmlTable, {\n      components: components,\n      tbodyHtmlTag: \"tfoot\",\n      data: footerDataSource,\n      horizontalRenderInfo: info,\n      getRowProps: getRowProps,\n      primaryKey: primaryKey,\n      verticalRenderInfo: {\n        offset: 0,\n        first: 0,\n        last: footerDataSource.length - 1,\n        limit: Infinity\n      }\n    }));\n  }\n\n  renderLockShadows(info) {\n    return React.createElement(React.Fragment, null, React.createElement(\"div\", {\n      className: Classes.lockShadowMask,\n      style: {\n        left: 0,\n        width: info.leftLockTotalWidth + LOCK_SHADOW_PADDING\n      }\n    }, React.createElement(\"div\", {\n      className: cx(Classes.lockShadow, Classes.leftLockShadow)\n    })), React.createElement(\"div\", {\n      className: Classes.lockShadowMask,\n      style: {\n        right: 0,\n        width: info.rightLockTotalWidth + LOCK_SHADOW_PADDING\n      }\n    }, React.createElement(\"div\", {\n      className: cx(Classes.lockShadow, Classes.rightLockShadow)\n    })));\n  }\n\n  renderStickyScroll(info) {\n    const {\n      hasStickyScroll,\n      stickyBottom\n    } = this.props;\n    const {\n      hasScroll\n    } = this.state;\n    return React.createElement(\"div\", {\n      className: cx(Classes.stickyScroll, Classes.horizontalScrollContainer),\n      style: {\n        display: hasStickyScroll && hasScroll ? 'block' : 'none',\n        bottom: stickyBottom\n      }\n    }, React.createElement(\"div\", {\n      className: Classes.stickyScrollItem\n    }));\n  }\n\n  render() {\n    const info = calculateRenderInfo(this);\n    this.lastInfo = info;\n    const {\n      dataSource,\n      className,\n      style,\n      hasHeader,\n      useOuterBorder,\n      isStickyHead,\n      isStickyHeader,\n      isStickyFooter,\n      isLoading,\n      footerDataSource,\n      components,\n      flowRoot\n    } = this.props;\n\n    if (flowRoot != null) {\n      warnFlowRootIsDeprecated();\n    }\n\n    const artTableWrapperClassName = cx(Classes.artTableWrapper, {\n      'use-outer-border': useOuterBorder,\n      empty: dataSource.length === 0,\n      lock: info.hasLockColumn,\n      'has-header': hasHeader,\n      'sticky-header': isStickyHeader !== null && isStickyHeader !== void 0 ? isStickyHeader : isStickyHead,\n      'has-footer': footerDataSource.length > 0,\n      'sticky-footer': isStickyFooter\n    }, className);\n    const artTableWrapperProps = {\n      className: artTableWrapperClassName,\n      style,\n      [STYLED_REF_PROP]: this.artTableWrapperRef\n    };\n    return React.createElement(StyledArtTableWrapper, Object.assign({}, artTableWrapperProps), React.createElement(Loading, {\n      visible: isLoading,\n      LoadingIcon: components.LoadingIcon,\n      LoadingContentWrapper: components.LoadingContentWrapper\n    }, React.createElement(\"div\", {\n      className: Classes.artTable\n    }, this.renderTableHeader(info), this.renderTableBody(info), this.renderTableFooter(info), this.renderLockShadows(info)), this.renderStickyScroll(info)));\n  }\n\n  componentDidMount() {\n    this.updateDOMHelper();\n    this.props$ = new BehaviorSubject(this.props);\n    this.initSubscriptions();\n    this.didMountOrUpdate();\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    this.updateDOMHelper();\n    this.props$.next(this.props);\n    this.didMountOrUpdate(prevProps, prevState);\n  }\n\n  didMountOrUpdate(prevProps, prevState) {\n    this.syncHorizontalScrollFromTableBody();\n    this.updateStickyScroll();\n    this.adjustNeedRenderLock();\n    this.updateRowHeightManager();\n    this.updateScrollLeftWhenLayoutChanged(prevProps, prevState);\n  }\n\n  updateScrollLeftWhenLayoutChanged(prevProps, prevState) {\n    if (prevState != null) {\n      if (!prevState.hasScroll && this.state.hasScroll) {\n        this.domHelper.stickyScroll.scrollLeft = 0;\n      }\n    }\n\n    if (prevProps != null) {\n      const prevHasFooter = prevProps.footerDataSource.length > 0;\n      const currentHasFooter = this.props.footerDataSource.length > 0;\n\n      if (!prevHasFooter && currentHasFooter) {\n        this.domHelper.tableFooter.scrollLeft = this.domHelper.tableBody.scrollLeft;\n      }\n    }\n  }\n\n  initSubscriptions() {\n    const {\n      tableHeader,\n      tableBody,\n      tableFooter,\n      stickyScroll\n    } = this.domHelper;\n    this.rootSubscription.add(throttledWindowResize$.subscribe(() => {\n      this.updateStickyScroll();\n      this.adjustNeedRenderLock();\n    })); // 滚动同步\n\n    this.rootSubscription.add(syncScrollLeft([tableHeader, tableBody, tableFooter, stickyScroll], scrollLeft => {\n      this.syncHorizontalScroll(scrollLeft);\n    }));\n    const richVisibleRects$ = getRichVisibleRectsStream(this.domHelper.artTable, this.props$.pipe(op.skip(1), op.mapTo('structure-may-change')), this.props.virtualDebugLabel).pipe(op.shareReplay()); // 每当可见部分发生变化的时候，调整 loading icon 的未知（如果 loading icon 存在的话）\n\n    this.rootSubscription.add(combineLatest([richVisibleRects$.pipe(op.map(p => p.clipRect), op.distinctUntilChanged(shallowEqual)), this.props$.pipe(op.startWith(null), op.pairwise(), op.filter(_ref12 => {\n      let [prevProps, props] = _ref12;\n      return prevProps == null || !prevProps.isLoading && props.isLoading;\n    }))]).subscribe(_ref13 => {\n      let [clipRect] = _ref13;\n      const loadingIndicator = this.domHelper.getLoadingIndicator();\n\n      if (!loadingIndicator) {\n        return;\n      }\n\n      const height = clipRect.bottom - clipRect.top; // fixme 这里的定位在有些特殊情况下可能会出错 see #132\n\n      loadingIndicator.style.top = `${height / 2}px`;\n      loadingIndicator.style.marginTop = `${height / 2}px`;\n    })); // 每当可见部分发生变化的时候，如果开启了虚拟滚动，则重新触发 render\n\n    this.rootSubscription.add(richVisibleRects$.pipe(op.filter(() => {\n      const {\n        horizontal,\n        vertical\n      } = this.lastInfo.useVirtual;\n      return horizontal || vertical;\n    }), op.map(_ref14 => {\n      let {\n        clipRect,\n        offsetY\n      } = _ref14;\n      return {\n        maxRenderHeight: clipRect.bottom - clipRect.top,\n        maxRenderWidth: clipRect.right - clipRect.left,\n        offsetY\n      };\n    }), op.distinctUntilChanged((x, y) => {\n      // 因为 overscan 的存在，滚动较小的距离时不需要触发组件重渲染\n      return Math.abs(x.maxRenderWidth - y.maxRenderWidth) < OVERSCAN_SIZE / 2 && Math.abs(x.maxRenderHeight - y.maxRenderHeight) < OVERSCAN_SIZE / 2 && Math.abs(x.offsetY - y.offsetY) < OVERSCAN_SIZE / 2;\n    })).subscribe(sizeAndOffset => {\n      this.setState(sizeAndOffset);\n    }));\n  }\n\n  componentWillUnmount() {\n    this.rootSubscription.unsubscribe();\n  }\n  /** 更新 DOM 节点的引用，方便其他方法直接操作 DOM */\n\n\n  updateDOMHelper() {\n    this.domHelper = new TableDOMHelper(this.artTableWrapperRef.current);\n  }\n\n  updateRowHeightManager() {\n    var _a;\n\n    const virtualTop = this.domHelper.getVirtualTop();\n    const virtualTopHeight = (_a = virtualTop === null || virtualTop === void 0 ? void 0 : virtualTop.clientHeight) !== null && _a !== void 0 ? _a : 0;\n    let zeroHeightRowCount = 0;\n    let maxRowIndex = -1;\n    let maxRowBottom = -1;\n\n    for (const tr of this.domHelper.getTableRows()) {\n      const rowIndex = Number(tr.dataset.rowindex);\n\n      if (isNaN(rowIndex)) {\n        continue;\n      }\n\n      maxRowIndex = Math.max(maxRowIndex, rowIndex);\n      const offset = tr.offsetTop + virtualTopHeight;\n      const size = tr.offsetHeight;\n\n      if (size === 0) {\n        zeroHeightRowCount += 1;\n      }\n\n      maxRowBottom = Math.max(maxRowBottom, offset + size);\n      this.rowHeightManager.updateRow(rowIndex, offset, size);\n    } // 当 estimatedRowHeight 过大时，可能出现「渲染行数过少，无法覆盖可视范围」的情况\n    // 出现这种情况时，我们判断「下一次渲染能够渲染更多行」是否满足，满足的话就直接调用 forceUpdate\n    // zeroHeightRowCount === 0 用于确保当前没有 display=none 的情况\n\n\n    if (maxRowIndex !== -1 && zeroHeightRowCount === 0) {\n      if (maxRowBottom < this.state.offsetY + this.state.maxRenderHeight) {\n        const vertical = this.getVerticalRenderRange(this.lastInfo.useVirtual);\n\n        if (vertical.bottomIndex - 1 > maxRowIndex) {\n          this.forceUpdate();\n        }\n      }\n    }\n  }\n  /** 计算表格所有列的渲染宽度之和，判断表格是否需要渲染锁列 */\n\n\n  adjustNeedRenderLock() {\n    const {\n      needRenderLock\n    } = this.state;\n    const {\n      flat,\n      hasLockColumn\n    } = this.lastInfo;\n\n    if (hasLockColumn) {\n      const sumOfColWidth = sum(flat.full.map(col => col.width));\n      const nextNeedRenderLock = sumOfColWidth > this.domHelper.artTable.clientWidth;\n\n      if (needRenderLock !== nextNeedRenderLock) {\n        this.setState({\n          needRenderLock: nextNeedRenderLock\n        });\n      }\n    } else {\n      if (needRenderLock) {\n        this.setState({\n          needRenderLock: false\n        });\n      }\n    }\n  }\n\n}\n\nBaseTable.defaultProps = {\n  hasHeader: true,\n  isStickyHeader: true,\n  stickyTop: 0,\n  footerDataSource: [],\n  isStickyFooter: true,\n  stickyBottom: 0,\n  hasStickyScroll: true,\n  stickyScrollHeight: 'auto',\n  useVirtual: 'auto',\n  estimatedRowHeight: 48,\n  isLoading: false,\n  components: {},\n  getRowProps: noop,\n  dataSource: []\n};\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n\nfunction __rest(s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n}\n\nconst InlineFlexCell = styled__default.div`\n  display: inline-flex;\n  align-items: center;\n`;\nconst ExpansionCell = styled__default(InlineFlexCell)`\n  &.leaf {\n    cursor: default;\n  }\n\n  .expansion-icon {\n    fill: #999;\n    flex: 0 0 16px;\n    transition: transform 200ms;\n\n    &.expanded {\n      transform-origin: center center;\n      transform: rotate(90deg);\n    }\n  }\n`;\n\nfunction CaretDownIcon(props) {\n  return React.createElement(\"svg\", Object.assign({\n    focusable: \"false\",\n    preserveAspectRatio: \"xMidYMid meet\",\n    fill: \"currentColor\",\n    width: \"16\",\n    height: \"16\",\n    viewBox: \"0 0 32 32\"\n  }, props), React.createElement(\"path\", {\n    d: \"M24 12L16 22 8 12z\"\n  }));\n}\n\nfunction InfoIcon(props) {\n  return React.createElement(\"svg\", Object.assign({\n    focusable: \"false\",\n    preserveAspectRatio: \"xMidYMid meet\",\n    fill: \"currentColor\",\n    width: \"16\",\n    height: \"16\",\n    viewBox: \"0 0 16 16\"\n  }, props), React.createElement(\"path\", {\n    d: \"M8.5 11L8.5 6.5 6.5 6.5 6.5 7.5 7.5 7.5 7.5 11 6 11 6 12 10 12 10 11zM8 3.5c-.4 0-.8.3-.8.8S7.6 5 8 5c.4 0 .8-.3.8-.8S8.4 3.5 8 3.5z\"\n  }), React.createElement(\"path\", {\n    d: \"M8,15c-3.9,0-7-3.1-7-7s3.1-7,7-7s7,3.1,7,7S11.9,15,8,15z M8,2C4.7,2,2,4.7,2,8s2.7,6,6,6s6-2.7,6-6S11.3,2,8,2z\"\n  }));\n}\n\nfunction CaretRightIcon(props) {\n  return React.createElement(\"svg\", Object.assign({\n    focusable: \"false\",\n    preserveAspectRatio: \"xMidYMid meet\",\n    fill: \"currentColor\",\n    width: \"16\",\n    height: \"16\",\n    viewBox: \"0 0 32 32\"\n  }, props), React.createElement(\"path\", {\n    d: \"M12 8L22 16 12 24z\"\n  }));\n}\n\nfunction LoadingIcon(props) {\n  return React.createElement(\"svg\", Object.assign({\n    width: \"16\",\n    height: \"16\",\n    fill: \"currentColor\",\n    viewBox: \"0 0 1024 1024\"\n  }, props), React.createElement(\"path\", {\n    d: \"M512 74.667c-17.067 0-32 14.933-32 32V256c0 17.067 14.933 32 32 32s32-14.933 32-32V106.667c0-17.067-14.933-32-32-32zm181.333 288c8.534 0 17.067-2.134 23.467-8.534L821.333 249.6c12.8-12.8 12.8-32 0-44.8-12.8-12.8-32-12.8-44.8 0L672 309.333c-12.8 12.8-12.8 32 0 44.8 4.267 6.4 12.8 8.534 21.333 8.534zm224 117.333H768c-17.067 0-32 14.933-32 32s14.933 32 32 32h149.333c17.067 0 32-14.933 32-32s-14.933-32-32-32zM714.667 669.867c-12.8-12.8-32-12.8-44.8 0s-12.8 32 0 44.8L774.4 819.2c6.4 6.4 14.933 8.533 23.467 8.533s17.066-2.133 23.466-8.533c12.8-12.8 12.8-32 0-44.8L714.667 669.867zM512 736c-17.067 0-32 14.933-32 32v149.333c0 17.067 14.933 32 32 32s32-14.933 32-32V768c0-17.067-14.933-32-32-32zm-202.667-66.133L204.8 774.4c-12.8 12.8-12.8 32 0 44.8 6.4 6.4 14.933 8.533 23.467 8.533s17.066-2.133 23.466-8.533l104.534-104.533c12.8-12.8 12.8-32 0-44.8s-36.267-12.8-46.934 0zM288 512c0-17.067-14.933-32-32-32H106.667c-17.067 0-32 14.933-32 32s14.933 32 32 32H256c17.067 0 32-14.933 32-32zm-40.533-309.333c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8L307.2 352c6.4 6.4 14.933 8.533 23.467 8.533s17.066-2.133 23.466-8.533c12.8-12.8 12.8-32 0-44.8L247.467 202.667z\"\n  }));\n}\n\nconst icons = {\n  Loading: LoadingIcon,\n  CaretDown: CaretDownIcon,\n  CaretRight: CaretRightIcon,\n  Info: InfoIcon\n};\nconst treeMetaSymbol = Symbol('treeMetaSymbol');\n\nfunction treeMode() {\n  let opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return function treeModeStep(pipeline) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n\n    const stateKey = 'treeMode';\n    const ctx = pipeline.ctx;\n    const primaryKey = pipeline.ensurePrimaryKey('treeMode');\n\n    if (typeof primaryKey !== 'string') {\n      throw new Error('treeMode 仅支持字符串作为 primaryKey');\n    }\n\n    const openKeys = (_c = (_b = (_a = opts.openKeys) !== null && _a !== void 0 ? _a : pipeline.getStateAtKey(stateKey)) !== null && _b !== void 0 ? _b : opts.defaultOpenKeys) !== null && _c !== void 0 ? _c : [];\n    const openKeySet = new Set(openKeys);\n\n    const onChangeOpenKeys = (nextKeys, key, action) => {\n      var _a;\n\n      (_a = opts.onChangeOpenKeys) === null || _a === void 0 ? void 0 : _a.call(opts, nextKeys, key, action);\n      pipeline.setStateAtKey(stateKey, nextKeys, {\n        key,\n        action\n      });\n    };\n\n    const toggle = rowKey => {\n      const expanded = openKeySet.has(rowKey);\n\n      if (expanded) {\n        onChangeOpenKeys(openKeys.filter(key => key !== rowKey), rowKey, 'collapse');\n      } else {\n        onChangeOpenKeys([...openKeys, rowKey], rowKey, 'expand');\n      }\n    };\n\n    const isLeafNode$1 = (_d = opts.isLeafNode) !== null && _d !== void 0 ? _d : isLeafNode;\n    const clickArea = (_e = opts.clickArea) !== null && _e !== void 0 ? _e : 'cell';\n    const treeMetaKey = (_f = opts.treeMetaKey) !== null && _f !== void 0 ? _f : treeMetaSymbol;\n    const stopClickEventPropagation = Boolean(opts.stopClickEventPropagation); // indents\n\n    const iconWidth = ctx.indents.iconWidth;\n    const iconIndent = (_g = opts.iconIndent) !== null && _g !== void 0 ? _g : ctx.indents.iconIndent;\n    const iconGap = (_h = opts.iconGap) !== null && _h !== void 0 ? _h : ctx.indents.iconGap;\n    const indentSize = (_j = opts.indentSize) !== null && _j !== void 0 ? _j : ctx.indents.indentSize;\n    return pipeline.mapDataSource(processDataSource).mapColumns(processColumns);\n\n    function processDataSource(input) {\n      const result = [];\n      dfs(input, 0);\n\n      function dfs(nodes, depth) {\n        if (nodes == null) {\n          return;\n        }\n\n        for (const node of nodes) {\n          const rowKey = node[primaryKey];\n          const expanded = openKeySet.has(rowKey);\n          const isLeaf = isLeafNode$1(node, {\n            depth,\n            expanded,\n            rowKey\n          });\n          const treeMeta = {\n            depth,\n            isLeaf,\n            expanded,\n            rowKey\n          };\n          result.push(Object.assign({\n            [treeMetaKey]: treeMeta\n          }, node));\n\n          if (!isLeaf && expanded) {\n            dfs(node.children, depth + 1);\n          }\n        }\n      }\n\n      return result;\n    }\n\n    function processColumns(columns) {\n      if (columns.length === 0) {\n        return columns;\n      }\n\n      const [firstCol, ...others] = columns;\n\n      const render = (value, record, recordIndex) => {\n        const content = internals.safeRender(firstCol, record, recordIndex);\n\n        if (record[treeMetaKey] == null) {\n          // 没有 treeMeta 信息的话，就返回原先的渲染结果\n          return content;\n        }\n\n        const {\n          rowKey,\n          depth,\n          isLeaf,\n          expanded\n        } = record[treeMetaKey];\n        const indent = iconIndent + depth * indentSize;\n\n        if (isLeaf) {\n          return React.createElement(InlineFlexCell, {\n            className: \"expansion-cell leaf\"\n          }, React.createElement(\"span\", {\n            style: {\n              marginLeft: indent + iconWidth + iconGap\n            }\n          }, content));\n        }\n\n        const onClick = e => {\n          if (stopClickEventPropagation) {\n            e.stopPropagation();\n          }\n\n          toggle(rowKey);\n        };\n\n        const expandCls = expanded ? 'expanded' : 'collapsed';\n        return React.createElement(ExpansionCell, {\n          className: cx('expansion-cell', expandCls),\n          style: {\n            cursor: clickArea === 'content' ? 'pointer' : undefined\n          },\n          onClick: clickArea === 'content' ? onClick : undefined\n        }, React.createElement(icons.CaretRight, {\n          className: cx('expansion-icon', expandCls),\n          style: {\n            cursor: clickArea === 'icon' ? 'pointer' : undefined,\n            marginLeft: indent,\n            marginRight: iconGap\n          },\n          onClick: clickArea === 'icon' ? onClick : undefined\n        }), content);\n      };\n\n      const getCellProps = (value, record, rowIndex) => {\n        const prevProps = internals.safeGetCellProps(firstCol, record, rowIndex);\n\n        if (record[treeMetaKey] == null) {\n          // 没有 treeMeta 信息的话，就返回原先的 cellProps\n          return prevProps;\n        }\n\n        const {\n          isLeaf,\n          rowKey\n        } = record[treeMetaKey];\n\n        if (isLeaf) {\n          return prevProps;\n        }\n\n        return mergeCellProps(prevProps, {\n          onClick(e) {\n            if (stopClickEventPropagation) {\n              e.stopPropagation();\n            }\n\n            toggle(rowKey);\n          },\n\n          style: {\n            cursor: 'pointer'\n          }\n        });\n      };\n\n      return [Object.assign(Object.assign({}, firstCol), {\n        title: React.createElement(\"span\", {\n          style: {\n            marginLeft: iconIndent + iconWidth + iconGap\n          }\n        }, internals.safeRenderHeader(firstCol)),\n        render,\n        getCellProps: clickArea === 'cell' ? getCellProps : firstCol.getCellProps\n      }), ...others];\n    }\n  };\n}\n/**\r\n * 表格数据处理流水线。TablePipeline 提供了表格数据处理过程中的一些上下方与工具方法，包括……\r\n *\r\n * 1. ctx：上下文环境对象，step（流水线上的一步）可以对 ctx 中的字段进行读写。\r\n * ctx 中部分字段名称有特定的含义（例如 primaryKey 表示行的主键），使用自定义的上下文信息时注意避开这些名称。\r\n *\r\n * 2. rowPropsGetters：getRowProps 回调队列，step 可以通过 pipeline.appendRowPropsGetter 向队列中追加回调函数，\r\n *   在调用 pipeline.props() 队列中的所有函数会组合形成最终的 getRowProps\r\n *\r\n * 3. 当前流水线的状态，包括 dataSource, columns, rowPropsGetters 三个部分\r\n *\r\n * 4. snapshots，调用 pipeline.snapshot(name) 可以记录当前的状态，后续可以通过 name 来读取保存的状态\r\n * */\n\n\nclass TablePipeline {\n  constructor(_ref15) {\n    let {\n      state,\n      setState,\n      ctx\n    } = _ref15;\n    this._snapshots = {};\n    this._rowPropsGetters = [];\n    this.ctx = {\n      components: {},\n      indents: TablePipeline.defaultIndents\n    };\n    this.state = state;\n    this.setState = setState;\n    Object.assign(this.ctx, ctx);\n  }\n\n  appendRowPropsGetter(getter) {\n    this._rowPropsGetters.push(getter);\n\n    return this;\n  }\n\n  getDataSource(name) {\n    if (name == null) {\n      return this._dataSource;\n    } else {\n      return this._snapshots[name].dataSource;\n    }\n  }\n\n  getColumns(name) {\n    if (name == null) {\n      return this._columns;\n    } else {\n      return this._snapshots[name].columns;\n    }\n  }\n\n  getStateAtKey(stateKey, defaultValue) {\n    var _a;\n\n    return (_a = this.state[stateKey]) !== null && _a !== void 0 ? _a : defaultValue;\n  }\n  /** 将 stateKey 对应的状态设置为 partialState  */\n\n\n  setStateAtKey(stateKey, partialState, extraInfo) {\n    this.setState(prev => Object.assign(Object.assign({}, prev), {\n      [stateKey]: partialState\n    }), stateKey, partialState, extraInfo);\n  }\n  /** 确保 primaryKey 已被设置，并返回 primaryKey  */\n\n\n  ensurePrimaryKey(hint) {\n    if (this.ctx.primaryKey == null) {\n      throw new Error(hint ? `使用 ${hint} 之前必须先设置 primaryKey` : '必须先设置 primaryKey');\n    }\n\n    return this.ctx.primaryKey;\n  }\n  /** 设置流水线的输入数据 */\n\n\n  input(input) {\n    if (this._dataSource != null || this._columns != null) {\n      throw new Error('input 不能调用两次');\n    }\n\n    this._dataSource = input.dataSource;\n    this._columns = input.columns;\n    this.snapshot('input');\n    return this;\n  }\n  /** 设置 dataSource */\n\n\n  dataSource(rows) {\n    this._dataSource = rows;\n    return this;\n  }\n  /** 设置 columns */\n\n\n  columns(cols) {\n    this._columns = cols;\n    return this;\n  }\n  /** 设置主键 */\n\n\n  primaryKey(key) {\n    this.ctx.primaryKey = key;\n    return this;\n  }\n  /** 保存快照 */\n\n\n  snapshot(name) {\n    this._snapshots[name] = {\n      dataSource: this._dataSource,\n      columns: this._columns,\n      rowPropsGetters: this._rowPropsGetters.slice()\n    };\n    return this;\n  }\n  /** @deprecated\r\n   *  应用一个 ali-react-table Table transform */\n\n\n  useTransform(transform) {\n    const next = transform({\n      dataSource: this.getDataSource(),\n      columns: this.getColumns()\n    });\n    return this.dataSource(next.dataSource).columns(next.columns);\n  }\n  /** 使用 pipeline 功能拓展 */\n\n\n  use(step) {\n    return step(this);\n  }\n  /** 转换 dataSource */\n\n\n  mapDataSource(mapper) {\n    return this.dataSource(mapper(this.getDataSource()));\n  }\n  /** 转换 columns */\n\n\n  mapColumns(mapper) {\n    return this.columns(mapper(this.getColumns()));\n  }\n  /** 获取 BaseTable 的 props，结果中包含 dataSource/columns/primaryKey/getRowProps 四个字段 */\n\n\n  getProps() {\n    const result = {\n      dataSource: this._dataSource,\n      columns: this._columns\n    };\n\n    if (this.ctx.primaryKey) {\n      result.primaryKey = this.ctx.primaryKey;\n    }\n\n    if (this._rowPropsGetters.length > 0) {\n      result.getRowProps = (row, rowIndex) => {\n        return this._rowPropsGetters.reduce((res, get) => {\n          return mergeCellProps(res, get(row, rowIndex));\n        }, {});\n      };\n    }\n\n    return result;\n  }\n\n}\n\nTablePipeline.defaultIndents = {\n  iconIndent: -8,\n  iconWidth: 16,\n  iconGap: 0,\n  indentSize: 16\n};\n\nfunction useTablePipeline(ctx) {\n  const [state, setState] = useState({});\n  return new TablePipeline({\n    state,\n    setState,\n    ctx\n  });\n}\n\nexport { BaseTable as B, Classes as C, ExpansionCell as E, InlineFlexCell as I, SpanManager as S, TablePipeline as T, __rest as _, internals as a, icons as b, collectNodes as c, arrayUtils as d, always as e, flatMap as f, getTreeDepth as g, treeMetaSymbol as h, isLeafNode as i, groupBy2 as j, fromEntries as k, mergeCellProps as m, treeMode as t, useTablePipeline as u };","map":{"version":3,"sources":["D:/ZJU5/软件工程管理/frontend/node_modules/ali-react-table/dist/chunks/ali-react-table-pipeline-72600030.esm.js"],"names":["cx","React","useState","defer","fromEvent","asyncScheduler","BehaviorSubject","Subscription","merge","Observable","combineLatest","noop","op","throttleTime","map","styled","styled__default","css","ResizeObserver","isLeafNode","node","children","length","collectNodes","nodes","order","result","dfs","push","getTreeDepth","maxDepth","columns","depth","column","Math","max","groupBy2","list","iteratee","groups","Map","item","key","has","set","get","flatMap","array","callback","forEach","value","index","fromEntries","entries","arrayUtils","diff","arr1","arr2","Set","filter","x","concat","always","SpanManager","constructor","rects","testSkip","rowIndex","colIndex","some","left","right","top","bottom","stripUpwards","rect","add","colSpan","rowSpan","safeRenderHeader","_a","title","name","safeGetValue","record","getValue","code","safeGetRowKey","primaryKey","String","safeGetCellProps","getCellProps","safeRender","render","internals","composeEventHandler","handler1","handler2","args","mergeCellProps","base","extra","Object","assign","keys","type","undefined","prev","STYLED_VERSION","createGlobalStyle","STYLED_REF_PROP","OVERSCAN_SIZE","AUTO_VIRTUAL_THRESHOLD","sum","arr","throttledWindowResize$","window","passive","pipe","leading","trailing","getScrollbarSizeImpl","scrollDiv","document","createElement","style","position","width","height","overflow","body","appendChild","scrollbarWidth","offsetWidth","clientWidth","scrollbarHeight","offsetHeight","clientHeight","removeChild","scrollBarSize$","getScrollbarSize","subscribe","syncScrollLeft","elements","bypassSet","publishScrollLeft","origin","scrollLeft","clear","elem","subscription","ele","listener","delete","addEventListener","removeEventListener","shallowEqual","objA","objB","hasOwnProperty","prototype","is","keysA","keysB","i","call","resolveVirtualEnabled","virtualEnum","defaultValue","lockColumnNeedSpecifiedWidthWarned","warnLockColumnNeedSpecifiedWidth","console","warn","columnHiddenDeprecatedWarned","warnColumnHiddenDeprecated","processColumns","defaultColumnWidth","Array","isArray","process","env","NODE_ENV","lock","hidden","nextChildren","getLeftNestedLockCount","nestedCount","col","isLock","getHorizontalRenderRange","offsetX","maxRenderWidth","flat","useVirtual","horizontal","leftIndex","leftBlank","rightIndex","full","rightBlank","centerCount","centerRenderWidth","overscannedOffsetX","center","minCenterRenderWidth","rightBlankCount","slice","calculateRenderInfo","table","state","useVirtualProp","columnsProp","dataSource","dataSourceProp","props","leftNestedLockCount","fullFlat","nested","vertical","header","leftNested","rightNestedLockCount","reverse","centerNested","rightNested","shouldEnableHozVirtual","every","shouldEnableVerVirtual","horizontalRenderRange","verticalRenderRange","getVerticalRenderRange","unfilteredVisibleColumnDescriptors","blankSide","visibleColumnDescriptors","Boolean","fullFlatCount","leftFlatCount","rightFlatCount","stickyLeftMap","stickyLeft","stickyRightMap","stickyRight","leftLockTotalWidth","rightLockTotalWidth","visible","hasLockColumn","Colgroup","descriptors","descriptor","LOCK_SHADOW_PADDING","prefix","Classes","artTableWrapper","artTable","tableHeader","tableBody","tableFooter","tableRow","tableHeaderRow","tableCell","tableHeaderCell","virtualBlank","stickyScroll","stickyScrollItem","horizontalScrollContainer","lockShadowMask","lockShadow","leftLockShadow","rightLockShadow","emptyWrapper","loadingWrapper","loadingIndicatorWrapper","loadingIndicator","Z","footer","scrollItem","outerBorderStyleMixin","StyledArtTableWrapper","div","DefaultEmptyContent","memo","Fragment","alt","className","src","EmptyHtmlTable","isLoading","emptyCellHeight","EmptyContent","show","range","n","filterNestedCenter","hoz","filtered","cols","startColIndex","leafCount","dfsRes","calculateLeveledAndFlat","inputNested","rowCount","leveled","input","indexedCol","wrapped","isLeaf","attachColIndex","colIndexOffset","sub","calculateHeaderRenderInfo","leftPart","centerPart","rightPart","TableHeader","info","headerRenderInfo","thead","wrappedCols","level","headerCells","_b","headerCellProps","positionStyle","first","last","textAlign","align","getNodeName","element","nodeName","toLowerCase","getWindow","toString","ownerDocument","defaultView","getComputedStyle","isElement","OwnElement","Element","isHTMLElement","HTMLElement","isShadowRoot","ShadowRoot","isTableElement","indexOf","getDocumentElement","documentElement","getParentNode","assignedSlot","parentNode","host","getTrueOffsetParent","offsetParent","getContainingBlock","isFirefox","navigator","userAgent","isIE","elementCss","currentNode","transform","perspective","contain","willChange","getOffsetParent","getWindowScroll","win","pageXOffset","scrollTop","pageYOffset","isScrollParent","_getComputedStyle","overflowX","overflowY","test","isWindow","arg","isBody","isHtml","isHtmlOrBody","accumulateScrollOffset","start","stop","scrollOffsetKey","parentElement","getRelativeLayoutRect","target","innerWidth","innerHeight","deltaX","deltaY","offsetTop","offsetLeft","clientTop","clientLeft","findCommonOffsetAncestor","scrollParent","offsetParents","listOffsetParents","includes","fromScrollEvent","fromResizeEvent","subscriber","resizeObserver","next","observe","disconnect","getScrollParent","getRichVisibleRectsStream","structureMayChange$","virtualDebugLabel","startWith","commonOffsetAncestor","distinctUntilChanged","tap","structure","log","switchMap","events$","event","targetRect","scrollParentRect","offsetY","clipRect","min","getFullRenderRange","topIndex","topBlank","bottomIndex","bottomBlank","makeRowHeightManager","initRowCount","estimatedRowHeight","cache","fill","getRenderRange","offset","maxRenderHeight","setRowCount","getRenderRangeWhenBelowView","getRenderRangeWhenAboveView","getRenderRangeWhenInView","end","getEnd","totalSize","getEstimatedTotalSize","getStart","h","overscanUpwards","overscanSize","overscanCount","endOffset","startInfo","overscanDownwards","count","prevSize","updateRow","size","TableDOMHelper","querySelector","stickyScrollSelector","getVirtualTop","getTableRows","htmlTable","getTableBodyHtmlTable","querySelectorAll","getLeftLockShadow","selector","getRightLockShadow","getLoadingIndicator","HtmlTable","tbodyHtmlTag","getRowProps","data","verticalRenderInfo","verInfo","horizontalRenderInfo","hozInfo","components","Row","Cell","TableBody","spanManager","tbody","tbodyProps","renderRow","row","rowProps","rowClass","even","odd","trProps","renderBodyCell","cellProps","cellContent","getSpanRect","spanRect","limit","hasSpan","tdProps","DefaultLoadingIcon","margin","display","viewBox","preserveAspectRatio","cy","r","stroke","strokeDasharray","strokeLinecap","strokeWidth","attributeName","dur","keyTimes","repeatCount","values","DefaultLoadingContentWrapper","Loading","LoadingContentWrapper","LoadingIcon","emptyContentDeprecatedWarned","warnEmptyContentIsDeprecated","flowRootDeprecatedWarned","warnFlowRootIsDeprecated","BaseTable","Component","rowHeightManager","artTableWrapperRef","createRef","rootSubscription","hasScroll","needRenderLock","getDoms","domHelper","updateStickyScroll","tableBodyHtmlTable","innerTableWidth","artTableWidth","stickyScrollHeightProp","stickyScrollHeight","marginTop","setState","renderTableHeader","stickyTop","hasHeader","updateOffsetX","nextOffsetX","lastInfo","abs","syncHorizontalScrollFromTableBody","syncHorizontalScroll","shouldShowLeftLockShadow","classList","remove","shouldShowRightLockShadow","scrollWidth","renderTableBody","footerDataSource","tableBodyClassName","emptyContent","renderTableFooter","stickyBottom","Infinity","renderLockShadows","renderStickyScroll","hasStickyScroll","useOuterBorder","isStickyHead","isStickyHeader","isStickyFooter","flowRoot","artTableWrapperClassName","empty","artTableWrapperProps","componentDidMount","updateDOMHelper","props$","initSubscriptions","didMountOrUpdate","componentDidUpdate","prevProps","prevState","adjustNeedRenderLock","updateRowHeightManager","updateScrollLeftWhenLayoutChanged","prevHasFooter","currentHasFooter","richVisibleRects$","skip","mapTo","shareReplay","p","pairwise","y","sizeAndOffset","componentWillUnmount","unsubscribe","current","virtualTop","virtualTopHeight","zeroHeightRowCount","maxRowIndex","maxRowBottom","tr","Number","dataset","rowindex","isNaN","forceUpdate","sumOfColWidth","nextNeedRenderLock","defaultProps","__rest","s","e","t","getOwnPropertySymbols","propertyIsEnumerable","InlineFlexCell","ExpansionCell","CaretDownIcon","focusable","d","InfoIcon","CaretRightIcon","icons","CaretDown","CaretRight","Info","treeMetaSymbol","Symbol","treeMode","opts","treeModeStep","pipeline","_c","_d","_e","_f","_g","_h","_j","stateKey","ctx","ensurePrimaryKey","Error","openKeys","getStateAtKey","defaultOpenKeys","openKeySet","onChangeOpenKeys","nextKeys","action","setStateAtKey","toggle","rowKey","expanded","isLeafNode$1","clickArea","treeMetaKey","stopClickEventPropagation","iconWidth","indents","iconIndent","iconGap","indentSize","mapDataSource","processDataSource","mapColumns","treeMeta","firstCol","others","recordIndex","content","indent","marginLeft","onClick","stopPropagation","expandCls","cursor","marginRight","TablePipeline","_snapshots","_rowPropsGetters","defaultIndents","appendRowPropsGetter","getter","getDataSource","_dataSource","getColumns","_columns","partialState","extraInfo","hint","snapshot","rows","rowPropsGetters","useTransform","use","step","mapper","getProps","reduce","res","useTablePipeline","B","C","E","I","S","T","_","a","b","c","f","g","j","k","m","u"],"mappings":"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A,IAAI,EAAE,CADA;AAENqC,EAAAA,MAAM,EAAE,EAFF;AAGNuD,EAAAA,MAAM,EAAE,EAHF;AAINR,EAAAA,UAAU,EAAE,EAJN;AAKNS,EAAAA,UAAU,EAAE,EALN;AAMNH,EAAAA,gBAAgB,EAAE;AANZ,CAAV;AAQA,MAAMI,qBAAqB,GAAGnQ,GAAK;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAzBA;AA0BA,MAAMoQ,qBAAqB,GAAGrQ,eAAe,CAACsQ,GAAK;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMF,qBAAsB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAKzB,OAAO,CAACG,WAAY;AACzB;AACA;AACA;AACA;AACA;AACA,KAAKH,OAAO,CAACI,SAAU,MAAKJ,OAAO,CAACK,WAAY;AAChD;AACA;AACA;AACA;AACA;AACA,qBAAqBL,OAAO,CAACG,WAAY;AACzC;AACA;AACA,eAAemB,CAAC,CAACtD,MAAO;AACxB;AACA;AACA,qBAAqBgC,OAAO,CAACK,WAAY;AACzC;AACA;AACA,eAAeiB,CAAC,CAACC,MAAO;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAeD,CAAC,CAAC3F,IAAK;AACtB;AACA;AACA;AACA,KAAKqE,OAAO,CAACc,cAAe;AAC5B;AACA;AACA;AACA,eAAeQ,CAAC,CAACP,UAAW;AAC5B;AACA;AACA;AACA,OAAOf,OAAO,CAACe,UAAW;AAC1B;AACA;AACA;AACA,OAAOf,OAAO,CAACgB,cAAe;AAC9B,sBAAsBlB,mBAAoB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOE,OAAO,CAACiB,eAAgB;AAC/B,qBAAqBnB,mBAAoB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAKE,OAAO,CAACkB,YAAa;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAKlB,OAAO,CAACW,YAAa;AAC1B;AACA;AACA;AACA,eAAeW,CAAC,CAACE,UAAW;AAC5B;AACA;AACA;AACA,KAAKxB,OAAO,CAACY,gBAAiB;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAKZ,OAAO,CAACmB,cAAe;AAC5B;AACA;AACA,OAAOnB,OAAO,CAACoB,uBAAwB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOpB,OAAO,CAACqB,gBAAiB;AAChC;AACA,iBAAiBC,CAAC,CAACD,gBAAiB;AACpC;AACA;AACA;AACA;AACA,CA1OA;AA4OA,MAAMO,mBAAmB,GAAGtR,KAAK,CAACuR,IAAN,CAAW,MAAOvR,KAAK,CAAC2H,aAAN,CAAoB3H,KAAK,CAACwR,QAA1B,EAAoC,IAApC,EAC1CxR,KAAK,CAAC2H,aAAN,CAAoB,KAApB,EAA2B;AAAE8J,EAAAA,GAAG,EAAE,aAAP;AAAsBC,EAAAA,SAAS,EAAE,aAAjC;AAAgDC,EAAAA,GAAG,EAAE;AAArD,CAA3B,CAD0C,EAE1C3R,KAAK,CAAC2H,aAAN,CAAoB,KAApB,EAA2B;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","sourcesContent":["import cx from 'classnames';\nimport React, { useState } from 'react';\nimport { defer, fromEvent, asyncScheduler, BehaviorSubject, Subscription, merge, Observable, combineLatest, noop } from 'rxjs';\nimport * as op from 'rxjs/operators';\nimport { throttleTime, map } from 'rxjs/operators';\nimport * as styled from 'styled-components';\nimport styled__default, { css } from 'styled-components';\nimport ResizeObserver from 'resize-observer-polyfill';\n\nfunction isLeafNode(node) {\r\n    return node.children == null || node.children.length === 0;\r\n}\n\n/** 遍历所有节点，并将节点收集到一个数组中.\r\n * order 参数可用于指定遍历规则：\r\n * * `pre` 前序遍历 （默认）\r\n * * `post` 后续遍历\r\n * * `leaf-only` 忽略内部节点，只收集叶子节点\r\n * */\r\nfunction collectNodes(nodes, order = 'pre') {\r\n    const result = [];\r\n    dfs(nodes);\r\n    return result;\r\n    function dfs(nodes) {\r\n        if (nodes == null) {\r\n            return;\r\n        }\r\n        for (const node of nodes) {\r\n            if (isLeafNode(node)) {\r\n                result.push(node);\r\n            }\r\n            else {\r\n                if (order === 'pre') {\r\n                    result.push(node);\r\n                    dfs(node.children);\r\n                }\r\n                else if (order === 'post') {\r\n                    dfs(node.children);\r\n                    result.push(node);\r\n                }\r\n                else {\r\n                    dfs(node.children);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\n\n/** 获取一棵树的高度/深度 (0-based) */\r\nfunction getTreeDepth(nodes) {\r\n    let maxDepth = -1;\r\n    dfs(nodes, 0);\r\n    return maxDepth;\r\n    function dfs(columns, depth) {\r\n        for (const column of columns) {\r\n            if (isLeafNode(column)) {\r\n                maxDepth = Math.max(maxDepth, depth);\r\n            }\r\n            else {\r\n                dfs(column.children, depth + 1);\r\n            }\r\n        }\r\n    }\r\n}\n\nfunction groupBy2(list, iteratee) {\r\n    const groups = new Map();\r\n    for (const item of list) {\r\n        const key = iteratee(item);\r\n        if (!groups.has(key)) {\r\n            groups.set(key, []);\r\n        }\r\n        groups.get(key).push(item);\r\n    }\r\n    return groups;\r\n}\n\nfunction flatMap(array, callback) {\r\n    const result = [];\r\n    array.forEach((value, index) => {\r\n        result.push(...callback(value, index, array));\r\n    });\r\n    return result;\r\n}\r\nfunction fromEntries(entries) {\r\n    const result = {};\r\n    for (const [key, value] of entries) {\r\n        result[key] = value;\r\n    }\r\n    return result;\r\n}\r\nconst arrayUtils = {\r\n    diff(arr1, arr2) {\r\n        const set = new Set(arr2);\r\n        return arr1.filter((x) => !set.has(x));\r\n    },\r\n    merge(arr1, arr2) {\r\n        const set = new Set(arr1);\r\n        return arr1.concat(arr2.filter((x) => !set.has(x)));\r\n    },\r\n};\r\nfunction always(value) {\r\n    return (...args) => value;\r\n}\n\n/** 在表格的单元格的渲染过程中，先渲染的单元格的 colSpan/rowSpan 会影响到后续单元格是否被渲染\r\n * `SpanManager` 会在内部维护一份状态来记录最近渲染单元格的 colSpan/rowSpan，\r\n * 方便后续的单元格快速判断 \"是否需要跳过渲染\" */\r\nclass SpanManager {\r\n    constructor() {\r\n        this.rects = [];\r\n    }\r\n    testSkip(rowIndex, colIndex) {\r\n        return this.rects.some(({ left, right, top, bottom }) => left <= colIndex && colIndex < right && top <= rowIndex && rowIndex < bottom);\r\n    }\r\n    stripUpwards(rowIndex) {\r\n        this.rects = this.rects.filter(rect => rect.bottom > rowIndex);\r\n    }\r\n    add(rowIndex, colIndex, colSpan, rowSpan) {\r\n        this.rects.push({\r\n            left: colIndex,\r\n            right: colIndex + colSpan,\r\n            top: rowIndex,\r\n            bottom: rowIndex + rowSpan,\r\n        });\r\n    }\r\n}\n\nfunction safeRenderHeader(column) {\r\n    var _a;\r\n    return (_a = column.title) !== null && _a !== void 0 ? _a : column.name;\r\n}\r\nfunction safeGetValue(column, record, rowIndex) {\r\n    if (column.getValue) {\r\n        return column.getValue(record, rowIndex);\r\n    }\r\n    return record[column.code];\r\n}\r\nfunction safeGetRowKey(primaryKey, record, rowIndex) {\r\n    let key;\r\n    if (typeof primaryKey === 'string') {\r\n        key = record[primaryKey];\r\n    }\r\n    else if (typeof primaryKey === 'function') {\r\n        key = primaryKey(record);\r\n    }\r\n    if (key == null) {\r\n        key = String(rowIndex);\r\n    }\r\n    return key;\r\n}\r\nfunction safeGetCellProps(column, record, rowIndex) {\r\n    if (column.getCellProps) {\r\n        const value = safeGetValue(column, record, rowIndex);\r\n        return column.getCellProps(value, record, rowIndex) || {};\r\n    }\r\n    return {};\r\n}\r\nfunction safeRender(column, record, rowIndex) {\r\n    const value = safeGetValue(column, record, rowIndex);\r\n    if (column.render) {\r\n        return column.render(value, record, rowIndex);\r\n    }\r\n    return value;\r\n}\r\nconst internals = {\r\n    safeRenderHeader,\r\n    safeGetValue,\r\n    safeGetRowKey,\r\n    safeGetCellProps,\r\n    safeRender,\r\n};\n\nfunction composeEventHandler(handler1, handler2) {\r\n    return (...args) => {\r\n        // 先执行原有的事件回调函数\r\n        handler1(args);\r\n        handler2(args);\r\n        // 事件回调函数没有返回值，故这里不进行 return\r\n    };\r\n}\r\n/** 合并两个 cellProps（单元格属性）对象，返回一个合并后的全新对象。\r\n *\r\n * mergeCellProps 会按照以下规则来合并两个对象：\r\n * * 对于 数字、字符串、布尔值类型的字段，extra 中的字段值将直接覆盖 base 中的字段值（className 是个特例，会进行字符串拼接）\r\n * * 对于函数/方法类型的字段（对应单元格的事件回调函数），mergeCellProps 将生成一个新的函数，新函数将按序调用 base 和 extra 中的方法\r\n * * 对于普通对象类型的字段（对应单元格的样式），mergeCellProps 将合并两个对象\r\n * */\r\nfunction mergeCellProps(base, extra) {\r\n    if (base == null) {\r\n        return extra;\r\n    }\r\n    if (extra == null) {\r\n        return base;\r\n    }\r\n    const result = Object.assign({}, base);\r\n    for (const key of Object.keys(extra)) {\r\n        const value = extra[key];\r\n        const type = typeof value;\r\n        if (value === null) {\r\n            // value=null 时 覆盖原来的值\r\n            result[key] = null;\r\n        }\r\n        else if (value === undefined) ;\r\n        else if (type === 'number' || type === 'string' || type === 'boolean') {\r\n            if (key === 'className') {\r\n                result[key] = cx(result[key], value);\r\n            }\r\n            else {\r\n                result[key] = value;\r\n            }\r\n        }\r\n        else if (type === 'function') {\r\n            const prev = result[key];\r\n            if (prev == null) {\r\n                result[key] = value;\r\n            }\r\n            else {\r\n                result[key] = composeEventHandler(prev, value);\r\n            }\r\n        }\r\n        else if (type === 'object') {\r\n            result[key] = Object.assign({}, result[key], value);\r\n        }\r\n        // else `type` is 'bigint' or 'symbol', `value` is an invalid cellProp, ignore it\r\n    }\r\n    return result;\r\n}\n\n/** styled-components 类库的版本，ali-react-table 同时支持 v3 和 v5 */\r\nconst STYLED_VERSION = styled.createGlobalStyle != null ? 'v5' : 'v3';\r\nconst STYLED_REF_PROP = STYLED_VERSION === 'v3' ? 'innerRef' : 'ref';\r\nconst OVERSCAN_SIZE = 100;\r\nconst AUTO_VIRTUAL_THRESHOLD = 100;\r\nfunction sum(arr) {\r\n    let result = 0;\r\n    arr.forEach((x) => {\r\n        result += x;\r\n    });\r\n    return result;\r\n}\r\n// 使用 defer 避免过早引用 window，导致在 SSR 场景下报错\r\nconst throttledWindowResize$ = defer(() => fromEvent(window, 'resize', { passive: true }).pipe(throttleTime(150, asyncScheduler, { leading: true, trailing: true })));\r\n/** 获取默认的滚动条大小 */\r\nfunction getScrollbarSizeImpl() {\r\n    const scrollDiv = document.createElement('div');\r\n    scrollDiv.style.position = 'absolute';\r\n    scrollDiv.style.width = '100px';\r\n    scrollDiv.style.height = '100px';\r\n    scrollDiv.style.overflow = 'scroll';\r\n    scrollDiv.style.top = '-9999px';\r\n    document.body.appendChild(scrollDiv);\r\n    const scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\r\n    const scrollbarHeight = scrollDiv.offsetHeight - scrollDiv.clientHeight;\r\n    document.body.removeChild(scrollDiv);\r\n    return { width: scrollbarWidth, height: scrollbarHeight };\r\n}\r\nlet scrollBarSize$;\r\nfunction getScrollbarSize() {\r\n    if (scrollBarSize$ == null) {\r\n        scrollBarSize$ = new BehaviorSubject(getScrollbarSizeImpl());\r\n        throttledWindowResize$.pipe(map(() => getScrollbarSizeImpl())).subscribe(scrollBarSize$);\r\n    }\r\n    return scrollBarSize$.value;\r\n}\r\n/** 同步多个元素之间的 scrollLeft, 每当 scrollLeft 发生变化时 callback 会被调用 */\r\nfunction syncScrollLeft(elements, callback) {\r\n    const bypassSet = new Set();\r\n    function publishScrollLeft(origin, scrollLeft) {\r\n        bypassSet.clear();\r\n        for (const elem of elements) {\r\n            if (elem === origin) {\r\n                continue;\r\n            }\r\n            elem.scrollLeft = scrollLeft;\r\n            bypassSet.add(elem);\r\n        }\r\n    }\r\n    const subscription = new Subscription();\r\n    for (const ele of elements) {\r\n        const listener = () => {\r\n            if (bypassSet.has(ele)) {\r\n                bypassSet.delete(ele);\r\n                return;\r\n            }\r\n            const scrollLeft = ele.scrollLeft;\r\n            publishScrollLeft(ele, scrollLeft);\r\n            callback(scrollLeft);\r\n        };\r\n        ele.addEventListener('scroll', listener, { passive: true });\r\n        subscription.add(() => ele.removeEventListener('scroll', listener));\r\n    }\r\n    return subscription;\r\n}\r\n/**\r\n * Performs equality by iterating through keys on an object and returning false\r\n * when any key has values which are not strictly equal between the arguments.\r\n * Returns true when the values of all keys are strictly equal.\r\n */\r\nfunction shallowEqual(objA, objB) {\r\n    const hasOwnProperty = Object.prototype.hasOwnProperty;\r\n    if (Object.is(objA, objB)) {\r\n        return true;\r\n    }\r\n    if (typeof objA !== 'object' || objA === null || typeof objB !== 'object' || objB === null) {\r\n        return false;\r\n    }\r\n    const keysA = Object.keys(objA);\r\n    const keysB = Object.keys(objB);\r\n    if (keysA.length !== keysB.length) {\r\n        return false;\r\n    }\r\n    // Test for A's keys different from B.\r\n    for (let i = 0; i < keysA.length; i++) {\r\n        if (!hasOwnProperty.call(objB, keysA[i]) || !Object.is(objA[keysA[i]], objB[keysA[i]])) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\n\nfunction resolveVirtualEnabled(virtualEnum, defaultValue) {\r\n    if (virtualEnum == null || virtualEnum === 'auto') {\r\n        return defaultValue;\r\n    }\r\n    return virtualEnum;\r\n}\r\nlet lockColumnNeedSpecifiedWidthWarned = false;\r\nfunction warnLockColumnNeedSpecifiedWidth(column) {\r\n    if (!lockColumnNeedSpecifiedWidthWarned) {\r\n        lockColumnNeedSpecifiedWidthWarned = true;\r\n        console.warn('[ali-react-table] lock=true 的列需要指定宽度', column);\r\n    }\r\n}\r\nlet columnHiddenDeprecatedWarned = false;\r\nfunction warnColumnHiddenDeprecated(column) {\r\n    if (!columnHiddenDeprecatedWarned) {\r\n        columnHiddenDeprecatedWarned = true;\r\n        console.warn('[ali-react-table] column.hidden 已经过时，如果需要隐藏该列，请将其从 columns 数组中移除', column);\r\n    }\r\n}\r\n/** 检查列配置 & 设置默认宽度 & 剔除隐藏的列 */\r\nfunction processColumns(columns, defaultColumnWidth) {\r\n    if (columns == null || !Array.isArray(columns)) {\r\n        console.warn('[ali-react-table] <BaseTable /> props.columns 需要传入一个数组', columns);\r\n        columns = [];\r\n    }\r\n    function dfs(columns) {\r\n        const result = [];\r\n        for (let column of columns) {\r\n            if (column.width == null) {\r\n                if (defaultColumnWidth != null) {\r\n                    column = Object.assign(Object.assign({}, column), { width: defaultColumnWidth });\r\n                }\r\n                else if (process.env.NODE_ENV !== 'production' && isLeafNode(column) && column.lock) {\r\n                    warnLockColumnNeedSpecifiedWidth(column);\r\n                }\r\n            }\r\n            if (isLeafNode(column)) {\r\n                if (column.hidden) {\r\n                    // 被隐藏的列 会在这里被剔除\r\n                    warnColumnHiddenDeprecated(column);\r\n                }\r\n                else {\r\n                    result.push(column);\r\n                }\r\n            }\r\n            else {\r\n                const nextChildren = dfs(column.children);\r\n                // 如果 nextChildren 为空，说明所有的子节点均被隐藏了，在这里隐藏父节点\r\n                if (nextChildren.length > 0) {\r\n                    result.push(Object.assign(Object.assign({}, column), { children: nextChildren }));\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    return dfs(columns);\r\n}\r\nfunction getLeftNestedLockCount(columns) {\r\n    let nestedCount = 0;\r\n    for (const col of columns) {\r\n        if (isLock(col)) {\r\n            nestedCount += 1;\r\n        }\r\n        else {\r\n            break;\r\n        }\r\n    }\r\n    return nestedCount;\r\n    function isLock(col) {\r\n        if (isLeafNode(col)) {\r\n            return col.lock;\r\n        }\r\n        else {\r\n            return col.lock || col.children.some(isLock);\r\n        }\r\n    }\r\n}\r\nfunction getHorizontalRenderRange({ offsetX, maxRenderWidth, flat, useVirtual, }) {\r\n    if (!useVirtual.horizontal) {\r\n        return { leftIndex: 0, leftBlank: 0, rightIndex: flat.full.length, rightBlank: 0 };\r\n    }\r\n    let leftIndex = 0;\r\n    let centerCount = 0;\r\n    let leftBlank = 0;\r\n    let centerRenderWidth = 0;\r\n    const overscannedOffsetX = Math.max(0, offsetX - OVERSCAN_SIZE);\r\n    while (leftIndex < flat.center.length) {\r\n        const col = flat.center[leftIndex];\r\n        if (col.width + leftBlank < overscannedOffsetX) {\r\n            leftIndex += 1;\r\n            leftBlank += col.width;\r\n        }\r\n        else {\r\n            break;\r\n        }\r\n    }\r\n    // 考虑 over scan 之后，中间部分的列至少需要渲染的宽度\r\n    const minCenterRenderWidth = maxRenderWidth + (overscannedOffsetX - leftBlank) + 2 * OVERSCAN_SIZE;\r\n    while (leftIndex + centerCount < flat.center.length) {\r\n        const col = flat.center[leftIndex + centerCount];\r\n        if (col.width + centerRenderWidth < minCenterRenderWidth) {\r\n            centerRenderWidth += col.width;\r\n            centerCount += 1;\r\n        }\r\n        else {\r\n            break;\r\n        }\r\n    }\r\n    const rightBlankCount = flat.center.length - leftIndex - centerCount;\r\n    const rightBlank = sum(flat.center.slice(flat.center.length - rightBlankCount).map((col) => col.width));\r\n    return {\r\n        leftIndex: leftIndex,\r\n        leftBlank,\r\n        rightIndex: leftIndex + centerCount,\r\n        rightBlank,\r\n    };\r\n}\r\n// 一顿计算，将表格本次渲染所需要的数据都给算出来（代码写得有点乱，有较大优化空间）\r\n// todo 可以考虑下将 header 部分的计算逻辑也放到这个文件中，目前应该有一些重复的计算逻辑\r\nfunction calculateRenderInfo(table) {\r\n    const { offsetX, maxRenderWidth } = table.state;\r\n    const { useVirtual: useVirtualProp, columns: columnsProp, dataSource: dataSourceProp, defaultColumnWidth, } = table.props;\r\n    const columns = processColumns(columnsProp, defaultColumnWidth);\r\n    const leftNestedLockCount = getLeftNestedLockCount(columns);\r\n    const fullFlat = collectNodes(columns, 'leaf-only');\r\n    let flat;\r\n    let nested;\r\n    let useVirtual;\r\n    if (leftNestedLockCount === columns.length) {\r\n        flat = { left: [], right: [], full: fullFlat, center: fullFlat };\r\n        nested = { left: [], right: [], full: columns, center: columns };\r\n        useVirtual = { horizontal: false, vertical: false, header: false };\r\n    }\r\n    else {\r\n        const leftNested = columns.slice(0, leftNestedLockCount);\r\n        const rightNestedLockCount = getLeftNestedLockCount(columns.slice().reverse());\r\n        const centerNested = columns.slice(leftNestedLockCount, columns.length - rightNestedLockCount);\r\n        const rightNested = columns.slice(columns.length - rightNestedLockCount);\r\n        const shouldEnableHozVirtual = fullFlat.length >= AUTO_VIRTUAL_THRESHOLD && fullFlat.every((col) => col.width != null);\r\n        const shouldEnableVerVirtual = dataSourceProp.length >= AUTO_VIRTUAL_THRESHOLD;\r\n        useVirtual = {\r\n            horizontal: resolveVirtualEnabled(typeof useVirtualProp === 'object' ? useVirtualProp.horizontal : useVirtualProp, shouldEnableHozVirtual),\r\n            vertical: resolveVirtualEnabled(typeof useVirtualProp === 'object' ? useVirtualProp.vertical : useVirtualProp, shouldEnableVerVirtual),\r\n            header: resolveVirtualEnabled(typeof useVirtualProp === 'object' ? useVirtualProp.header : useVirtualProp, false),\r\n        };\r\n        flat = {\r\n            left: collectNodes(leftNested, 'leaf-only'),\r\n            full: fullFlat,\r\n            right: collectNodes(rightNested, 'leaf-only'),\r\n            center: collectNodes(centerNested, 'leaf-only'),\r\n        };\r\n        nested = {\r\n            left: leftNested,\r\n            full: columns,\r\n            right: rightNested,\r\n            center: centerNested,\r\n        };\r\n    }\r\n    const horizontalRenderRange = getHorizontalRenderRange({ maxRenderWidth, offsetX, useVirtual, flat });\r\n    const verticalRenderRange = table.getVerticalRenderRange(useVirtual);\r\n    const { leftBlank, leftIndex, rightBlank, rightIndex } = horizontalRenderRange;\r\n    const unfilteredVisibleColumnDescriptors = [\r\n        ...flat.left.map((col, i) => ({ type: 'normal', col, colIndex: i })),\r\n        leftBlank > 0 && { type: 'blank', blankSide: 'left', width: leftBlank },\r\n        ...flat.center\r\n            .slice(leftIndex, rightIndex)\r\n            .map((col, i) => ({ type: 'normal', col, colIndex: flat.left.length + leftIndex + i })),\r\n        rightBlank > 0 && { type: 'blank', blankSide: 'right', width: rightBlank },\r\n        ...flat.right.map((col, i) => ({ type: 'normal', col, colIndex: flat.full.length - flat.right.length + i })),\r\n    ];\r\n    const visibleColumnDescriptors = unfilteredVisibleColumnDescriptors.filter(Boolean);\r\n    const fullFlatCount = flat.full.length;\r\n    const leftFlatCount = flat.left.length;\r\n    const rightFlatCount = flat.right.length;\r\n    const stickyLeftMap = new Map();\r\n    let stickyLeft = 0;\r\n    for (let i = 0; i < leftFlatCount; i++) {\r\n        stickyLeftMap.set(i, stickyLeft);\r\n        stickyLeft += flat.full[i].width;\r\n    }\r\n    const stickyRightMap = new Map();\r\n    let stickyRight = 0;\r\n    for (let i = 0; i < rightFlatCount; i++) {\r\n        stickyRightMap.set(fullFlatCount - 1 - i, stickyRight);\r\n        stickyRight += flat.full[fullFlatCount - 1 - i].width;\r\n    }\r\n    const leftLockTotalWidth = sum(flat.left.map((col) => col.width));\r\n    const rightLockTotalWidth = sum(flat.right.map((col) => col.width));\r\n    return {\r\n        horizontalRenderRange,\r\n        verticalRenderRange,\r\n        visible: visibleColumnDescriptors,\r\n        flat,\r\n        nested,\r\n        useVirtual,\r\n        stickyLeftMap,\r\n        stickyRightMap,\r\n        leftLockTotalWidth,\r\n        rightLockTotalWidth,\r\n        hasLockColumn: nested.left.length > 0 || nested.right.length > 0,\r\n    };\r\n}\n\nfunction Colgroup({ descriptors }) {\r\n    return (React.createElement(\"colgroup\", null, descriptors.map((descriptor) => {\r\n        if (descriptor.type === 'blank') {\r\n            return React.createElement(\"col\", { key: descriptor.blankSide, style: { width: descriptor.width } });\r\n        }\r\n        return React.createElement(\"col\", { key: descriptor.colIndex, style: { width: descriptor.col.width } });\r\n    })));\r\n}\n\nconst LOCK_SHADOW_PADDING = 20;\r\nconst prefix = 'art-';\r\nconst Classes = {\r\n    /** BaseTable 表格组件的外层包裹 div */\r\n    artTableWrapper: `${prefix}table-wrapper`,\r\n    artTable: `${prefix}table`,\r\n    tableHeader: `${prefix}table-header`,\r\n    tableBody: `${prefix}table-body`,\r\n    tableFooter: `${prefix}table-footer`,\r\n    /** 表格行 */\r\n    tableRow: `${prefix}table-row`,\r\n    /** 表头行 */\r\n    tableHeaderRow: `${prefix}table-header-row`,\r\n    /** 单元格 */\r\n    tableCell: `${prefix}table-cell`,\r\n    /** 表头的单元格 */\r\n    tableHeaderCell: `${prefix}table-header-cell`,\r\n    virtualBlank: `${prefix}virtual-blank`,\r\n    stickyScroll: `${prefix}sticky-scroll`,\r\n    stickyScrollItem: `${prefix}sticky-scroll-item`,\r\n    horizontalScrollContainer: `${prefix}horizontal-scroll-container`,\r\n    lockShadowMask: `${prefix}lock-shadow-mask`,\r\n    lockShadow: `${prefix}lock-shadow`,\r\n    leftLockShadow: `${prefix}left-lock-shadow`,\r\n    rightLockShadow: `${prefix}right-lock-shadow`,\r\n    /** 数据为空时表格内容的外层 div */\r\n    emptyWrapper: `${prefix}empty-wrapper`,\r\n    loadingWrapper: `${prefix}loading-wrapper`,\r\n    loadingIndicatorWrapper: `${prefix}loading-indicator-wrapper`,\r\n    loadingIndicator: `${prefix}loading-indicator`,\r\n};\r\nconst Z = {\r\n    lock: 5,\r\n    header: 15,\r\n    footer: 10,\r\n    lockShadow: 20,\r\n    scrollItem: 30,\r\n    loadingIndicator: 40,\r\n};\r\nconst outerBorderStyleMixin = css `\n  border-top: var(--cell-border-horizontal);\n  border-right: var(--cell-border-vertical);\n  border-bottom: var(--cell-border-horizontal);\n  border-left: var(--cell-border-vertical);\n\n  td.first,\n  th.first {\n    border-left: none;\n  }\n  td.last,\n  th.last {\n    border-right: none;\n  }\n\n  thead tr.first th,\n  tbody tr.first td {\n    border-top: none;\n  }\n  &.has-footer tfoot tr.last td {\n    border-bottom: none;\n  }\n  &:not(.has-footer) tbody tr.last td {\n    border-bottom: none;\n  }\n`;\r\nconst StyledArtTableWrapper = styled__default.div `\n  --row-height: 48px;\n  --color: #333;\n  --bgcolor: white;\n  --hover-bgcolor: var(--hover-color, #f5f5f5);\n  --highlight-bgcolor: #eee;\n\n  --header-row-height: 32px;\n  --header-color: #5a6c84;\n  --header-bgcolor: #e9edf2;\n  --header-hover-bgcolor: #ddd;\n  --header-highlight-bgcolor: #e4e8ed;\n\n  --cell-padding: 8px 12px;\n  --font-size: 12px;\n  --line-height: 1.28571;\n  --lock-shadow: rgba(152, 152, 152, 0.5) 0 0 6px 2px;\n\n  --border-color: #dfe3e8;\n  --cell-border: 1px solid var(--border-color);\n  --cell-border-horizontal: var(--cell-border);\n  --cell-border-vertical: var(--cell-border);\n  --header-cell-border: 1px solid var(--border-color);\n  --header-cell-border-horizontal: var(--header-cell-border);\n  --header-cell-border-vertical: var(--header-cell-border);\n\n  box-sizing: border-box;\n  * {\n    box-sizing: border-box;\n  }\n  cursor: default;\n  color: var(--color);\n  font-size: var(--font-size);\n  line-height: var(--line-height);\n  position: relative;\n  overflow-anchor: none;\n\n  // 表格外边框由 art-table-wrapper 提供，而不是由单元格提供\n  &.use-outer-border {\n    ${outerBorderStyleMixin};\n  }\n\n  .no-scrollbar {\n    // firefox 中移除滚动条\n    scrollbar-width: none;\n\n    // 其他浏览器中移除滚动条\n    ::-webkit-scrollbar {\n      display: none;\n    }\n  }\n\n  .${Classes.tableHeader} {\n    overflow-x: auto;\n    overflow-y: hidden;\n    background: var(--header-bgcolor);\n  }\n\n  .${Classes.tableBody}, .${Classes.tableFooter} {\n    overflow-x: auto;\n    overflow-y: hidden;\n    background: var(--bgcolor);\n  }\n\n  &.sticky-header .${Classes.tableHeader} {\n    position: sticky;\n    top: 0;\n    z-index: ${Z.header};\n  }\n\n  &.sticky-footer .${Classes.tableFooter} {\n    position: sticky;\n    bottom: 0;\n    z-index: ${Z.footer};\n  }\n\n  table {\n    width: 100%;\n    table-layout: fixed;\n    border-collapse: separate;\n    border-spacing: 0;\n    display: table;\n    margin: 0;\n    padding: 0;\n  }\n\n  // 在 tr 上设置 .no-hover 可以禁用鼠标悬停效果\n  tr:not(.no-hover):hover > td {\n    background: var(--hover-bgcolor);\n  }\n  // 在 tr 设置 highlight 可以为底下的 td 设置为高亮色\n  // 而设置 .no-highlight 的话则可以禁用高亮效果；\n  tr:not(.no-highlight).highlight > td {\n    background: var(--highlight-bgcolor);\n  }\n\n  th {\n    font-weight: normal;\n    text-align: left;\n    padding: var(--cell-padding);\n    height: var(--header-row-height);\n    color: var(--header-color);\n    background: var(--header-bgcolor);\n    border: none;\n    border-right: var(--header-cell-border-vertical);\n    border-bottom: var(--header-cell-border-horizontal);\n  }\n  tr.first th {\n    border-top: var(--header-cell-border-horizontal);\n  }\n  th.first {\n    border-left: var(--header-cell-border-vertical);\n  }\n\n  td {\n    padding: var(--cell-padding);\n    background: var(--bgcolor);\n    height: var(--row-height);\n    border: none;\n    border-right: var(--cell-border-vertical);\n    border-bottom: var(--cell-border-horizontal);\n  }\n  td.first {\n    border-left: var(--cell-border-vertical);\n  }\n  tr.first td {\n    border-top: var(--cell-border-horizontal);\n  }\n  &.has-header tbody tr.first td {\n    border-top: none;\n  }\n  &.has-footer tbody tr.last td {\n    border-bottom: none;\n  }\n\n  .lock-left,\n  .lock-right {\n    z-index: ${Z.lock};\n  }\n\n  //#region 锁列阴影\n  .${Classes.lockShadowMask} {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    z-index: ${Z.lockShadow};\n    pointer-events: none;\n    overflow: hidden;\n\n    .${Classes.lockShadow} {\n      height: 100%;\n    }\n\n    .${Classes.leftLockShadow} {\n      margin-right: ${LOCK_SHADOW_PADDING}px;\n      box-shadow: none;\n\n      &.show-shadow {\n        box-shadow: var(--lock-shadow);\n        border-right: var(--cell-border-vertical);\n      }\n    }\n\n    .${Classes.rightLockShadow} {\n      margin-left: ${LOCK_SHADOW_PADDING}px;\n      box-shadow: none;\n\n      &.show-shadow {\n        box-shadow: var(--lock-shadow);\n        border-left: var(--cell-border-vertical);\n      }\n    }\n  }\n  //#endregion\n\n  //#region 空表格展现\n  .${Classes.emptyWrapper} {\n    pointer-events: none;\n    color: #99a3b3;\n    font-size: 12px;\n    text-align: center;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n\n    .empty-image {\n      width: 50px;\n      height: 50px;\n    }\n\n    .empty-tips {\n      margin-top: 16px;\n      line-height: 1.5;\n    }\n  }\n  //#endregion\n\n  //#region 粘性滚动条\n  .${Classes.stickyScroll} {\n    overflow: auto;\n    position: sticky;\n    bottom: 0;\n    z-index: ${Z.scrollItem};\n    margin-top: -17px;\n  }\n\n  .${Classes.stickyScrollItem} {\n    // 必须有高度才能出现滚动条\n    height: 1px;\n    visibility: hidden;\n  }\n  //#endregion\n\n  //#region 加载样式\n  .${Classes.loadingWrapper} {\n    position: relative;\n\n    .${Classes.loadingIndicatorWrapper} {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      pointer-events: none;\n    }\n\n    .${Classes.loadingIndicator} {\n      position: sticky;\n      z-index: ${Z.loadingIndicator};\n      transform: translateY(-50%);\n    }\n  }\n  //#endregion\n`;\n\nconst DefaultEmptyContent = React.memo(() => (React.createElement(React.Fragment, null,\r\n    React.createElement(\"img\", { alt: \"empty-image\", className: \"empty-image\", src: \"//img.alicdn.com/tfs/TB1l1LcM3HqK1RjSZJnXXbNLpXa-50-50.svg\" }),\r\n    React.createElement(\"div\", { className: \"empty-tips\" },\r\n        \"\\u6CA1\\u6709\\u7B26\\u5408\\u67E5\\u8BE2\\u6761\\u4EF6\\u7684\\u6570\\u636E\",\r\n        React.createElement(\"br\", null),\r\n        \"\\u8BF7\\u4FEE\\u6539\\u6761\\u4EF6\\u540E\\u91CD\\u65B0\\u67E5\\u8BE2\"))));\r\nfunction EmptyHtmlTable({ descriptors, isLoading, emptyCellHeight, EmptyContent = DefaultEmptyContent, }) {\r\n    const show = !isLoading;\r\n    return (React.createElement(\"table\", null,\r\n        React.createElement(Colgroup, { descriptors: descriptors }),\r\n        React.createElement(\"tbody\", null,\r\n            React.createElement(\"tr\", { className: cx(Classes.tableRow, 'first', 'last', 'no-hover'), \"data-rowindex\": 0 },\r\n                React.createElement(\"td\", { className: cx(Classes.tableCell, 'first', 'last'), colSpan: descriptors.length, style: { height: emptyCellHeight !== null && emptyCellHeight !== void 0 ? emptyCellHeight : 200 } }, show && (React.createElement(\"div\", { className: Classes.emptyWrapper },\r\n                    React.createElement(EmptyContent, null))))))));\r\n}\n\nfunction range(n) {\r\n    const array = [];\r\n    for (let i = 0; i < n; i++) {\r\n        array.push(i);\r\n    }\r\n    return array;\r\n}\r\n/** 根据当前横向虚拟滚动 对 nested.center 进行过滤，结果只保留当前视野内可见的那些列配置 */\r\nfunction filterNestedCenter(centerNested, hoz, leftFlatCount) {\r\n    return dfs(centerNested, leftFlatCount).filtered;\r\n    function dfs(cols, startColIndex) {\r\n        let leafCount = 0;\r\n        const filtered = [];\r\n        for (const col of cols) {\r\n            const colIndex = startColIndex + leafCount;\r\n            if (isLeafNode(col)) {\r\n                leafCount += 1;\r\n                if (leftFlatCount + hoz.leftIndex <= colIndex && colIndex < leftFlatCount + hoz.rightIndex) {\r\n                    filtered.push({ colIndex, col });\r\n                }\r\n            }\r\n            else {\r\n                const dfsRes = dfs(col.children, colIndex);\r\n                leafCount += dfsRes.leafCount;\r\n                if (dfsRes.filtered.length > 0) {\r\n                    filtered.push({ colIndex, col, children: dfsRes.filtered });\r\n                }\r\n            }\r\n        }\r\n        return { filtered, leafCount };\r\n    }\r\n}\r\n/** 根据输入的 nested 列配置，算出相应的 leveled & flat 配置方便渲染 */\r\nfunction calculateLeveledAndFlat(inputNested, rowCount) {\r\n    const leveled = [];\r\n    for (let depth = 0; depth < rowCount; depth++) {\r\n        leveled.push([]);\r\n    }\r\n    const flat = [];\r\n    dfs(inputNested, 0);\r\n    return { flat, leveled };\r\n    function dfs(input, depth) {\r\n        let leafCount = 0;\r\n        for (let i = 0; i < input.length; i++) {\r\n            const indexedCol = input[i];\r\n            if (isLeafNode(indexedCol)) {\r\n                leafCount += 1;\r\n                const wrapped = {\r\n                    type: 'normal',\r\n                    width: indexedCol.col.width,\r\n                    col: indexedCol.col,\r\n                    colIndex: indexedCol.colIndex,\r\n                    colSpan: 1,\r\n                    isLeaf: true,\r\n                };\r\n                leveled[depth].push(wrapped);\r\n                flat.push(wrapped);\r\n            }\r\n            else {\r\n                const dfsRes = dfs(indexedCol.children, depth + 1);\r\n                leafCount += dfsRes.leafCount;\r\n                if (dfsRes.leafCount > 0) {\r\n                    leveled[depth].push({\r\n                        type: 'normal',\r\n                        width: indexedCol.col.width,\r\n                        col: indexedCol.col,\r\n                        colIndex: indexedCol.colIndex,\r\n                        colSpan: dfsRes.leafCount,\r\n                        isLeaf: false,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        return { leafCount };\r\n    }\r\n}\r\n/** 包装列配置，附加上 colIndex 属性 */\r\nfunction attachColIndex(inputNested, colIndexOffset) {\r\n    return dfs(inputNested, colIndexOffset).result;\r\n    function dfs(input, startColIndex) {\r\n        const result = [];\r\n        let leafCount = 0;\r\n        for (let i = 0; i < input.length; i++) {\r\n            const col = input[i];\r\n            const colIndex = startColIndex + leafCount;\r\n            if (isLeafNode(col)) {\r\n                leafCount += 1;\r\n                result.push({ colIndex, col });\r\n            }\r\n            else {\r\n                const sub = dfs(col.children, colIndex);\r\n                leafCount += sub.leafCount;\r\n                if (sub.leafCount > 0) {\r\n                    result.push({ col, colIndex, children: sub.result });\r\n                }\r\n            }\r\n        }\r\n        return { result, leafCount };\r\n    }\r\n}\r\n/** 计算用于渲染表头的数据结构 */\r\nfunction calculateHeaderRenderInfo({ flat, nested, horizontalRenderRange: hoz, useVirtual }, rowCount) {\r\n    if (useVirtual.header) {\r\n        const leftPart = calculateLeveledAndFlat(attachColIndex(nested.left, 0), rowCount);\r\n        const filtered = filterNestedCenter(nested.center, hoz, flat.left.length);\r\n        const centerPart = calculateLeveledAndFlat(filtered, rowCount);\r\n        const rightPart = calculateLeveledAndFlat(attachColIndex(nested.right, flat.left.length + flat.center.length), rowCount);\r\n        return {\r\n            flat: [\r\n                ...leftPart.flat,\r\n                { type: 'blank', width: hoz.leftBlank, blankSide: 'left' },\r\n                ...centerPart.flat,\r\n                { type: 'blank', width: hoz.rightBlank, blankSide: 'right' },\r\n                ...rightPart.flat,\r\n            ],\r\n            leveled: range(rowCount).map((depth) => [\r\n                ...leftPart.leveled[depth],\r\n                { type: 'blank', width: hoz.leftBlank, blankSide: 'left' },\r\n                ...centerPart.leveled[depth],\r\n                { type: 'blank', width: hoz.rightBlank, blankSide: 'right' },\r\n                ...rightPart.leveled[depth],\r\n            ]),\r\n        };\r\n    }\r\n    return calculateLeveledAndFlat(attachColIndex(nested.full, 0), rowCount);\r\n}\r\nfunction TableHeader({ info }) {\r\n    const { nested, flat, stickyLeftMap, stickyRightMap } = info;\r\n    const rowCount = getTreeDepth(nested.full) + 1;\r\n    const headerRenderInfo = calculateHeaderRenderInfo(info, rowCount);\r\n    const fullFlatCount = flat.full.length;\r\n    const leftFlatCount = flat.left.length;\r\n    const rightFlatCount = flat.right.length;\r\n    const thead = headerRenderInfo.leveled.map((wrappedCols, level) => {\r\n        const headerCells = wrappedCols.map((wrapped) => {\r\n            var _a, _b;\r\n            if (wrapped.type === 'normal') {\r\n                const { colIndex, colSpan, isLeaf, col } = wrapped;\r\n                const headerCellProps = (_a = col.headerCellProps) !== null && _a !== void 0 ? _a : {};\r\n                const positionStyle = {};\r\n                if (colIndex < leftFlatCount) {\r\n                    positionStyle.position = 'sticky';\r\n                    positionStyle.left = stickyLeftMap.get(colIndex);\r\n                }\r\n                else if (colIndex >= fullFlatCount - rightFlatCount) {\r\n                    positionStyle.position = 'sticky';\r\n                    positionStyle.right = stickyRightMap.get(colIndex + colSpan - 1);\r\n                }\r\n                return (React.createElement(\"th\", Object.assign({ key: colIndex }, headerCellProps, { className: cx(Classes.tableHeaderCell, headerCellProps.className, {\r\n                        first: colIndex === 0,\r\n                        last: colIndex + colSpan === fullFlatCount,\r\n                        'lock-left': colIndex < leftFlatCount,\r\n                        'lock-right': colIndex >= fullFlatCount - rightFlatCount,\r\n                    }), colSpan: colSpan, rowSpan: isLeaf ? rowCount - level : undefined, style: Object.assign(Object.assign({ textAlign: col.align }, headerCellProps.style), positionStyle) }), (_b = col.title) !== null && _b !== void 0 ? _b : col.name));\r\n            }\r\n            else {\r\n                if (wrapped.width > 0) {\r\n                    return React.createElement(\"th\", { key: wrapped.blankSide });\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }\r\n        });\r\n        return (React.createElement(\"tr\", { key: level, className: cx(Classes.tableHeaderRow, {\r\n                first: level === 0,\r\n                last: level === rowCount - 1,\r\n            }) }, headerCells));\r\n    });\r\n    return (React.createElement(\"table\", null,\r\n        React.createElement(\"colgroup\", null, headerRenderInfo.flat.map((wrapped) => {\r\n            if (wrapped.type === 'blank') {\r\n                if (wrapped.width > 0) {\r\n                    return React.createElement(\"col\", { key: wrapped.blankSide, style: { width: wrapped.width } });\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }\r\n            else {\r\n                return React.createElement(\"col\", { key: wrapped.colIndex, style: { width: wrapped.width } });\r\n            }\r\n        })),\r\n        React.createElement(\"thead\", null, thead)));\r\n}\n\nfunction getNodeName(element) {\n  return element ? (element.nodeName || '').toLowerCase() : null;\n}\n\nfunction getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (node.toString() !== '[object Window]') {\n    var ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}\n\nfunction getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}\n\nfunction isElement(node) {\n  var OwnElement = getWindow(node).Element;\n  return node instanceof OwnElement || node instanceof Element;\n}\n\nfunction isHTMLElement(node) {\n  var OwnElement = getWindow(node).HTMLElement;\n  return node instanceof OwnElement || node instanceof HTMLElement;\n}\n\nfunction isShadowRoot(node) {\n  // IE 11 has no ShadowRoot\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  var OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\n\nfunction isTableElement(element) {\n  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;\n}\n\nfunction getDocumentElement(element) {\n  // $FlowFixMe[incompatible-return]: assume body is always available\n  return ((isElement(element) ? element.ownerDocument : // $FlowFixMe[prop-missing]\n  element.document) || window.document).documentElement;\n}\n\nfunction getParentNode(element) {\n  if (getNodeName(element) === 'html') {\n    return element;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // $FlowFixMe[incompatible-return]\n    // $FlowFixMe[prop-missing]\n    element.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    element.parentNode || ( // DOM Element detected\n    isShadowRoot(element) ? element.host : null) || // ShadowRoot detected\n    // $FlowFixMe[incompatible-call]: HTMLElement is a Node\n    getDocumentElement(element) // fallback\n\n  );\n}\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837\n  getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n} // `.offsetParent` reports `null` for fixed elements, while absolute elements\n// return the containing block\n\n\nfunction getContainingBlock(element) {\n  var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') !== -1;\n  var isIE = navigator.userAgent.indexOf('Trident') !== -1;\n\n  if (isIE && isHTMLElement(element)) {\n    // In IE 9, 10 and 11 fixed elements containing block is always established by the viewport\n    var elementCss = getComputedStyle(element);\n\n    if (elementCss.position === 'fixed') {\n      return null;\n    }\n  }\n\n  var currentNode = getParentNode(element);\n\n  while (isHTMLElement(currentNode) && ['html', 'body'].indexOf(getNodeName(currentNode)) < 0) {\n    var css = getComputedStyle(currentNode); // This is non-exhaustive but covers the most common CSS properties that\n    // create a containing block.\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n    if (css.transform !== 'none' || css.perspective !== 'none' || css.contain === 'paint' || ['transform', 'perspective'].indexOf(css.willChange) !== -1 || isFirefox && css.willChange === 'filter' || isFirefox && css.filter && css.filter !== 'none') {\n      return currentNode;\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nfunction getOffsetParent(element) {\n  var window = getWindow(element);\n  var offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static')) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}\n\nfunction getWindowScroll(node) {\n  var win = getWindow(node);\n  var scrollLeft = win.pageXOffset;\n  var scrollTop = win.pageYOffset;\n  return {\n    scrollLeft: scrollLeft,\n    scrollTop: scrollTop\n  };\n}\n\nfunction isScrollParent(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  var _getComputedStyle = getComputedStyle(element),\n      overflow = _getComputedStyle.overflow,\n      overflowX = _getComputedStyle.overflowX,\n      overflowY = _getComputedStyle.overflowY;\n\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}\n\nfunction isWindow(arg) {\r\n    return arg.toString() === '[object Window]';\r\n}\r\nfunction isBody(arg) {\r\n    return getNodeName(arg) === 'body';\r\n}\r\nfunction isHtml(arg) {\r\n    return getNodeName(arg) === 'html';\r\n}\r\nfunction isHtmlOrBody(arg) {\r\n    return isHtml(arg) || isBody(arg);\r\n}\r\n// 计算从 start（子元素）到 stop（祖先元素）之间所有元素的 scrollTop 或 scrollLeft 的和\r\n// 注意 start 和 stop 都是 INCLUSIVE 的，即两者的 scrollTop 或 scrollLeft 都会统计在内\r\nfunction accumulateScrollOffset(start, stop, scrollOffsetKey) {\r\n    let result = 0;\r\n    let elem = start;\r\n    while (elem != null) {\r\n        result += elem[scrollOffsetKey];\r\n        if (elem === stop || (isWindow(stop) && isHtmlOrBody(elem))) {\r\n            break;\r\n        }\r\n        elem = elem.parentElement;\r\n    }\r\n    if (isWindow(stop)) {\r\n        result += getWindowScroll(elem)[scrollOffsetKey];\r\n    }\r\n    return result;\r\n}\r\n/**\r\n * 获取 target 相对于 base 的布局大小和相对位置。\r\n * 注意该方法会考虑滚动所带来的影响\r\n */\r\nfunction getRelativeLayoutRect(base, target) {\r\n    if (isWindow(target) || isHtmlOrBody(target)) {\r\n        return {\r\n            left: 0,\r\n            right: window.innerWidth,\r\n            top: 0,\r\n            bottom: window.innerHeight,\r\n        };\r\n    }\r\n    let deltaX = 0;\r\n    let deltaY = 0;\r\n    let elem = target;\r\n    while (elem != null && elem != base) {\r\n        deltaY += elem.offsetTop;\r\n        deltaX += elem.offsetLeft;\r\n        const offsetParent = getOffsetParent(elem);\r\n        deltaY -= accumulateScrollOffset(elem.parentElement, offsetParent, 'scrollTop');\r\n        deltaX -= accumulateScrollOffset(elem.parentElement, offsetParent, 'scrollLeft');\r\n        if (isWindow(offsetParent)) {\r\n            break;\r\n        }\r\n        deltaY += offsetParent.clientTop;\r\n        deltaX += offsetParent.clientLeft;\r\n        elem = offsetParent;\r\n    }\r\n    return {\r\n        top: deltaY,\r\n        bottom: deltaY + target.offsetHeight,\r\n        left: deltaX,\r\n        right: deltaX + target.offsetWidth,\r\n    };\r\n}\r\nfunction findCommonOffsetAncestor(target, scrollParent) {\r\n    if (isWindow(scrollParent)) {\r\n        return scrollParent;\r\n    }\r\n    const offsetParents = listOffsetParents(target);\r\n    if (offsetParents.includes(scrollParent)) {\r\n        return scrollParent;\r\n    }\r\n    return getOffsetParent(scrollParent);\r\n}\r\n// 列出 target 元素上层的所有 offset parents\r\nfunction listOffsetParents(target) {\r\n    const result = [];\r\n    let elem = target;\r\n    while (true) {\r\n        if (isWindow(elem)) {\r\n            break;\r\n        }\r\n        elem = getOffsetParent(elem);\r\n        result.push(elem);\r\n    }\r\n    return result;\r\n}\r\nfunction fromScrollEvent(element) {\r\n    return fromEvent(element, 'scroll', { passive: true });\r\n}\r\nfunction fromResizeEvent(element) {\r\n    if (isWindow(element)) {\r\n        return fromEvent(element, 'resize', { passive: true });\r\n    }\r\n    return new Observable((subscriber) => {\r\n        const resizeObserver = new ResizeObserver((entries) => {\r\n            subscriber.next(entries);\r\n        });\r\n        resizeObserver.observe(element);\r\n        return () => {\r\n            resizeObserver.disconnect();\r\n        };\r\n    });\r\n}\r\nfunction getScrollParent(elem) {\r\n    if (['html', 'body', '#document'].includes(getNodeName(elem))) {\r\n        return getWindow(elem);\r\n    }\r\n    if (isHTMLElement(elem) && isScrollParent(elem)) {\r\n        return elem;\r\n    }\r\n    return getScrollParent(getParentNode(elem));\r\n}\r\n// 获取 target 相对于「它的滚动父元素」的可见部分的大小与位置\r\nfunction getRichVisibleRectsStream(target, structureMayChange$, virtualDebugLabel) {\r\n    return structureMayChange$.pipe(op.startWith('init'), op.map(() => {\r\n        // target 的第一个滚动父元素，我们认为这就是虚拟滚动发生的地方\r\n        // 即虚拟滚动不考虑「更上层元素发生滚动」的情况\r\n        const scrollParent = getScrollParent(target);\r\n        // target 和 scrollParent 的共同 offset 祖先，作为布局尺寸计算时的参照元素\r\n        const commonOffsetAncestor = findCommonOffsetAncestor(target, scrollParent);\r\n        return { scrollParent, commonOffsetAncestor };\r\n    }), op.distinctUntilChanged(shallowEqual), op.tap((structure) => {\r\n        if (virtualDebugLabel) {\r\n            console.log(`%c[ali-react-table STRUCTURE ${virtualDebugLabel}]`, 'color: #4f9052; font-weight: bold', '\\ntarget:', target, '\\nscrollParent:', structure.scrollParent, '\\ncommonOffsetAncestor:', structure.commonOffsetAncestor);\r\n        }\r\n    }), op.switchMap(({ scrollParent, commonOffsetAncestor }) => {\r\n        const events$ = merge(fromScrollEvent(scrollParent), fromResizeEvent(scrollParent), fromResizeEvent(target));\r\n        return events$.pipe(op.map((event) => ({\r\n            targetRect: getRelativeLayoutRect(commonOffsetAncestor, target),\r\n            scrollParentRect: getRelativeLayoutRect(commonOffsetAncestor, scrollParent),\r\n            event,\r\n        })), op.map(({ event, scrollParentRect, targetRect }) => ({\r\n            event,\r\n            targetRect,\r\n            scrollParentRect,\r\n            offsetY: Math.max(0, scrollParentRect.top - targetRect.top),\r\n            // 表格的横向滚动总是发生在表格内部，所以这里不需要计算 offsetX\r\n            // offsetX: Math.max(0, scrollParentRect.left - targetRect.left),\r\n            clipRect: {\r\n                left: Math.max(targetRect.left, scrollParentRect.left),\r\n                top: Math.max(targetRect.top, scrollParentRect.top),\r\n                right: Math.min(targetRect.right, scrollParentRect.right),\r\n                bottom: Math.min(targetRect.bottom, scrollParentRect.bottom),\r\n            },\r\n        })));\r\n    }), op.tap((rects) => {\r\n        if (virtualDebugLabel) {\r\n            console.log(`%c[ali-react-table RECTS ${virtualDebugLabel}]`, 'color: #4f9052; font-weight: bold', '\\noffsetY:', rects.offsetY, '\\ntargetRect:', rects.targetRect, '\\nscrollParentRect:', rects.scrollParentRect, '\\nclipRect:', rects.clipRect, '\\nevent:', rects.event);\r\n        }\r\n    }));\r\n}\n\nfunction getFullRenderRange(rowCount) {\r\n    return {\r\n        topIndex: 0,\r\n        topBlank: 0,\r\n        bottomIndex: rowCount,\r\n        bottomBlank: 0,\r\n    };\r\n}\r\nfunction makeRowHeightManager(initRowCount, estimatedRowHeight) {\r\n    const cache = new Array(initRowCount).fill(estimatedRowHeight);\r\n    function getRenderRange(offset, maxRenderHeight, rowCount) {\r\n        if (cache.length !== rowCount) {\r\n            setRowCount(rowCount);\r\n        }\r\n        if (maxRenderHeight <= 0) {\r\n            // maxRenderHeight <= 0 说明表格目前在 viewport 之外\r\n            if (offset <= 0) {\r\n                // 表格在 viewport 下方\r\n                return getRenderRangeWhenBelowView();\r\n            }\r\n            else {\r\n                // 表格在 viewport 上方\r\n                return getRenderRangeWhenAboveView();\r\n            }\r\n        }\r\n        else {\r\n            // 表格与 viewport 相交\r\n            return getRenderRangeWhenInView();\r\n        }\r\n        function getRenderRangeWhenBelowView() {\r\n            const start = { topIndex: 0, topBlank: 0 };\r\n            const end = getEnd(0, start);\r\n            return Object.assign(Object.assign({}, start), end);\r\n        }\r\n        function getRenderRangeWhenAboveView() {\r\n            const totalSize = getEstimatedTotalSize(rowCount);\r\n            const start = getStart(totalSize);\r\n            const end = getEnd(totalSize, start);\r\n            return Object.assign(Object.assign({}, start), end);\r\n        }\r\n        function getRenderRangeWhenInView() {\r\n            const start = getStart(offset);\r\n            const end = getEnd(offset + maxRenderHeight, start);\r\n            return Object.assign(Object.assign({}, start), end);\r\n        }\r\n        /** 获取虚拟滚动在 开始位置上的信息 */\r\n        function getStart(offset) {\r\n            if (cache.length === 0) {\r\n                return { topIndex: 0, topBlank: 0 };\r\n            }\r\n            let topIndex = 0;\r\n            let topBlank = 0;\r\n            while (topIndex < cache.length) {\r\n                const h = cache[topIndex];\r\n                if (topBlank + h >= offset) {\r\n                    break;\r\n                }\r\n                topBlank += h;\r\n                topIndex += 1;\r\n            }\r\n            return overscanUpwards(topIndex, topBlank);\r\n        }\r\n        function overscanUpwards(topIndex, topBlank) {\r\n            let overscanSize = 0;\r\n            let overscanCount = 0;\r\n            while (overscanCount < topIndex && overscanSize < OVERSCAN_SIZE) {\r\n                overscanCount += 1;\r\n                overscanSize += cache[topIndex - overscanCount];\r\n            }\r\n            return {\r\n                topIndex: topIndex - overscanCount,\r\n                topBlank: topBlank - overscanSize,\r\n            };\r\n        }\r\n        /** 获取虚拟滚动 在结束位置上的信息 */\r\n        function getEnd(endOffset, startInfo) {\r\n            let bottomIndex = startInfo.topIndex;\r\n            let offset = startInfo.topBlank;\r\n            while (bottomIndex < rowCount && offset < endOffset) {\r\n                offset += cache[bottomIndex];\r\n                bottomIndex += 1;\r\n            }\r\n            const bottomBlank = getEstimatedTotalSize(rowCount) - offset;\r\n            return overscanDownwards(bottomIndex, bottomBlank);\r\n        }\r\n        function overscanDownwards(bottomIndex, bottomBlank) {\r\n            let overscanSize = 0;\r\n            let overscanCount = 0;\r\n            while (overscanCount < rowCount - bottomIndex && overscanSize < OVERSCAN_SIZE) {\r\n                overscanSize += cache[bottomIndex + overscanCount];\r\n                overscanCount += 1;\r\n            }\r\n            return {\r\n                bottomIndex: bottomIndex + overscanCount,\r\n                bottomBlank: bottomBlank - overscanSize,\r\n            };\r\n        }\r\n        function getEstimatedTotalSize(rowCount) {\r\n            return sum(cache) + (rowCount - cache.length) * estimatedRowHeight;\r\n        }\r\n        function setRowCount(count) {\r\n            // 将 cache 的长度设置为 count\r\n            if (count < cache.length) {\r\n                cache.length = count;\r\n            }\r\n            else {\r\n                const prevSize = cache.length;\r\n                cache.length = count;\r\n                cache.fill(estimatedRowHeight, prevSize);\r\n            }\r\n        }\r\n    }\r\n    function updateRow(index, offset, size) {\r\n        cache[index] = size;\r\n    }\r\n    return {\r\n        getRenderRange,\r\n        updateRow,\r\n        // 导出 cache，方便调试；上层在实际使用时 并不需要使用 cache 字段\r\n        cache,\r\n    };\r\n}\n\n// 表格 DOM 结构\r\n// div.art-table-wrapper\r\n// └── div.art-loading-wrapper\r\n//     ├── div.art-loading-indicator-wrapper\r\n//     │   └── div.art-loading-indicator\r\n//     │\r\n//     └── div.art-loading-content-wrapper\r\n//         ├── div.art-table\r\n//         │   │\r\n//         │   ├── div.art-table-header\r\n//         │   │  └── table\r\n//         │   │      ├── colgroup\r\n//         │   │      └── thead  注意这里会出现自定义内容，可能存在嵌套表格\r\n//         │   │\r\n//         │   ├── div.art-table-body\r\n//         │   │   ├── div.art-virtual-blank.top\r\n//         │   │   ├── table\r\n//         │   │   │   ├── colgroup\r\n//         │   │   │   └── tbody 注意这里会出现自定义内容，可能存在嵌套表格\r\n//         │   │   └── div.art-virtual-blank.bottom\r\n//         │   │\r\n//         │   ├── div.art-table-footer\r\n//         │   │  └── table\r\n//         │   │      ├── colgroup\r\n//         │   │      └── tfoot  注意这里会出现自定义内容，可能存在嵌套表格\r\n//         │   │\r\n//         │   ├── div.art-lock-shadow-mask\r\n//         │   │   └── div.art-left-lock-shadow\r\n//         │   └── div.art-lock-shadow-mask\r\n//         │       └── div.art-right-lock-shadow\r\n//         │\r\n//         └── div.art-sticky-scroll\r\n//             └── div.art-sticky-scroll-item\r\n//\r\n// 在「可能存在嵌套表格」的情况下，我们可以采用以下的方式来避免「querySelector 不小心获取到了的嵌套表格上的元素」：\r\n//  artTable.querySelector(':scope > .art-lock-shadow-mask .art-left-lock-shadow')\r\n// 表格 DOM 结构辅助工具\r\nclass TableDOMHelper {\r\n    constructor(artTableWrapper) {\r\n        this.artTableWrapper = artTableWrapper;\r\n        this.artTable = artTableWrapper.querySelector(`.${Classes.artTable}`);\r\n        this.tableHeader = this.artTable.querySelector(`:scope > .${Classes.tableHeader}`);\r\n        this.tableBody = this.artTable.querySelector(`:scope > .${Classes.tableBody}`);\r\n        this.tableFooter = this.artTable.querySelector(`:scope > .${Classes.tableFooter}`);\r\n        const stickyScrollSelector = `.${Classes.artTable} + .${Classes.stickyScroll}`;\r\n        this.stickyScroll = artTableWrapper.querySelector(stickyScrollSelector);\r\n        this.stickyScrollItem = this.stickyScroll.querySelector(`.${Classes.stickyScrollItem}`);\r\n    }\r\n    getVirtualTop() {\r\n        return this.tableBody.querySelector(`.${Classes.virtualBlank}.top`);\r\n    }\r\n    getTableRows() {\r\n        const htmlTable = this.getTableBodyHtmlTable();\r\n        return htmlTable.querySelectorAll(`:scope > tbody > .${Classes.tableRow}`);\r\n    }\r\n    getTableBodyHtmlTable() {\r\n        return this.artTable.querySelector(`.${Classes.tableBody} table`);\r\n    }\r\n    getLeftLockShadow() {\r\n        const selector = `:scope > .${Classes.lockShadowMask} .${Classes.leftLockShadow}`;\r\n        return this.artTable.querySelector(selector);\r\n    }\r\n    getRightLockShadow() {\r\n        const selector = `:scope > .${Classes.lockShadowMask} .${Classes.rightLockShadow}`;\r\n        return this.artTable.querySelector(selector);\r\n    }\r\n    getLoadingIndicator() {\r\n        return this.artTableWrapper.querySelector(`.${Classes.loadingIndicator}`);\r\n    }\r\n}\n\nfunction HtmlTable({ tbodyHtmlTag, getRowProps, primaryKey, data, verticalRenderInfo: verInfo, horizontalRenderInfo: hozInfo, components: { Row, Cell, TableBody }, }) {\r\n    const { flat, horizontalRenderRange: hoz } = hozInfo;\r\n    const spanManager = new SpanManager();\r\n    const fullFlatCount = flat.full.length;\r\n    const leftFlatCount = flat.left.length;\r\n    const rightFlatCount = flat.right.length;\r\n    const tbody = TableBody != null && tbodyHtmlTag === 'tbody' ? (React.createElement(TableBody, { tbodyProps: { children: data.map(renderRow) } })) : (React.createElement(tbodyHtmlTag, null, data.map(renderRow)));\r\n    return (React.createElement(\"table\", null,\r\n        React.createElement(Colgroup, { descriptors: hozInfo.visible }),\r\n        tbody));\r\n    function renderRow(row, i) {\r\n        const rowIndex = verInfo.offset + i;\r\n        spanManager.stripUpwards(rowIndex);\r\n        const rowProps = getRowProps(row, rowIndex);\r\n        const rowClass = cx(Classes.tableRow, {\r\n            first: rowIndex === verInfo.first,\r\n            last: rowIndex === verInfo.last,\r\n            even: rowIndex % 2 === 0,\r\n            odd: rowIndex % 2 === 1,\r\n        }, rowProps === null || rowProps === void 0 ? void 0 : rowProps.className);\r\n        const trProps = Object.assign(Object.assign({}, rowProps), { className: rowClass, 'data-rowindex': rowIndex, children: hozInfo.visible.map((descriptor) => {\r\n                if (descriptor.type === 'blank') {\r\n                    return React.createElement(\"td\", { key: descriptor.blankSide });\r\n                }\r\n                return renderBodyCell(row, rowIndex, descriptor.col, descriptor.colIndex);\r\n            }) });\r\n        const key = internals.safeGetRowKey(primaryKey, row, rowIndex);\r\n        if (Row != null && tbodyHtmlTag === 'tbody') {\r\n            return React.createElement(Row, { key, row, rowIndex, trProps });\r\n        }\r\n        else {\r\n            return React.createElement(\"tr\", Object.assign({ key: key }, trProps));\r\n        }\r\n    }\r\n    function renderBodyCell(row, rowIndex, column, colIndex) {\r\n        var _a, _b;\r\n        if (spanManager.testSkip(rowIndex, colIndex)) {\r\n            return null;\r\n        }\r\n        const value = internals.safeGetValue(column, row, rowIndex);\r\n        const cellProps = (_b = (_a = column.getCellProps) === null || _a === void 0 ? void 0 : _a.call(column, value, row, rowIndex)) !== null && _b !== void 0 ? _b : {};\r\n        let cellContent = value;\r\n        if (column.render) {\r\n            cellContent = column.render(value, row, rowIndex);\r\n        }\r\n        let colSpan = 1;\r\n        let rowSpan = 1;\r\n        if (column.getSpanRect) {\r\n            const spanRect = column.getSpanRect(value, row, rowIndex);\r\n            colSpan = spanRect == null ? 1 : spanRect.right - colIndex;\r\n            rowSpan = spanRect == null ? 1 : spanRect.bottom - rowIndex;\r\n        }\r\n        else {\r\n            if (cellProps.colSpan != null) {\r\n                colSpan = cellProps.colSpan;\r\n            }\r\n            if (cellProps.rowSpan != null) {\r\n                rowSpan = cellProps.rowSpan;\r\n            }\r\n        }\r\n        // rowSpan/colSpan 不能过大，避免 rowSpan/colSpan 影响因虚拟滚动而未渲染的单元格\r\n        rowSpan = Math.min(rowSpan, verInfo.limit - rowIndex);\r\n        colSpan = Math.min(colSpan, leftFlatCount + hoz.rightIndex - colIndex);\r\n        const hasSpan = colSpan > 1 || rowSpan > 1;\r\n        if (hasSpan) {\r\n            spanManager.add(rowIndex, colIndex, colSpan, rowSpan);\r\n        }\r\n        const positionStyle = {};\r\n        if (colIndex < leftFlatCount) {\r\n            positionStyle.position = 'sticky';\r\n            positionStyle.left = hozInfo.stickyLeftMap.get(colIndex);\r\n        }\r\n        else if (colIndex >= fullFlatCount - rightFlatCount) {\r\n            positionStyle.position = 'sticky';\r\n            positionStyle.right = hozInfo.stickyRightMap.get(colIndex);\r\n        }\r\n        const tdProps = Object.assign(Object.assign(Object.assign(Object.assign({}, cellProps), { className: cx(Classes.tableCell, cellProps.className, {\r\n                first: colIndex === 0,\r\n                last: colIndex + colSpan === fullFlatCount,\r\n                'lock-left': colIndex < leftFlatCount,\r\n                'lock-right': colIndex >= fullFlatCount - rightFlatCount,\r\n            }) }), (hasSpan ? { colSpan, rowSpan } : null)), { style: Object.assign(Object.assign({ textAlign: column.align }, cellProps.style), positionStyle), children: cellContent });\r\n        if (Cell != null && tbodyHtmlTag === 'tbody') {\r\n            return React.createElement(Cell, { key: colIndex, tdProps: tdProps, row: row, rowIndex: rowIndex, column: column, colIndex: colIndex });\r\n        }\r\n        else {\r\n            return React.createElement(\"td\", Object.assign({ key: colIndex }, tdProps));\r\n        }\r\n    }\r\n}\n\nconst DefaultLoadingIcon = React.memo(() => (React.createElement(\"svg\", { style: { margin: 'auto', display: 'block', width: 40, height: 40 }, viewBox: \"0 0 100 100\", preserveAspectRatio: \"xMidYMid\" },\r\n    React.createElement(\"circle\", { cx: \"50\", cy: \"50\", r: \"40\", fill: \"none\", stroke: \"#23a7fa\", strokeDasharray: \"188 64\", strokeLinecap: \"round\", strokeWidth: \"10\" },\r\n        React.createElement(\"animateTransform\", { attributeName: \"transform\", dur: \"1.5s\", keyTimes: \"0;1\", repeatCount: \"indefinite\", type: \"rotate\", values: \"0 50 50;360 50 50\" })))));\r\nfunction DefaultLoadingContentWrapper({ children, visible }) {\r\n    return (React.createElement(\"div\", { className: \"art-loading-content-wrapper\", style: { filter: visible ? 'blur(1px)' : 'none' } }, children));\r\n}\r\nfunction Loading({ visible, children, LoadingContentWrapper = DefaultLoadingContentWrapper, LoadingIcon = DefaultLoadingIcon, }) {\r\n    return (React.createElement(\"div\", { className: Classes.loadingWrapper },\r\n        visible && (React.createElement(\"div\", { className: Classes.loadingIndicatorWrapper },\r\n            React.createElement(\"div\", { className: Classes.loadingIndicator },\r\n                React.createElement(LoadingIcon, null)))),\r\n        React.createElement(LoadingContentWrapper, { visible: visible, children: children })));\r\n}\n\nlet emptyContentDeprecatedWarned = false;\r\nfunction warnEmptyContentIsDeprecated() {\r\n    if (!emptyContentDeprecatedWarned) {\r\n        emptyContentDeprecatedWarned = true;\r\n        console.warn('[ali-react-table] BaseTable props.emptyContent 已经过时，请使用 props.components.EmptyContent 来自定义数据为空时的表格表现');\r\n    }\r\n}\r\nlet flowRootDeprecatedWarned = false;\r\nfunction warnFlowRootIsDeprecated() {\r\n    if (!flowRootDeprecatedWarned) {\r\n        flowRootDeprecatedWarned = true;\r\n        console.warn('[ali-react-table] BaseTable v2.4 版本之后已经不再需要指定 flowRoot');\r\n    }\r\n}\r\nclass BaseTable extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.rowHeightManager = makeRowHeightManager(this.props.dataSource.length, this.props.estimatedRowHeight);\r\n        this.artTableWrapperRef = React.createRef();\r\n        this.rootSubscription = new Subscription();\r\n        this.state = {\r\n            hasScroll: true,\r\n            needRenderLock: true,\r\n            offsetY: 0,\r\n            offsetX: 0,\r\n            // 因为 ResizeObserver 在一开始总是会调用一次所提供的回调函数\r\n            // 故这里为 maxRenderHeight/maxRenderWidth 设置一个默认值即可（因为这两个默认值很快就会被覆盖）\r\n            // https://stackoverflow.com/questions/60026223/does-resizeobserver-invokes-initially-on-page-load\r\n            maxRenderHeight: 600,\r\n            maxRenderWidth: 800,\r\n        };\r\n    }\r\n    /** @deprecated BaseTable.getDoms() 已经过时，请勿调用 */\r\n    getDoms() {\r\n        console.warn('[ali-react-table] BaseTable.getDoms() 已经过时');\r\n        return this.domHelper;\r\n    }\r\n    /** 自定义滚动条宽度为table宽度，使滚动条滑块宽度相同 */\r\n    updateStickyScroll() {\r\n        const { stickyScroll, artTable, stickyScrollItem } = this.domHelper;\r\n        if (!artTable) {\r\n            return;\r\n        }\r\n        const tableBodyHtmlTable = this.domHelper.getTableBodyHtmlTable();\r\n        const innerTableWidth = tableBodyHtmlTable.offsetWidth;\r\n        const artTableWidth = artTable.offsetWidth;\r\n        const stickyScrollHeightProp = this.props.stickyScrollHeight;\r\n        const stickyScrollHeight = stickyScrollHeightProp === 'auto' ? getScrollbarSize().height : stickyScrollHeightProp;\r\n        stickyScroll.style.marginTop = `-${stickyScrollHeight + 1}px`;\r\n        if (artTableWidth >= innerTableWidth) {\r\n            if (this.state.hasScroll) {\r\n                this.setState({ hasScroll: false });\r\n            }\r\n        }\r\n        else {\r\n            if (!this.state.hasScroll && stickyScrollHeight > 5) {\r\n                // 考虑下mac下面隐藏滚动条的情况\r\n                this.setState({ hasScroll: true });\r\n            }\r\n        }\r\n        // 设置子节点宽度\r\n        stickyScrollItem.style.width = `${innerTableWidth}px`;\r\n    }\r\n    renderTableHeader(info) {\r\n        const { stickyTop, hasHeader } = this.props;\r\n        return (React.createElement(\"div\", { className: cx(Classes.tableHeader, 'no-scrollbar'), style: {\r\n                top: stickyTop === 0 ? undefined : stickyTop,\r\n                display: hasHeader ? undefined : 'none',\r\n            } },\r\n            React.createElement(TableHeader, { info: info })));\r\n    }\r\n    updateOffsetX(nextOffsetX) {\r\n        if (this.lastInfo.useVirtual.horizontal) {\r\n            if (Math.abs(nextOffsetX - this.state.offsetX) >= OVERSCAN_SIZE / 2) {\r\n                this.setState({ offsetX: nextOffsetX });\r\n            }\r\n        }\r\n    }\r\n    syncHorizontalScrollFromTableBody() {\r\n        this.syncHorizontalScroll(this.domHelper.tableBody.scrollLeft);\r\n    }\r\n    /** 同步横向滚动偏移量 */\r\n    syncHorizontalScroll(x) {\r\n        this.updateOffsetX(x);\r\n        const { tableBody } = this.domHelper;\r\n        const { flat } = this.lastInfo;\r\n        const leftLockShadow = this.domHelper.getLeftLockShadow();\r\n        if (leftLockShadow) {\r\n            const shouldShowLeftLockShadow = flat.left.length > 0 && this.state.needRenderLock && x > 0;\r\n            if (shouldShowLeftLockShadow) {\r\n                leftLockShadow.classList.add('show-shadow');\r\n            }\r\n            else {\r\n                leftLockShadow.classList.remove('show-shadow');\r\n            }\r\n        }\r\n        const rightLockShadow = this.domHelper.getRightLockShadow();\r\n        if (rightLockShadow) {\r\n            const shouldShowRightLockShadow = flat.right.length > 0 && this.state.needRenderLock && x < tableBody.scrollWidth - tableBody.clientWidth;\r\n            if (shouldShowRightLockShadow) {\r\n                rightLockShadow.classList.add('show-shadow');\r\n            }\r\n            else {\r\n                rightLockShadow.classList.remove('show-shadow');\r\n            }\r\n        }\r\n    }\r\n    getVerticalRenderRange(useVirtual) {\r\n        const { dataSource } = this.props;\r\n        const { offsetY, maxRenderHeight } = this.state;\r\n        const rowCount = dataSource.length;\r\n        if (useVirtual.vertical) {\r\n            return this.rowHeightManager.getRenderRange(offsetY, maxRenderHeight, rowCount);\r\n        }\r\n        else {\r\n            return getFullRenderRange(rowCount);\r\n        }\r\n    }\r\n    renderTableBody(info) {\r\n        const { dataSource, getRowProps, primaryKey, isLoading, emptyCellHeight, footerDataSource, components } = this.props;\r\n        const tableBodyClassName = cx(Classes.tableBody, Classes.horizontalScrollContainer, {\r\n            'no-scrollbar': footerDataSource.length > 0,\r\n        });\r\n        if (dataSource.length === 0) {\r\n            const { components, emptyContent } = this.props;\r\n            let EmptyContent = components.EmptyContent;\r\n            if (EmptyContent == null && emptyContent != null) {\r\n                warnEmptyContentIsDeprecated();\r\n                EmptyContent = (() => emptyContent);\r\n            }\r\n            return (React.createElement(\"div\", { className: tableBodyClassName },\r\n                React.createElement(EmptyHtmlTable, { descriptors: info.visible, isLoading: isLoading, EmptyContent: EmptyContent, emptyCellHeight: emptyCellHeight })));\r\n        }\r\n        const { topIndex, bottomBlank, topBlank, bottomIndex } = info.verticalRenderRange;\r\n        return (React.createElement(\"div\", { className: tableBodyClassName },\r\n            topBlank > 0 && (React.createElement(\"div\", { key: \"top-blank\", className: cx(Classes.virtualBlank, 'top'), style: { height: topBlank } })),\r\n            React.createElement(HtmlTable, { components: components, tbodyHtmlTag: \"tbody\", getRowProps: getRowProps, primaryKey: primaryKey, data: dataSource.slice(topIndex, bottomIndex), horizontalRenderInfo: info, verticalRenderInfo: {\r\n                    first: 0,\r\n                    offset: topIndex,\r\n                    limit: bottomIndex,\r\n                    last: dataSource.length - 1,\r\n                } }),\r\n            bottomBlank > 0 && (React.createElement(\"div\", { key: \"bottom-blank\", className: cx(Classes.virtualBlank, 'bottom'), style: { height: bottomBlank } }))));\r\n    }\r\n    renderTableFooter(info) {\r\n        const { footerDataSource = [], getRowProps, primaryKey, stickyBottom, components } = this.props;\r\n        return (React.createElement(\"div\", { className: cx(Classes.tableFooter, Classes.horizontalScrollContainer), style: { bottom: stickyBottom === 0 ? undefined : stickyBottom } },\r\n            React.createElement(HtmlTable, { components: components, tbodyHtmlTag: \"tfoot\", data: footerDataSource, horizontalRenderInfo: info, getRowProps: getRowProps, primaryKey: primaryKey, verticalRenderInfo: {\r\n                    offset: 0,\r\n                    first: 0,\r\n                    last: footerDataSource.length - 1,\r\n                    limit: Infinity,\r\n                } })));\r\n    }\r\n    renderLockShadows(info) {\r\n        return (React.createElement(React.Fragment, null,\r\n            React.createElement(\"div\", { className: Classes.lockShadowMask, style: { left: 0, width: info.leftLockTotalWidth + LOCK_SHADOW_PADDING } },\r\n                React.createElement(\"div\", { className: cx(Classes.lockShadow, Classes.leftLockShadow) })),\r\n            React.createElement(\"div\", { className: Classes.lockShadowMask, style: { right: 0, width: info.rightLockTotalWidth + LOCK_SHADOW_PADDING } },\r\n                React.createElement(\"div\", { className: cx(Classes.lockShadow, Classes.rightLockShadow) }))));\r\n    }\r\n    renderStickyScroll(info) {\r\n        const { hasStickyScroll, stickyBottom } = this.props;\r\n        const { hasScroll } = this.state;\r\n        return (React.createElement(\"div\", { className: cx(Classes.stickyScroll, Classes.horizontalScrollContainer), style: {\r\n                display: hasStickyScroll && hasScroll ? 'block' : 'none',\r\n                bottom: stickyBottom,\r\n            } },\r\n            React.createElement(\"div\", { className: Classes.stickyScrollItem })));\r\n    }\r\n    render() {\r\n        const info = calculateRenderInfo(this);\r\n        this.lastInfo = info;\r\n        const { dataSource, className, style, hasHeader, useOuterBorder, isStickyHead, isStickyHeader, isStickyFooter, isLoading, footerDataSource, components, flowRoot, } = this.props;\r\n        if (flowRoot != null) {\r\n            warnFlowRootIsDeprecated();\r\n        }\r\n        const artTableWrapperClassName = cx(Classes.artTableWrapper, {\r\n            'use-outer-border': useOuterBorder,\r\n            empty: dataSource.length === 0,\r\n            lock: info.hasLockColumn,\r\n            'has-header': hasHeader,\r\n            'sticky-header': isStickyHeader !== null && isStickyHeader !== void 0 ? isStickyHeader : isStickyHead,\r\n            'has-footer': footerDataSource.length > 0,\r\n            'sticky-footer': isStickyFooter,\r\n        }, className);\r\n        const artTableWrapperProps = {\r\n            className: artTableWrapperClassName,\r\n            style,\r\n            [STYLED_REF_PROP]: this.artTableWrapperRef,\r\n        };\r\n        return (React.createElement(StyledArtTableWrapper, Object.assign({}, artTableWrapperProps),\r\n            React.createElement(Loading, { visible: isLoading, LoadingIcon: components.LoadingIcon, LoadingContentWrapper: components.LoadingContentWrapper },\r\n                React.createElement(\"div\", { className: Classes.artTable },\r\n                    this.renderTableHeader(info),\r\n                    this.renderTableBody(info),\r\n                    this.renderTableFooter(info),\r\n                    this.renderLockShadows(info)),\r\n                this.renderStickyScroll(info))));\r\n    }\r\n    componentDidMount() {\r\n        this.updateDOMHelper();\r\n        this.props$ = new BehaviorSubject(this.props);\r\n        this.initSubscriptions();\r\n        this.didMountOrUpdate();\r\n    }\r\n    componentDidUpdate(prevProps, prevState) {\r\n        this.updateDOMHelper();\r\n        this.props$.next(this.props);\r\n        this.didMountOrUpdate(prevProps, prevState);\r\n    }\r\n    didMountOrUpdate(prevProps, prevState) {\r\n        this.syncHorizontalScrollFromTableBody();\r\n        this.updateStickyScroll();\r\n        this.adjustNeedRenderLock();\r\n        this.updateRowHeightManager();\r\n        this.updateScrollLeftWhenLayoutChanged(prevProps, prevState);\r\n    }\r\n    updateScrollLeftWhenLayoutChanged(prevProps, prevState) {\r\n        if (prevState != null) {\r\n            if (!prevState.hasScroll && this.state.hasScroll) {\r\n                this.domHelper.stickyScroll.scrollLeft = 0;\r\n            }\r\n        }\r\n        if (prevProps != null) {\r\n            const prevHasFooter = prevProps.footerDataSource.length > 0;\r\n            const currentHasFooter = this.props.footerDataSource.length > 0;\r\n            if (!prevHasFooter && currentHasFooter) {\r\n                this.domHelper.tableFooter.scrollLeft = this.domHelper.tableBody.scrollLeft;\r\n            }\r\n        }\r\n    }\r\n    initSubscriptions() {\r\n        const { tableHeader, tableBody, tableFooter, stickyScroll } = this.domHelper;\r\n        this.rootSubscription.add(throttledWindowResize$.subscribe(() => {\r\n            this.updateStickyScroll();\r\n            this.adjustNeedRenderLock();\r\n        }));\r\n        // 滚动同步\r\n        this.rootSubscription.add(syncScrollLeft([tableHeader, tableBody, tableFooter, stickyScroll], (scrollLeft) => {\r\n            this.syncHorizontalScroll(scrollLeft);\r\n        }));\r\n        const richVisibleRects$ = getRichVisibleRectsStream(this.domHelper.artTable, this.props$.pipe(op.skip(1), op.mapTo('structure-may-change')), this.props.virtualDebugLabel).pipe(op.shareReplay());\r\n        // 每当可见部分发生变化的时候，调整 loading icon 的未知（如果 loading icon 存在的话）\r\n        this.rootSubscription.add(combineLatest([\r\n            richVisibleRects$.pipe(op.map((p) => p.clipRect), op.distinctUntilChanged(shallowEqual)),\r\n            this.props$.pipe(op.startWith(null), op.pairwise(), op.filter(([prevProps, props]) => prevProps == null || (!prevProps.isLoading && props.isLoading))),\r\n        ]).subscribe(([clipRect]) => {\r\n            const loadingIndicator = this.domHelper.getLoadingIndicator();\r\n            if (!loadingIndicator) {\r\n                return;\r\n            }\r\n            const height = clipRect.bottom - clipRect.top;\r\n            // fixme 这里的定位在有些特殊情况下可能会出错 see #132\r\n            loadingIndicator.style.top = `${height / 2}px`;\r\n            loadingIndicator.style.marginTop = `${height / 2}px`;\r\n        }));\r\n        // 每当可见部分发生变化的时候，如果开启了虚拟滚动，则重新触发 render\r\n        this.rootSubscription.add(richVisibleRects$\r\n            .pipe(op.filter(() => {\r\n            const { horizontal, vertical } = this.lastInfo.useVirtual;\r\n            return horizontal || vertical;\r\n        }), op.map(({ clipRect, offsetY }) => ({\r\n            maxRenderHeight: clipRect.bottom - clipRect.top,\r\n            maxRenderWidth: clipRect.right - clipRect.left,\r\n            offsetY,\r\n        })), op.distinctUntilChanged((x, y) => {\r\n            // 因为 overscan 的存在，滚动较小的距离时不需要触发组件重渲染\r\n            return (Math.abs(x.maxRenderWidth - y.maxRenderWidth) < OVERSCAN_SIZE / 2 &&\r\n                Math.abs(x.maxRenderHeight - y.maxRenderHeight) < OVERSCAN_SIZE / 2 &&\r\n                Math.abs(x.offsetY - y.offsetY) < OVERSCAN_SIZE / 2);\r\n        }))\r\n            .subscribe((sizeAndOffset) => {\r\n            this.setState(sizeAndOffset);\r\n        }));\r\n    }\r\n    componentWillUnmount() {\r\n        this.rootSubscription.unsubscribe();\r\n    }\r\n    /** 更新 DOM 节点的引用，方便其他方法直接操作 DOM */\r\n    updateDOMHelper() {\r\n        this.domHelper = new TableDOMHelper(this.artTableWrapperRef.current);\r\n    }\r\n    updateRowHeightManager() {\r\n        var _a;\r\n        const virtualTop = this.domHelper.getVirtualTop();\r\n        const virtualTopHeight = (_a = virtualTop === null || virtualTop === void 0 ? void 0 : virtualTop.clientHeight) !== null && _a !== void 0 ? _a : 0;\r\n        let zeroHeightRowCount = 0;\r\n        let maxRowIndex = -1;\r\n        let maxRowBottom = -1;\r\n        for (const tr of this.domHelper.getTableRows()) {\r\n            const rowIndex = Number(tr.dataset.rowindex);\r\n            if (isNaN(rowIndex)) {\r\n                continue;\r\n            }\r\n            maxRowIndex = Math.max(maxRowIndex, rowIndex);\r\n            const offset = tr.offsetTop + virtualTopHeight;\r\n            const size = tr.offsetHeight;\r\n            if (size === 0) {\r\n                zeroHeightRowCount += 1;\r\n            }\r\n            maxRowBottom = Math.max(maxRowBottom, offset + size);\r\n            this.rowHeightManager.updateRow(rowIndex, offset, size);\r\n        }\r\n        // 当 estimatedRowHeight 过大时，可能出现「渲染行数过少，无法覆盖可视范围」的情况\r\n        // 出现这种情况时，我们判断「下一次渲染能够渲染更多行」是否满足，满足的话就直接调用 forceUpdate\r\n        // zeroHeightRowCount === 0 用于确保当前没有 display=none 的情况\r\n        if (maxRowIndex !== -1 && zeroHeightRowCount === 0) {\r\n            if (maxRowBottom < this.state.offsetY + this.state.maxRenderHeight) {\r\n                const vertical = this.getVerticalRenderRange(this.lastInfo.useVirtual);\r\n                if (vertical.bottomIndex - 1 > maxRowIndex) {\r\n                    this.forceUpdate();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /** 计算表格所有列的渲染宽度之和，判断表格是否需要渲染锁列 */\r\n    adjustNeedRenderLock() {\r\n        const { needRenderLock } = this.state;\r\n        const { flat, hasLockColumn } = this.lastInfo;\r\n        if (hasLockColumn) {\r\n            const sumOfColWidth = sum(flat.full.map((col) => col.width));\r\n            const nextNeedRenderLock = sumOfColWidth > this.domHelper.artTable.clientWidth;\r\n            if (needRenderLock !== nextNeedRenderLock) {\r\n                this.setState({ needRenderLock: nextNeedRenderLock });\r\n            }\r\n        }\r\n        else {\r\n            if (needRenderLock) {\r\n                this.setState({ needRenderLock: false });\r\n            }\r\n        }\r\n    }\r\n}\r\nBaseTable.defaultProps = {\r\n    hasHeader: true,\r\n    isStickyHeader: true,\r\n    stickyTop: 0,\r\n    footerDataSource: [],\r\n    isStickyFooter: true,\r\n    stickyBottom: 0,\r\n    hasStickyScroll: true,\r\n    stickyScrollHeight: 'auto',\r\n    useVirtual: 'auto',\r\n    estimatedRowHeight: 48,\r\n    isLoading: false,\r\n    components: {},\r\n    getRowProps: noop,\r\n    dataSource: [],\r\n};\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\n\nconst InlineFlexCell = styled__default.div `\n  display: inline-flex;\n  align-items: center;\n`;\r\nconst ExpansionCell = styled__default(InlineFlexCell) `\n  &.leaf {\n    cursor: default;\n  }\n\n  .expansion-icon {\n    fill: #999;\n    flex: 0 0 16px;\n    transition: transform 200ms;\n\n    &.expanded {\n      transform-origin: center center;\n      transform: rotate(90deg);\n    }\n  }\n`;\r\nfunction CaretDownIcon(props) {\r\n    return (React.createElement(\"svg\", Object.assign({ focusable: \"false\", preserveAspectRatio: \"xMidYMid meet\", fill: \"currentColor\", width: \"16\", height: \"16\", viewBox: \"0 0 32 32\" }, props),\r\n        React.createElement(\"path\", { d: \"M24 12L16 22 8 12z\" })));\r\n}\r\nfunction InfoIcon(props) {\r\n    return (React.createElement(\"svg\", Object.assign({ focusable: \"false\", preserveAspectRatio: \"xMidYMid meet\", fill: \"currentColor\", width: \"16\", height: \"16\", viewBox: \"0 0 16 16\" }, props),\r\n        React.createElement(\"path\", { d: \"M8.5 11L8.5 6.5 6.5 6.5 6.5 7.5 7.5 7.5 7.5 11 6 11 6 12 10 12 10 11zM8 3.5c-.4 0-.8.3-.8.8S7.6 5 8 5c.4 0 .8-.3.8-.8S8.4 3.5 8 3.5z\" }),\r\n        React.createElement(\"path\", { d: \"M8,15c-3.9,0-7-3.1-7-7s3.1-7,7-7s7,3.1,7,7S11.9,15,8,15z M8,2C4.7,2,2,4.7,2,8s2.7,6,6,6s6-2.7,6-6S11.3,2,8,2z\" })));\r\n}\r\nfunction CaretRightIcon(props) {\r\n    return (React.createElement(\"svg\", Object.assign({ focusable: \"false\", preserveAspectRatio: \"xMidYMid meet\", fill: \"currentColor\", width: \"16\", height: \"16\", viewBox: \"0 0 32 32\" }, props),\r\n        React.createElement(\"path\", { d: \"M12 8L22 16 12 24z\" })));\r\n}\r\nfunction LoadingIcon(props) {\r\n    return (React.createElement(\"svg\", Object.assign({ width: \"16\", height: \"16\", fill: \"currentColor\", viewBox: \"0 0 1024 1024\" }, props),\r\n        React.createElement(\"path\", { d: \"M512 74.667c-17.067 0-32 14.933-32 32V256c0 17.067 14.933 32 32 32s32-14.933 32-32V106.667c0-17.067-14.933-32-32-32zm181.333 288c8.534 0 17.067-2.134 23.467-8.534L821.333 249.6c12.8-12.8 12.8-32 0-44.8-12.8-12.8-32-12.8-44.8 0L672 309.333c-12.8 12.8-12.8 32 0 44.8 4.267 6.4 12.8 8.534 21.333 8.534zm224 117.333H768c-17.067 0-32 14.933-32 32s14.933 32 32 32h149.333c17.067 0 32-14.933 32-32s-14.933-32-32-32zM714.667 669.867c-12.8-12.8-32-12.8-44.8 0s-12.8 32 0 44.8L774.4 819.2c6.4 6.4 14.933 8.533 23.467 8.533s17.066-2.133 23.466-8.533c12.8-12.8 12.8-32 0-44.8L714.667 669.867zM512 736c-17.067 0-32 14.933-32 32v149.333c0 17.067 14.933 32 32 32s32-14.933 32-32V768c0-17.067-14.933-32-32-32zm-202.667-66.133L204.8 774.4c-12.8 12.8-12.8 32 0 44.8 6.4 6.4 14.933 8.533 23.467 8.533s17.066-2.133 23.466-8.533l104.534-104.533c12.8-12.8 12.8-32 0-44.8s-36.267-12.8-46.934 0zM288 512c0-17.067-14.933-32-32-32H106.667c-17.067 0-32 14.933-32 32s14.933 32 32 32H256c17.067 0 32-14.933 32-32zm-40.533-309.333c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8L307.2 352c6.4 6.4 14.933 8.533 23.467 8.533s17.066-2.133 23.466-8.533c12.8-12.8 12.8-32 0-44.8L247.467 202.667z\" })));\r\n}\r\nconst icons = {\r\n    Loading: LoadingIcon,\r\n    CaretDown: CaretDownIcon,\r\n    CaretRight: CaretRightIcon,\r\n    Info: InfoIcon,\r\n};\n\nconst treeMetaSymbol = Symbol('treeMetaSymbol');\r\nfunction treeMode(opts = {}) {\r\n    return function treeModeStep(pipeline) {\r\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\r\n        const stateKey = 'treeMode';\r\n        const ctx = pipeline.ctx;\r\n        const primaryKey = pipeline.ensurePrimaryKey('treeMode');\r\n        if (typeof primaryKey !== 'string') {\r\n            throw new Error('treeMode 仅支持字符串作为 primaryKey');\r\n        }\r\n        const openKeys = (_c = (_b = (_a = opts.openKeys) !== null && _a !== void 0 ? _a : pipeline.getStateAtKey(stateKey)) !== null && _b !== void 0 ? _b : opts.defaultOpenKeys) !== null && _c !== void 0 ? _c : [];\r\n        const openKeySet = new Set(openKeys);\r\n        const onChangeOpenKeys = (nextKeys, key, action) => {\r\n            var _a;\r\n            (_a = opts.onChangeOpenKeys) === null || _a === void 0 ? void 0 : _a.call(opts, nextKeys, key, action);\r\n            pipeline.setStateAtKey(stateKey, nextKeys, { key, action });\r\n        };\r\n        const toggle = (rowKey) => {\r\n            const expanded = openKeySet.has(rowKey);\r\n            if (expanded) {\r\n                onChangeOpenKeys(openKeys.filter((key) => key !== rowKey), rowKey, 'collapse');\r\n            }\r\n            else {\r\n                onChangeOpenKeys([...openKeys, rowKey], rowKey, 'expand');\r\n            }\r\n        };\r\n        const isLeafNode$1 = (_d = opts.isLeafNode) !== null && _d !== void 0 ? _d : isLeafNode;\r\n        const clickArea = (_e = opts.clickArea) !== null && _e !== void 0 ? _e : 'cell';\r\n        const treeMetaKey = (_f = opts.treeMetaKey) !== null && _f !== void 0 ? _f : treeMetaSymbol;\r\n        const stopClickEventPropagation = Boolean(opts.stopClickEventPropagation);\r\n        // indents\r\n        const iconWidth = ctx.indents.iconWidth;\r\n        const iconIndent = (_g = opts.iconIndent) !== null && _g !== void 0 ? _g : ctx.indents.iconIndent;\r\n        const iconGap = (_h = opts.iconGap) !== null && _h !== void 0 ? _h : ctx.indents.iconGap;\r\n        const indentSize = (_j = opts.indentSize) !== null && _j !== void 0 ? _j : ctx.indents.indentSize;\r\n        return pipeline.mapDataSource(processDataSource).mapColumns(processColumns);\r\n        function processDataSource(input) {\r\n            const result = [];\r\n            dfs(input, 0);\r\n            function dfs(nodes, depth) {\r\n                if (nodes == null) {\r\n                    return;\r\n                }\r\n                for (const node of nodes) {\r\n                    const rowKey = node[primaryKey];\r\n                    const expanded = openKeySet.has(rowKey);\r\n                    const isLeaf = isLeafNode$1(node, { depth, expanded, rowKey });\r\n                    const treeMeta = { depth, isLeaf, expanded, rowKey };\r\n                    result.push(Object.assign({ [treeMetaKey]: treeMeta }, node));\r\n                    if (!isLeaf && expanded) {\r\n                        dfs(node.children, depth + 1);\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n        function processColumns(columns) {\r\n            if (columns.length === 0) {\r\n                return columns;\r\n            }\r\n            const [firstCol, ...others] = columns;\r\n            const render = (value, record, recordIndex) => {\r\n                const content = internals.safeRender(firstCol, record, recordIndex);\r\n                if (record[treeMetaKey] == null) {\r\n                    // 没有 treeMeta 信息的话，就返回原先的渲染结果\r\n                    return content;\r\n                }\r\n                const { rowKey, depth, isLeaf, expanded } = record[treeMetaKey];\r\n                const indent = iconIndent + depth * indentSize;\r\n                if (isLeaf) {\r\n                    return (React.createElement(InlineFlexCell, { className: \"expansion-cell leaf\" },\r\n                        React.createElement(\"span\", { style: { marginLeft: indent + iconWidth + iconGap } }, content)));\r\n                }\r\n                const onClick = (e) => {\r\n                    if (stopClickEventPropagation) {\r\n                        e.stopPropagation();\r\n                    }\r\n                    toggle(rowKey);\r\n                };\r\n                const expandCls = expanded ? 'expanded' : 'collapsed';\r\n                return (React.createElement(ExpansionCell, { className: cx('expansion-cell', expandCls), style: {\r\n                        cursor: clickArea === 'content' ? 'pointer' : undefined,\r\n                    }, onClick: clickArea === 'content' ? onClick : undefined },\r\n                    React.createElement(icons.CaretRight, { className: cx('expansion-icon', expandCls), style: {\r\n                            cursor: clickArea === 'icon' ? 'pointer' : undefined,\r\n                            marginLeft: indent,\r\n                            marginRight: iconGap,\r\n                        }, onClick: clickArea === 'icon' ? onClick : undefined }),\r\n                    content));\r\n            };\r\n            const getCellProps = (value, record, rowIndex) => {\r\n                const prevProps = internals.safeGetCellProps(firstCol, record, rowIndex);\r\n                if (record[treeMetaKey] == null) {\r\n                    // 没有 treeMeta 信息的话，就返回原先的 cellProps\r\n                    return prevProps;\r\n                }\r\n                const { isLeaf, rowKey } = record[treeMetaKey];\r\n                if (isLeaf) {\r\n                    return prevProps;\r\n                }\r\n                return mergeCellProps(prevProps, {\r\n                    onClick(e) {\r\n                        if (stopClickEventPropagation) {\r\n                            e.stopPropagation();\r\n                        }\r\n                        toggle(rowKey);\r\n                    },\r\n                    style: { cursor: 'pointer' },\r\n                });\r\n            };\r\n            return [\r\n                Object.assign(Object.assign({}, firstCol), { title: (React.createElement(\"span\", { style: { marginLeft: iconIndent + iconWidth + iconGap } }, internals.safeRenderHeader(firstCol))), render, getCellProps: clickArea === 'cell' ? getCellProps : firstCol.getCellProps }),\r\n                ...others,\r\n            ];\r\n        }\r\n    };\r\n}\n\n/**\r\n * 表格数据处理流水线。TablePipeline 提供了表格数据处理过程中的一些上下方与工具方法，包括……\r\n *\r\n * 1. ctx：上下文环境对象，step（流水线上的一步）可以对 ctx 中的字段进行读写。\r\n * ctx 中部分字段名称有特定的含义（例如 primaryKey 表示行的主键），使用自定义的上下文信息时注意避开这些名称。\r\n *\r\n * 2. rowPropsGetters：getRowProps 回调队列，step 可以通过 pipeline.appendRowPropsGetter 向队列中追加回调函数，\r\n *   在调用 pipeline.props() 队列中的所有函数会组合形成最终的 getRowProps\r\n *\r\n * 3. 当前流水线的状态，包括 dataSource, columns, rowPropsGetters 三个部分\r\n *\r\n * 4. snapshots，调用 pipeline.snapshot(name) 可以记录当前的状态，后续可以通过 name 来读取保存的状态\r\n * */\r\nclass TablePipeline {\r\n    constructor({ state, setState, ctx, }) {\r\n        this._snapshots = {};\r\n        this._rowPropsGetters = [];\r\n        this.ctx = {\r\n            components: {},\r\n            indents: TablePipeline.defaultIndents,\r\n        };\r\n        this.state = state;\r\n        this.setState = setState;\r\n        Object.assign(this.ctx, ctx);\r\n    }\r\n    appendRowPropsGetter(getter) {\r\n        this._rowPropsGetters.push(getter);\r\n        return this;\r\n    }\r\n    getDataSource(name) {\r\n        if (name == null) {\r\n            return this._dataSource;\r\n        }\r\n        else {\r\n            return this._snapshots[name].dataSource;\r\n        }\r\n    }\r\n    getColumns(name) {\r\n        if (name == null) {\r\n            return this._columns;\r\n        }\r\n        else {\r\n            return this._snapshots[name].columns;\r\n        }\r\n    }\r\n    getStateAtKey(stateKey, defaultValue) {\r\n        var _a;\r\n        return (_a = this.state[stateKey]) !== null && _a !== void 0 ? _a : defaultValue;\r\n    }\r\n    /** 将 stateKey 对应的状态设置为 partialState  */\r\n    setStateAtKey(stateKey, partialState, extraInfo) {\r\n        this.setState((prev) => (Object.assign(Object.assign({}, prev), { [stateKey]: partialState })), stateKey, partialState, extraInfo);\r\n    }\r\n    /** 确保 primaryKey 已被设置，并返回 primaryKey  */\r\n    ensurePrimaryKey(hint) {\r\n        if (this.ctx.primaryKey == null) {\r\n            throw new Error(hint ? `使用 ${hint} 之前必须先设置 primaryKey` : '必须先设置 primaryKey');\r\n        }\r\n        return this.ctx.primaryKey;\r\n    }\r\n    /** 设置流水线的输入数据 */\r\n    input(input) {\r\n        if (this._dataSource != null || this._columns != null) {\r\n            throw new Error('input 不能调用两次');\r\n        }\r\n        this._dataSource = input.dataSource;\r\n        this._columns = input.columns;\r\n        this.snapshot('input');\r\n        return this;\r\n    }\r\n    /** 设置 dataSource */\r\n    dataSource(rows) {\r\n        this._dataSource = rows;\r\n        return this;\r\n    }\r\n    /** 设置 columns */\r\n    columns(cols) {\r\n        this._columns = cols;\r\n        return this;\r\n    }\r\n    /** 设置主键 */\r\n    primaryKey(key) {\r\n        this.ctx.primaryKey = key;\r\n        return this;\r\n    }\r\n    /** 保存快照 */\r\n    snapshot(name) {\r\n        this._snapshots[name] = {\r\n            dataSource: this._dataSource,\r\n            columns: this._columns,\r\n            rowPropsGetters: this._rowPropsGetters.slice(),\r\n        };\r\n        return this;\r\n    }\r\n    /** @deprecated\r\n     *  应用一个 ali-react-table Table transform */\r\n    useTransform(transform) {\r\n        const next = transform({\r\n            dataSource: this.getDataSource(),\r\n            columns: this.getColumns(),\r\n        });\r\n        return this.dataSource(next.dataSource).columns(next.columns);\r\n    }\r\n    /** 使用 pipeline 功能拓展 */\r\n    use(step) {\r\n        return step(this);\r\n    }\r\n    /** 转换 dataSource */\r\n    mapDataSource(mapper) {\r\n        return this.dataSource(mapper(this.getDataSource()));\r\n    }\r\n    /** 转换 columns */\r\n    mapColumns(mapper) {\r\n        return this.columns(mapper(this.getColumns()));\r\n    }\r\n    /** 获取 BaseTable 的 props，结果中包含 dataSource/columns/primaryKey/getRowProps 四个字段 */\r\n    getProps() {\r\n        const result = {\r\n            dataSource: this._dataSource,\r\n            columns: this._columns,\r\n        };\r\n        if (this.ctx.primaryKey) {\r\n            result.primaryKey = this.ctx.primaryKey;\r\n        }\r\n        if (this._rowPropsGetters.length > 0) {\r\n            result.getRowProps = (row, rowIndex) => {\r\n                return this._rowPropsGetters.reduce((res, get) => {\r\n                    return mergeCellProps(res, get(row, rowIndex));\r\n                }, {});\r\n            };\r\n        }\r\n        return result;\r\n    }\r\n}\r\nTablePipeline.defaultIndents = {\r\n    iconIndent: -8,\r\n    iconWidth: 16,\r\n    iconGap: 0,\r\n    indentSize: 16,\r\n};\r\nfunction useTablePipeline(ctx) {\r\n    const [state, setState] = useState({});\r\n    return new TablePipeline({ state, setState, ctx });\r\n}\n\nexport { BaseTable as B, Classes as C, ExpansionCell as E, InlineFlexCell as I, SpanManager as S, TablePipeline as T, __rest as _, internals as a, icons as b, collectNodes as c, arrayUtils as d, always as e, flatMap as f, getTreeDepth as g, treeMetaSymbol as h, isLeafNode as i, groupBy2 as j, fromEntries as k, mergeCellProps as m, treeMode as t, useTablePipeline as u };\n"]},"metadata":{},"sourceType":"module"}